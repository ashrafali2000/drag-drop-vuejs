"use strict";(self["webpackChunkquant_ux"]=self["webpackChunkquant_ux"]||[]).push([[598],{31583:function(e,t,i){i.r(t),i.d(t,{default:function(){return Bt}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvasPage",attrs:{id:"CanvasNode"},on:{wheel:e.onMouseWheel}},["Design"===e.selectedViewMode?[i("DesignToolbar",{ref:"toolbar",attrs:{pub:e.pub},on:{viewModeChange:e.onVieModeChange}}),i("DesignCanvas",{ref:"canvas",attrs:{viewport:e.viewport},on:{viewport:e.onViewPortChange}})]:e._e(),"Heatmap"===e.selectedViewMode?[i("AnalyticToolbar",{ref:"toolbar",on:{viewModeChange:e.onVieModeChange}}),i("AnalyticCanvas",{ref:"canvas",attrs:{viewport:e.viewport},on:{viewport:e.onViewPortChange}})]:e._e()],2)},n=[],o=i(50124),a=i(48534),r=(i(41539),i(78783),i(33948),i(74916),i(77601),i(93921)),l=i(93134),c=i(32551),h=i(16373),d=i(64270),u=i(59495),g=i(73311),v=i(95989),m=i(42477),p=i(24615),f=i(27437),M=i(14285),C=i(13087),S=i(62833),y=(i(69826),i(57327),i(64686)),w=function(){function e(t){(0,C.Z)(this,e),this.user=t,this.collabUsers=[]}return(0,S.Z)(e,[{key:"initWebsocket",value:function(e,t,i,s){var n=this;y.Z.log(3,"CollabSession.initWebsocket()","enter");try{var o=this.user,a=f.Z.getWebSocketService(e.id,o.token,o);a?(a.onMessage((function(e){return n.dispatchWebSocketMessage(t,i,s,o,e)})),a.init((function(e){e&&n.sendHello(),t.setMouseListener((function(e){n.sendMouse(e)})),i.setModelChangeListener((function(e){n.sendChange(e)}))})),this.websocket=a):y.Z.log(1,"CollabSession.initWebsocket()","exit > No session created")}catch(r){y.Z.error("CollabSession.initWebsocket()","Cannot init WebSocket",r)}}},{key:"hasOtherUsers",value:function(){var e=this,t=this.collabUsers.find((function(t){return t.id!==e.user.id}));return void 0!==t}},{key:"sendChange",value:function(e){y.Z.log(1,"CollabSession.sendChange()","enter",e),this.websocket&&this.hasOtherUsers()?(y.Z.log(2,"CollabSession.sendChange()","send",e),this.websocket.send({type:"change",changeEvent:e})):y.Z.log(2,"CollabSession.sendChange()","NOT SEND")}},{key:"sendMouse",value:function(e){this.websocket&&this.hasOtherUsers()&&this.websocket.send({type:"mouse",pos:e})}},{key:"sendBye",value:function(){y.Z.log(-1,"CollabSession.sendBye()","enter"),this.websocket&&this.websocket.send({type:"bye"})}},{key:"sendHello",value:function(){y.Z.log(2,"CollabSession.sendHello()","enter"),this.websocket&&this.websocket.send({type:"hello"})}},{key:"sendImHere",value:function(){y.Z.log(2,"CollabSession.sendImHere()","enter"),this.websocket&&this.websocket.send({type:"imhere"})}},{key:"dispatchWebSocketMessage",value:function(e,t,i,s,n){"hello"===n.type&&(y.Z.log(2,"CollabSession.dispatchWebSocketMessage()","hello"),i.addCollabUser(n.user),e.addCollabUser(n.user),this.addCollabUser(n.user),this.sendImHere()),"imhere"===n.type&&(y.Z.log(2,"CollabSession.dispatchWebSocketMessage()","imhere"),i.addCollabUser(n.user),e.addCollabUser(n.user),this.addCollabUser(n.user)),"bye"===n.type&&(y.Z.log(2,"CollabSession.dispatchWebSocketMessage()","bye"),i.removeCollabUser(n.user),e.removeCollabUser(n.user),this.removeCollabUser(n.user)),"mouse"===n.type&&e.setCollabMouse(n.user,n.pos),"change"===n.type&&(y.Z.log(2,"CollabSession.dispatchWebSocketMessage()","change"),t.collabRecieveChanges(n.user,n.changeEvent))}},{key:"addCollabUser",value:function(e){y.Z.log(1,"CollabSession.addCollabUser()",e);var t=this.collabUsers.find((function(t){return t.id===e.id}));t||this.collabUsers.push(e)}},{key:"removeCollabUser",value:function(e){y.Z.log(1,"CollabSession.removeCollabUser()",e),this.collabUsers=this.collabUsers.filter((function(t){return t.id!==e.id}))}},{key:"close",value:function(){y.Z.log(1,"CollabSession.dispatchWebSocketMessage()","close"),this.websocket&&this.websocket.close()}}]),e}(),b=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcToolbar MatcAnalyticsToolbar MatcLayerListVisible"},[i("div",{staticClass:"MatcToolbarLayerList MatcToolbarAnalyticList MatcToobarPropertiesSection",style:"width:"+e.layerListWidth+"px"},[i("div",{staticClass:"MatcToolbarLayerListCntr",attrs:{"data-dojo-attach-point":"testListCntr"}}),i("div",{ref:"dndHanlde",staticClass:"MatcToolbarLayerListDND",on:{mousedown:function(t){return t.stopPropagation(),e.onResizeStart.apply(null,arguments)}}})]),i("div",{staticClass:"MatcToolbarTop "},[i("div",{staticClass:"MatcToolbarTopHome",style:"width:"+e.layerListWidth+"px"},[i("HomeMenu",{attrs:{name:e.modelName},on:{select:e.onHomeMenu}})],1),i("div",{staticClass:"MatcToolbarTopCntr",style:"width:calc(100% - "+e.layerListWidth+"px)"},[i("div",{staticClass:"MatcToolbarSection MatcToolbarTopLeft"},[i("div",{class:["MatcToolbarItem MatcToolbarPrimaryItem",{MatcToolbarItemSelected:"addComment"===e.mode}],attrs:{"data-dojo-attach-point":"commentBtn"},on:{click:e.onNewComment}},[i("QIcon",{attrs:{icon:"Comment"}})],1)]),i("div",{staticClass:"MatcToolbarTopCenterCntr"},[i("div",{staticClass:"MatcToolbarSection",attrs:{"data-dojo-attach-point":"screenSection"}},[e.events?i("AnalyticViewModeButton",{on:{change:e.onChangeViewMode}}):e._e()],1)]),i("div",{staticClass:"MatcToolbarNotificationSection MatcToolbarTopRight MatcToolbarSection",attrs:{"data-dojo-attach-point":"notificationSection"}},[i("ViewConfig",{attrs:{value:e.canvasViewConfig,analytic:!0},on:{change:e.onChangeCanvasViewConfig}}),i("HeatmapToggleButton",{attrs:{value:"Heatmap"},on:{change:function(t){return e.$emit("viewModeChange",t)}}}),i("div",{staticClass:"MatcToolbarItem",on:{click:e.showSharing}},[i("div",{staticClass:"MatcToobarPrimaryButton"},[e._v(" Share ")])])],1)])]),i("div",{staticClass:"MatcToobarPropertiesSection MatcToolbarSectionHidden",attrs:{"data-dojo-attach-point":"propertiesCntr"}})])},k=[],Z=(i(68309),i(54747),i(4623)),T=i(53321),_=i(50597),D=i(41474),L=i(55887),x=i(51804),O=i(5781),P=i(16490),W=i(67307),B=i(78943),A=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcDashHistogram"})},H=[],E=(i(23123),i(77907)),V={name:"Histogram",mixins:[D.Z,O.Z,r.Z],data:function(){return{x_prefix:""}},components:{},methods:{postCreate:function(){if(this.log=new M.Z("Histogram"),this.counts){var e=this.counts.split(","),t=new E.Z(e),i=t.hist(null,this.bins);this.setValue(i,t.mean())}},setPopoverFct:function(e){this.popoverLabelFct=e},setLabel:function(e){this.label.innerHTML=e},setMaxMin:function(e){this.minMaxFct=e},setFormTo:function(e){this.toFromFct=e},onHover:function(e){this.hoverFCT=e},setValue:function(e,t){var i=e.size(),s=e.max("count"),n=e.min("count"),o=e.min("from"),a=e.max("to"),r=100/(2*i-1),c=(t-o)/(a-o),h=new L.Z,d=h.div("MatcDashHistogramCntr").build(),u=this;if(e.foreach((function(e,t){var i=e.count,n=h.div("MatcDashHistogramBar").build(d);if(n.style.height=Math.max(1,100*i/s)+"%",n.style.width=r+"%",n.style.left=r*(2*t)+"%",u.hoverFCT){var o=u.hoverFCT(e);l.Z.add(n,"MatcDashHistogramBarHover"),u.addTooltip(n,o)}})),this.toFromFct&&(a=this.toFromFct(a),o=this.toFromFct(o)),h.span("MatcDashHistogramLabelMax MatcDashHistogramLabel",s).build(d),h.span("MatcDashHistogramLabelMin MatcDashHistogramLabel",n).build(d),h.span("MatcDashHistogramLabelFrom MatcDashHistogramLabel",o+this.x_prefix).build(d),h.span("MatcDashHistogramLabelTo MatcDashHistogramLabel",a+this.x_prefix).build(d),this.domNode.innerHTML,this.domNode.appendChild(d),null!=t&&void 0!=t){var g=h.div("MatcDashHistogramLabelMean").build(d);g.style.left=100*c+"%",this.toFromFct&&(t=this.toFromFct(t)),h.span("MatcDashHistogramLabel MatcHorizontalMiddle",t+this.x_prefix).build(g);var v=h.div("MatcDashHistogramBarMean").build(d);v.style.left=100*c+"%"}}},mounted:function(){}},F=V,N=i(43736),R=(0,N.Z)(F,A,H,!1,null,null,null),U=R.exports,I=i(21200),G=i(23241),$=i(85173),z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:" MatcToolbarArrowDropDown MatcToolbarDropDownButton MatcToobarHomeSection MatcToobarHomeSectionBlueX"},[s("div",{ref:"button",staticClass:"MatcToolbarItem MatcToolbarPrimaryItem",attrs:{type:"button"}},[s("img",{attrs:{src:i(38879)}}),s("span",{staticClass:"MatcToobarHomeSectionAppNameLabel"},[e._v(e._s(e.name))]),s("span",{staticClass:"caret"})]),s("div",{staticClass:"MatcToolbarPopUp MatcToolbarDropDownButtonPopup",attrs:{role:"menu","data-dojo-attach-point":"popup"},on:{mousedown:function(e){e.stopPropagation()}}},[s("div",{staticClass:"MatcToolbarPopUpWrapper"},[s("ul",{attrs:{role:"menu"}},e._l(e.items,(function(t){return s("li",{key:t.value,staticClass:"MatcToolbarMenuItem",class:t.css,on:{click:function(i){return i.stopPropagation(),e.onSelect(t,i)}}},[s("label",{staticClass:"MatcToolbarPopUpLabel"},[e._v(e._s(t.label))])])})),0)]),e._m(0)])])},j=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcToolbarPopUpArrowCntr"},[i("div",{staticClass:"MatcToolbarPopUpArrow"})])}],J=i(95037),K={name:"CreateBasicButton",mixins:[_.Z,r.Z,J.Z],props:["name"],data:function(){return{selectedTool:null,tools:[{value:"onExit",icon:"",label:this.getNLS("toolbar.menu.exit")},{value:3,css:"MatcToolbarPopUpLine"},{value:"onShowSettings",icon:"",label:this.getNLS("toolbar.menu.settings")},{value:"showHelp",icon:"",label:this.getNLS("toolbar.menu.help")}]}},computed:{items:function(){return this.tools}},components:{},methods:{onSelect:function(e,t){this.$emit("select",e,t)},onHide:function(){l.Z.remove(this.domNode,"MatcToolbarItemActive"),this.selectedTool=null},init:function(){return(0,a.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}},mounted:function(){}},q=K,X=(0,N.Z)(q,z,j,!1,null,null,null),Q=X.exports,Y=i(98654),ee=i(63403),te=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:["MatcToolbarNavButton",{MatcToolbarEditModeAnimated:e.animated}]},[i("div",{ref:"cntr",staticClass:"MatcToolbarEditModeCntr"},[e._l(e.modes,(function(t,s){return i("a",{key:t.value,ref:"btns",refInFor:!0,class:["MatcToolbarItem vommondToolTipCntr",{MatcToolbarEditModeActive:t.value===e.selected}],on:{click:function(i){return e.setSelected(t,s)}}},[i("span",{ref:"icons",refInFor:!0,class:"MatcToolbarResponsiveIcon "+t.icon}),i("span",{staticClass:"MatcToolbarResponsiveLabel"},[e._v(" "+e._s(t.label)+" ")])])})),i("div",{staticClass:"MatcToolbarEditModeHighlight",style:{width:e.highlightWidth+"px",left:e.highlightX+"px"}})],2)])},ie=[],se=i(3954),ne=i(40626),oe={name:"EditModeButton",mixins:[O.Z,se.Z],props:["value"],data:function(){return{animated:!1,highlightWidth:0,highlightX:0,selected:"showClickHeatMap",modes:[{label:"Heatmaps",value:"showClickHeatMap",icon:"mdi mdi-cursor-default",tooltip:"tooltip.analyics-heatmaps"},{label:"User Journey",value:"showUserJourney",icon:"mdi mdi-vector-polyline",tooltip:"tooltip.analyics-user"},{label:"Tasks & Drop Off",value:"showDropOff",icon:"mdi mdi-chart-timeline-variant-shimmer",tooltip:"tooltip.analyics-task"},{label:"Screens",value:"showScreenMode",icon:"mdi mdi-chart-timeline-variant-shimmer",tooltip:"tooltip.analyics-screen"}]}},computed:{hasData:function(){return!this.value||this.value.hasDataView}},components:{},methods:{setSelected:function(e,t){this.log.log(1,"setSelected","enter",e),this.selected=e.value,this.setHighlight(t),this.$emit("change",e.value)},setHighlight:function(e){var t=this.$refs.btns[e],i=ne.Z.position(t),s=ne.Z.position(this.$refs.cntr);this.highlightWidth=i.w,this.highlightX=i.x-s.x-1},nextView:function(){}},watch:{value:function(e){this.log.log(2,"watch(value)","enter",e),this.value=e}},mounted:function(){var e=this;return(0,a.Z)((0,o.Z)().mark((function t(){return(0,o.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.log=new M.Z("AnalyticViewModeButton"),e.setHighlight(0),setTimeout((function(){e.modes.forEach((function(t,i){var s=e.$refs.btns[i];e.addTooltip(s,e.getNLS(t.tooltip))}))}),100),setTimeout((function(){return e.animated=!0}),500);case 4:case"end":return t.stop()}}),t)})))()}},ae=oe,re=(0,N.Z)(ae,te,ie,!1,null,null,null),le=re.exports,ce=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcToolbar MatcAnalyticsToolbar MatcLayerListVisible"})},he=[],de=(i(21249),i(2707),i(73964)),ue=i(14680),ge=i(42233),ve=i(42711),me=i(27181),pe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcToolbarSessionCntr MatcScrollContainer"},[i("div",{staticClass:"MatcToolbarSessionList "},e._l(e.sortedSession,(function(t){return i("div",{key:t.id,staticClass:"MatcToobarRow MatcToolbarIconButton",on:{click:function(i){return e.toggleSession(t)},mouseout:function(i){return e.onMouseOut(t,i)},dblclick:function(i){return e.onEdit(t)},mouseover:function(i){return e.onMouseOver(t,i)}}},[i("CheckBox",{attrs:{value:e.selected[t.session]}}),i("div",{staticClass:"MatcToolbarSessionLabels"},[t.session===e.selectedSession?i("input",{ref:"sessionInput",refInFor:!0,staticClass:"MatcIgnoreOnKeyPress",domProps:{value:t.label},on:{change:function(i){return e.onChangeSessionLabel(t,i)},click:function(e){e.stopPropagation()}}}):i("span",[e._v(e._s(t.label))]),i("div",{staticClass:"MatcToolbarSessionListDetails"},[i("div",[e._v(e._s(t.date))]),i("div",[e._v(e._s(t.duration)+"s")])])]),i("div",{staticClass:"MatcToobarRowRightIcon"},[i("QIcon",{attrs:{icon:"PlayVideo"},on:{click:function(i){return i.stopPropagation(),e.onPlay(t,i)}}})],1)],1)})),0)])},fe=[],Me=(i(78525),i(73210),{name:"SessionList",props:[],mixins:[r.Z],data:function(){return{sessions:[],selected:{},order:"date",selectedSession:""}},components:{CheckBox:ue.Z,QIcon:ee.Z},computed:{sortedSession:function(){var e=this.order;return this.sessions.toSorted((function(t,i){return"duration"===e?i.duration-t.duration:"date"===e?t.start-i.start:"weirdness"===e?i.weirdness-t.weirdness:i.size-t.size}))}},methods:{onChangeSessionLabel:function(e,t){var i=t.target.value.trim();e.label=i,this.selectedSession=!1,this.emit("label",e.session,i)},onEdit:function(e){var t=this;this.selectedSession=e.session,setTimeout((function(){var e=t.$refs.sessionInput[0];e&&(e.focus(),e.select())}),100)},onPlay:function(e,t){this.emit("play",e,t)},onMouseOver:function(e){this.emit("hover",e)},onMouseOut:function(){this.emit("hover",null)},onChange:function(){this.emit("select",this.selected)},getSelected:function(){return this.selected},toggleSession:function(e){this.$set(this.selected,e.session,!this.selected[e.session]),this.$forceUpdate(),this.onChange()},setSessions:function(e){var t=this;this.sessions=e,this.sessions.forEach((function(e){t.selected[e.session]=!0})),this.onChange()},setOrder:function(e){this.order=e},setAllSelected:function(e){var t=this;this.sessions.forEach((function(i){t.selected[i.session]=e})),this.$forceUpdate()}},mounted:function(){this.logger=new M.Z("SessionList"),this.logger.log(2,"constructor","entry")}}),Ce=Me,Se=(0,N.Z)(Ce,pe,fe,!1,null,null,null),ye=Se.exports,we={name:"AnalyticToolbarRender",mixins:[],data:function(){return{hasSelectAll:!1,hasSessionDetails:!0}},components:{},methods:{renderToolbar:function(){this.logger.log(3,"renderToolbar","enter"),this.isRendered||(this.isRendered=!0,this.logger.log(3,"renderToolbar","exit"))},render:function(){this.logger.log(3,"render","entry"),this.properties=document.createElement("div"),l.Z.add(this.properties,"MatcToobarPropertiesSectionCntr"),this.sections=[],this.propertiesStates={},this.renderScreenProperties(),this.renderScreenModes(),this.renderWidgetProperties(),this.renderSessionProperties(),this.renderSessionSection(),this.renderDropOffProperties(),this.renderHeatMapProperties(),this.renderGestureProperties(),this.propertiesCntr.appendChild(this.properties),this.scroller=this.$new(de.Z),this.scroller.placeAt(this.propertiesCntr),this.scroller.wrap(this.properties,40),this.hideAllSections(),this.showHeatMapProperties(),this.showClickHeatMap(),this.logger.log(3,"render","exit")},renderScreenProperties:function(){this.logger.log(3,"renderScreenProperties","entry");var e=new L.Z;this.screenNameDiv=this.createSection("Screen",this.properties);var t=this.createContent(this.screenNameDiv);this.screenName=this.createInput(t,"Screen Name"),this.screenName.readOnly=!0;var i=e.div("MatcCenter").build(t),s=e.div("MatcMarginBottom").build(i);this.screenTestRing=this.createRing("Test Coverage","analytics.canvas.kpi.coverage"),this.screenTestRing.placeAt(s),s=e.div("MatcMarginBottom").build(i),this.screenDwellRing=this.createRing("Dwell Time","analytics.canvas.kpi.dwell"),this.screenDwellRing.placeAt(s),s=e.div("MatcMarginBottom").build(i),this.screenTotalViewRing=this.createRing("Screen Views","analytics.canvas.kpi.screen-views"),this.screenTotalViewRing.placeAt(s),s=e.div("MatcMarginBottom").build(i),this.screenClickRing=this.createRing("Screen Clicks","analytics.canvas.kpi.screen-clicks"),this.screenClickRing.placeAt(s),s=e.div("MatcMarginBottom").build(i),this.screenWidgetClickRing=this.createRing("Widget Clicks","analytics.canvas.kpi.screen-widget-clicks"),this.screenWidgetClickRing.placeAt(s)},renderWidgetProperties:function(){this.logger.log(3,"renderWidgetProperties","entry");var e=new L.Z;this.widgetNameDiv=this.createSection("Widget ",this.properties);var t=this.createContent(this.widgetNameDiv);this.widgetName=this.createInput(t,"Screen"),this.widgetName.readOnly=!0;var i=e.div("MatcCenter").build(t),s=e.div("MatcMarginBottom").build(i);this.widgetClickRing=this.createRing("Widget Clicks","analytics.canvas.kpi.clicks"),this.widgetClickRing.placeAt(s),s=e.div("MatcMarginBottom").build(i),this.widgetFirstClickRing=this.createRing("First Clicks","analytics.canvas.kpi.first-clicks"),this.widgetFirstClickRing.placeAt(s),s=e.div("MatcMarginBottom").build(i);var n=this.createBigNumber(e,s,"Time before Click","analytics.canvas.kpi.before-click");this.widgetDiscoverLabel=n[0],this.widgetDiscoverSTDLabel=n[1]},renderHeatMapProperties:function(){this.logger.log(1,"renderHeatMapProperties","entry");var e=new L.Z;this.heatmapDiv=this.createSection("Show",this.properties);var t=this.createContent(this.heatmapDiv),i=e.div("MatcToobarRow MatcMarginBottom").build(t),s=this.$new(P.Z);l.Z.add(s.domNode,"MatcToolbarRadioList"),s.setOptions([{value:-1,label:"All Clicks"},{value:1,label:"First Click"},{value:3,label:"First three Clicks"},{value:"missedClicks",label:"Missed Clicks"},{value:"mouse",label:"Mouse"}]),s.placeAt(e.div().build(i)),this.own(s.on("change",m.Z.hitch(this,"showFirstClickHeatMap"))),this.heatmapLabel=e.div("MatcToobarRow").label("MatcToolbarLabel MatcToolbarHelpSection").build(t),this.heatmapClickList=s,this.setHeatMapLabel(-1)},setHeatMapLabel:function(e){var t="";-1===e&&(t=this.getNLS("analytics.canvas.heatamp.hintAll")),1===e&&(t=this.getNLS("analytics.canvas.heatamp.hintFirst")),3===e&&(t=this.getNLS("analytics.canvas.heatamp.hintFirstThree")),"missedClicks"===e&&(t=this.getNLS("analytics.canvas.heatamp.hintMissed")),"mouse"===e&&(t=this.getNLS("analytics.canvas.heatamp.hintMouse")),this.heatmapLabel.textContent=t},renderDropOffProperties:function(){this.logger.log(2,"renderSessionProperties","entry");var e=new L.Z;this.dropOffConfigDiv=this.createSection("Show",this.properties);var t=this.createContent(this.dropOffConfigDiv),i=e.div("MatcToobarRow MatcToolbarRadioList").build(t);this.dropOffTimeCheckBox=this.$new(P.Z,{maxLabelLength:20}),this.dropOffTimeCheckBox.setOptions([{value:!1,label:"Drop Off"},{value:!0,label:"Time"}]),this.dropOffTimeCheckBox.setValue(!1),this.dropOffTimeCheckBox.placeAt(i),this.own((0,p.Z)(this.dropOffTimeCheckBox,"change",m.Z.hitch(this,"selectDropOffTask"))),this.dropOffOptionsDiv=this.createSection("Tasks",this.properties),t=this.createContent(this.dropOffOptionsDiv),i=e.div("MatcToobarRow ").build(t),this.dropOffTaskBtn=this.$new(P.Z,{maxLabelLength:20});var s=[];this.testSettings.tasks&&this.testSettings.tasks.length>=1?s=this.testSettings.tasks.map((function(e,t){return{value:t,label:e.name}})):this.dropOffOptionsLabel=e.span("MatcToolbarLabel MatcToolbarHelpSection",this.getNLS("analytics.canvas.dropoff.hintNoTasksDefined")).build(i),this.dropOffTaskBtn.setOptions(s),this.dropOffTaskBtn.setValue(0),l.Z.add(this.dropOffTaskBtn.domNode,"MatcToolbarRadioList"),this.dropOffTaskBtn.placeAt(i),this.own((0,p.Z)(this.dropOffTaskBtn,"change",m.Z.hitch(this,"selectDropOffTask"))),this.dropOffChartDivCntr=this.createSection("Insights",this.properties),t=this.createContent(this.dropOffChartDivCntr);var n=e.div("MatcCenter ").build(t);this.dropoffTaskSuccess=this.createRing("Success","analytics.canvas.kpi.first-clicks"),l.Z.add(this.dropoffTaskSuccess.domNode,"MatcMarginBottom"),this.dropoffTaskSuccess.placeAt(n);var o=e.div("MatcMarginBottom").build(n),a=this.createBigNumber(e,o,"Duration","analytics.canvas.kpi.before-click");this.dropOffTaskDuration=a[0],this.dropOffTaskDurationLabel=a[1],o=e.div("MatcMarginBottom").build(n),a=this.createBigNumber(e,o,"Interactions","analytics.canvas.kpi.before-click"),this.dropOffInteractions=a[0],this.dropOffInteractionsLabel=a[1],this.dropOffFunnelDivCntr=this.createSection("Drop Off",this.properties),t=this.createContent(this.dropOffFunnelDivCntr),this.dropOffChartDiv=e.div("MatcToolbarDropOffChart","").build(t)},renderSessionProperties:function(){this.logger.log(1,"renderSessionProperties","entry");var e=new L.Z;this.sessionOptionsDiv=this.createSection("Show",this.properties);var t=this.createContent(this.sessionOptionsDiv),i=e.div("MatcToobarRow MatcToolbarRadioList").build(t);this.sessionTreeCheckBox=this.$new(P.Z),this.sessionTreeCheckBox.setOptions([{value:!0,label:"Merged Graph"},{value:!1,label:"Individual Tests"}]),this.sessionTreeCheckBox.setValue(!0),this.sessionTreeCheckBox.placeAt(i),this.own((0,p.Z)(this.sessionTreeCheckBox,"change",m.Z.hitch(this,"showUserJourney"))),i=e.div("MatcToobarRow").build(t),this.sessionOutlierCheckbox=this.$new(ue.Z),l.Z.add(this.sessionOutlierCheckbox.domNode,"MatcToolbarItem"),this.sessionOutlierCheckbox.setValue(!1),this.sessionOutlierCheckbox.setLabel("Show Outlier"),this.sessionOutlierCheckbox.placeAt(i),this.own((0,p.Z)(this.sessionOutlierCheckbox,"change",m.Z.hitch(this,"showUserJourneyOutlier"))),this.sessionOutlierDiv=this.createSection("Colors",this.properties),t=this.createContent(this.sessionOutlierDiv),i=e.div("MatcToobarRow ").build(t),this.sessionLineColor=this.$new(ve.Z,{updateColor:!0,hasCustomColor:!1,hasPicker:!1}),this.sessionLineColor.placeAt(i),this.sessionLineColor.setLabel("Graph"),this.sessionLineColor.setModel(this.model),this.sessionLineColor.setValue("#33b5e5"),l.Z.add(this.sessionLineColor.domNode," hidden"),this.own((0,p.Z)(this.sessionLineColor,"change",m.Z.hitch(this,"showUserJourney"))),this.sessionTaskLineColor=this.$new(ve.Z,{updateColor:!0,hasCustomColor:!1,hasPicker:!1}),this.sessionTaskLineColor.placeAt(i),this.sessionTaskLineColor.setLabel("Task"),this.sessionTaskLineColor.setModel(this.model),this.sessionTaskLineColor.setValue("#92c500"),l.Z.add(this.sessionTaskLineColor.domNode,""),this.own((0,p.Z)(this.sessionTaskLineColor,"change",m.Z.hitch(this,"showUserJourney"))),this.sessionOutlierColor=this.$new(ve.Z,{updateColor:!0,hasCustomColor:!1,hasPicker:!1}),this.sessionOutlierColor.placeAt(i),this.sessionOutlierColor.setLabel("Outlier"),this.sessionOutlierColor.setModel(this.model),this.sessionOutlierColor.setValue("#ffb61c"),l.Z.add(this.sessionOutlierColor.domNode,""),this.own((0,p.Z)(this.sessionOutlierColor,"change",m.Z.hitch(this,"showUserJourney"))),this.sessionShowDiv=this.createSection("Options",this.properties),t=this.createContent(this.sessionShowDiv),i=e.div("MatcToobarRow MatcToolbarRadioList").build(t),this.sessionTimeCheckBox=this.$new(P.Z,{maxLabelLength:20}),this.sessionTimeCheckBox.setOptions([{value:!1,label:"Navigation"},{value:!0,label:"Time"}]),this.sessionTimeCheckBox.setValue(!1),this.sessionTimeCheckBox.placeAt(i),this.own((0,p.Z)(this.sessionTimeCheckBox,"change",m.Z.hitch(this,"showUserJourney"))),this.sessionTaskCntr=this.createSection("Tasks",this.properties),t=this.createContent(this.sessionTaskCntr),i=e.div("MatcToobarRow ").build(t);var s=[{value:-1,label:"No Task"}];if(this.testSettings.tasks)for(var n=0;n<this.testSettings.tasks.length;n++){var o=this.testSettings.tasks[n];s.push({value:n,label:o.name})}this.sessionTaskBtn=this.$new(P.Z,{maxLabelLength:20}),this.sessionTaskBtn.setOptions(s),this.sessionTaskBtn.setValue(-1),l.Z.add(this.sessionTaskBtn.domNode,"MatcToolbarRadioList"),this.sessionTaskBtn.placeAt(i),this.own((0,p.Z)(this.sessionTaskBtn,"change",m.Z.hitch(this,"selectUserJournyTask")))},renderSessionSection:function(){var e=this;this.sessionDiv=this.db.div("MatcToolbarSection").build(this.testListCntr);var t=this.createContent(this.sessionDiv);l.Z.add(t,"MatcMarginBottomXXL");var i=this.db.div("MatcToobarRow").build(t);this.sessionOrderBrn=this.$new(ge.Z,{maxLabelLength:20}),this.sessionOrderBrn.setOptions([{value:"date",label:"Sort by Date",icon:"Calendar"},{value:"duration",label:"Sort by Duration",icon:"Duration"},{value:"events",label:"Sort by Events",icon:"Hash"},{value:"weirdness",label:"Sort by Outlier",icon:"Outlier"},{value:"",css:"MatcToolbarPopUpLine",label:""},{value:"",label:"Select all",callback:function(){return e.selectAllSessions(!0)},icon:"CheckBoxOn"},{value:"",label:"Unselect all",callback:function(){return e.selectAllSessions(!1)},icon:"CheckBoxOff"}]),this.sessionOrderBrn.setPopupCss("MatcActionAnimProperties MatcPopupArrowLeft"),this.sessionOrderBrn.updateLabel=!1,this.sessionOrderBrn.hasFixedLabel=!0,this.sessionOrderBrn.reposition=!0,this.sessionOrderBrn.repositionPosition="right",this.sessionOrderBrn.setValue("date"),this.sessionOrderBrn.setLabel("Test Sessions"),this.sessionOrderBrn.placeAt(i),this.tempOwn((0,p.Z)(this.sessionOrderBrn,"change",(function(t){e.sessionListWidget.setOrder(t)}))),this.sessionList=this._getTestList(this.events,this.annotation,this.testSettings),this.sessionListWidget=this.$new(ye),this.sessionListWidget.placeAt(t),this.sessionListWidget.setSessions(this.sessionList),this.sessionListWidget.on("select",(function(){e.onSessionSelectionChanged()})),this.sessionListWidget.on("hover",(function(t){e.hoverSession(t)})),this.sessionListWidget.on("play",(function(t,i){e.showSession(t,i)})),this.sessionListWidget.on("label",(function(t,i){e.onChangeSessionLabel(t,i)}))},hoverSession:function(e){"UserJourney"===this.analyticMode&&this.canvas&&this.canvas.highlightSession(null===e||void 0===e?void 0:e.session)},showUserJourneyOutlier:function(e){if(e){var t=this.canvas.getOutlierScores();for(var i in this.sessionCheckBoxes){var s=this.sessionCheckBoxes[i];t[i]?l.Z.remove(s.domNode,"MatcToolbarItemStrikeThrough"):l.Z.add(s.domNode,"MatcToolbarItemStrikeThrough")}}else for(var n in this.sessionCheckBoxes){var o=this.sessionCheckBoxes[n];l.Z.remove(o.domNode,"MatcToolbarItemPassive"),l.Z.remove(o.domNode,"MatcToolbarItemStrikeThrough")}this.showUserJourney()},selectUserJournyTask:function(e){if(e>=0){var t=this.testSettings.tasks[e],i=this.canvas.getTaskPerformance();for(var s in this.sessionCheckBoxes){var n=this.sessionCheckBoxes[s];i[s]&&i[s][t.id]?l.Z.remove(n.domNode,"MatcToolbarItemStrikeThrough"):l.Z.add(n.domNode,"MatcToolbarItemStrikeThrough")}}else for(var o in this.sessionCheckBoxes){var a=this.sessionCheckBoxes[o];l.Z.remove(a.domNode,"MatcToolbarItemPassive"),l.Z.remove(a.domNode,"MatcToolbarItemStrikeThrough")}this.showUserJourney()},setSelectSessions:function(e){if(this.sessionCheckBoxes){for(var t in this.sessionCheckBoxes)e.indexOf(t)>=0?this.sessionCheckBoxes[t].setValue(!0):this.sessionCheckBoxes[t].setValue(!1);this.sessionAllCheckBox&&this.sessionAllCheckBox.setValue(!1),this.onSessionSelectionChanged()}},selectAllSessions:function(e){this.sessionListWidget.setAllSelected(e),this.onSessionSelectionChanged()},selectSession:function(){this.onSessionSelectionChanged()},onSessionSelectionChanged:function(){this.logger.log(-1,"onSessionSelectionChanged","enter"),this.reRenderAnalyticMode()},getSelectedSessions:function(){return this.sessionListWidget.getSelected()},onChangeSessionLabel:function(e,t){var i=this.events.find((function(t){return"SessionStart"===t.type&&t.session===e}));i&&i.label!==t&&(i.label=t,this.modelService.updateEvent(this.model.id,i))},_getTestList:function(e,t,i){var s=[];i.tasks||(i.tasks=[],console.warn("_getTestList() > Added missing task array"));var n=new E.Z(e);n.sortBy("time");var o=n.groupBy("session"),a=o.data,r=new E.Z(t).groupBy("reference"),l=new I.Z,c=i.tasks.length,h=l.getMergedTaskPerformance(n,i.tasks,t),d=h.count("session"),u=this.canvas.getOutlierScores(),g=1;for(var v in a){var m="Test ".concat(g),p=a[v],f=this.formatDate(p.min("time"),!0),M=r.get(v),C='<span class="MatchDashStatusSuccess">Valid</span>',S=!0;M&&(S=M.get(0).get("isValid"),S||(C='<span class="MatchDashStatusFailure">Failure</span>'));var y=d.get(v);y||(y=0);var w=p.data.find((function(e){return"SessionStart"===e.type}));w&&w.label&&(m=w.label);var b=new E.Z(p.data),k=b.select("type","in",["ScreenClick","WidgetClick","WidgetChange","ScreenGesture","WidgetGesture"]),Z={session:v,taskPerformance:y+" / "+c,weirdness:u[v],duration:Math.ceil((p.max("time")-p.min("time"))/1e3),date:f,start:p.min("time"),size:k.size(),status:C,isValid:S,id:g,label:m,screens:p.unique("screen")};s.push(Z),g++}return s.sort((function(e,t){return e.id-t.id})),s},renderGestureProperties:function(){var e=new L.Z;this.gestureOptionsDiv=this.createSection("Options",this.properties);var t=this.createContent(this.gestureOptionsDiv),i=e.div("MatcToobarRow MatcMarginBottomXXL").build(t);e.span("MatcToolbarItemLabel","Gesture Color").build(i),this.gestureLineColor=this.$new(ve.Z,{updateColor:!0,hasCustomColor:!1,hasPicker:!1}),this.gestureLineColor.placeAt(i),this.gestureLineColor.setLabel("Line Color"),this.gestureLineColor.setModel(this.model),this.gestureLineColor.setValue("#0099cc"),this.own((0,p.Z)(this.gestureLineColor,"change",m.Z.hitch(this,"showGestureMap")))},renderScreenModes:function(){this.logger.log(3,"renderScreenModes","entry"),this.screenModeDiv=this.createSection("Show",this.properties);var e=this.createContent(this.screenModeDiv),t=this.db.div("MatcToobarRow MatcMarginBottom").build(e),i=this.$new(P.Z);l.Z.add(i.domNode,"MatcToolbarRadioList"),i.setOptions([{label:"Dwell Time",value:"HeatmapDwelTime",icon:"mdi mdi-timelapse"},{label:"Scroll",value:"HeatmapScrollView",icon:"mdi mdi-swap-vertical"},{label:"Scroll Time",value:"HeatmapScrollTime",icon:"mdi mdi-timer"}]),i.setValue("HeatmapDwelTime"),this.screenModeRadioList=i,i.placeAt(t),this.own(i.on("change",m.Z.hitch(this,"showScreenMode")))},showProperties:function(){l.Z.remove(this.propertiesCntr,"MatcToolbarSectionHidden"),this.canvas&&l.Z.add(this.canvas.scrollRight,"MatcCanvasScrollBarRightOpen")},hideProperties:function(){return"UserJourney"==this.analyticMode?(this.hideAllSections(),void this.showSessionProperties()):"HeatmapClick"==this.analyticMode?(this.hideAllSections(),void this.showHeatMapProperties()):void this.hideAllSections()},hideAllSections:function(){this.logger.log(3,"hideAllSections","entry");for(var e=0;e<this.sections.length;e++){var t=this.sections[e];l.Z.add(t,"MatcToolbarSectionHidden")}},setController:function(e){this.logger.log(3,"setController","entry"),this.controller=e},setCanvas:function(e){this.logger.log(3,"setCanvas","entry"),this.canvas=e},setModelFactory:function(e){this.logger.log(3,"setModelFactory","entry"),this.factory=e},setModel:function(e){this.model=this.createInheritedModel(e),this.modelName=e.name,this.renderToolbar(),this.render()},setAnnotation:function(e){this.logger.log(-1,"setAnnotation","enter > # "),this.annotation=e},setTest:function(e){this.logger.log(2,"setTest","enter > # "),this.testSettings=e},setEvents:function(e){this.logger.log(2,"setEvents","enter > # "+e.length),this.events=e},setMode:function(e){this.logger.log(2,"setMode","entry > '"+e+"'"),this.mode=e,this.onModeChange()},onModeChange:function(){},setSelectedViewButton:function(){},createRing:function(e,t,i){var s="#cecece",n=this.canvas.getSettings();"MatcDark"==n.canvasTheme&&(s="#777");var o=this.$new(B.Z,{size:100,width:5,backgroundColor:s,color:"#365fff",color2:"#83b600",color3:"#ffa713"});return o.setDomSize(120,120),o.setLabel(e),i&&(o.setAction("mdi mdi-chart-bar"),this.tempOwn(o.on("action",m.Z.hitch(this,i)))),t&&(o.setHelp(!0),this.tempOwn(o.on("help",m.Z.hitch(this,"showHelpDialog",t)))),l.Z.add(o.domNode,"MatcMarginTop"),o},createToolBarItem:function(e,t,i,s){var n=document.createElement("div");if(l.Z.add(n,"MatcToolbarItem MatcToolbarPrimaryItem"),i){var o=document.createElement("span");l.Z.add(o,i),n.appendChild(o)}return t&&this.tempOwn((0,p.Z)(n,Z.Z.press,m.Z.hitch(this,t))),s?s.appendChild(n):this.properties.appendChild(n),n},createInput:function(e,t){var i=document.createElement("div");l.Z.add(i,"MatcToolbarItem"),e.appendChild(i);var s=document.createElement("input");return s.disabled=!0,l.Z.add(s,"MatcIgnoreOnKeyPress MatcToobarInput  MatcToobarInlineEditDisabled"),i.appendChild(s),t&&(s.placeholder=t),s},createContent:function(e){var t=document.createElement("div");return l.Z.add(t,"MatcToolbarSectionContent"),e.appendChild(t),t},createSection:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=document.createElement("div");l.Z.add(s,"MatcToolbarSection");var n=this.createSectionHeader(s,e);return this.own((0,p.Z)(n,Z.Z.press,(function(){return l.Z.toggle(s,"MatcToolbarSectionCollabsed"),!1}))),i&&this.sections.push(s),t.appendChild(s),s},createSectionHeader:function(e,t,i){var s=document.createElement("div");if(l.Z.add(s,"MatcToolbarSectionLabel"),e.appendChild(s),s.innerHTML=t,i){var n=document.createElement("span");l.Z.add(n,"MatcToolbarSectionMarker"),n.innerHTML=" *",s.appendChild(n)}var o=document.createElement("span");return l.Z.add(o,"MatcToolbarSectionChevron mdi mdi-chevron-down"),s.appendChild(o),s},createBigNumber:function(e,t,i,s){var n=e.div("MatcToolBarNumberCntr MatcMarginTop").build(t),o=e.div("MatcDashLabel",i).build(n),a=e.div("MatcToolbarBigLabel").build(n),r=e.div("MatcToolbarDetailLabel").build(n);if(s){var l=e.span("mdi mdi-help-circle MatcHelpIcon").build(o);this.tempOwn((0,p.Z)(l,Z.Z.press,m.Z.hitch(this,"showHelpDialog",s)))}return[a,r]},onExit:function(){this.logger.log(0,"onExit","entry",this.isPublic),this.isPublic?(0,T.Z)("#/examples/"+this.model.id+"/design.html"):(0,T.Z)("#/apps/"+this.model.id+"/design.html")},onShare:function(){this.logger.log(0,"onShare","entry")},onWidgetSelected:function(e){this.logger.log(2,"onWidgetSelected","entry"),this._selectedWidget&&this._selectedWidget.id!=e.id&&(this.logger.log(3,"onWidgetSelected","exit > no new selection!"),this.blurWidgetProperties()),this.cleanUp(),this._selection="widget",this._selectedWidget=e,this.showWidgetProperties(e),this.logger.log(3,"onWidgetSelected","exit")},onScreenSelected:function(e){this.logger.log(-1,"onScreenSelected","entry",this._selectedScreen),this._selectedScreen&&this._selectedScreen.id==e.id?this.logger.log(3,"onScreenSelected","exit > no new selection!"):(this.cleanUp(),this._selection="screen",this._selectedScreen=e,this.showScreenProperties(e),this.logger.log(4,"onScreenSelected","exit"))},onLineSelected:function(e){this.cleanUp(),this._selection="line",this._selectedLine=e},onMultiSelect:function(e){this.cleanUp(),this._selection="multi",this._selectedMulti=e},onGroupSelect:function(e){this.cleanUp(),this._selection="group",this._selectedGroup=e,this.showGroupProperties(e)},onCanvasSelected:function(){this.cleanUp(),this.hideProperties()},updatePropertiesView:function(){this._selectedWidget&&this.onWidgetSelected(this._selectedWidget)},showSession:function(e,t){var i=this,s=e.session,n=new x.Z,o=new L.Z,a=o.div("MatcDialog MatcPlayerDialog ").build(),r=o.div("").build(a);n.onOpen((function(){i.isPublic?Promise.all([i.modelService.findPublicTagAnnotations(i.model.id),i.modelService.findPublicMouseBySession(i.model.id,s)]).then((function(e){i._showSession(s,r,n,e)})):Promise.all([i.modelService.findTagAnnotations(i.model.id),i.modelService.findMouseBySession(i.model.id,s)]).then((function(e){i._showSession(s,r,n,e)}))})),n.popup(a,t.target)},_showSession:function(e,t,i,s){try{var n=s[1],o=new E.Z(this.events);o.sortBy("time");var a=o.groupBy("session"),r=a.get(e),l=this.$new(me.Z);l.setDialog(i),l.placeAt(t),l.setModel(this.model),l.setTestSettings(this.testSettings),l.setMouse(n),l.setMouse(n),l.setSession(r,e),i.own((0,p.Z)(i,"close",(function(){l.destroy()})))}catch(c){console.error(c)}},_getSessionAnnotation:function(e,t){if(e.length>1)for(var i=1;i<e.length;i++){var s=e[i];this._doDelete("rest/annotations/apps/"+t+"/"+s.id+".json")}return e.length>=1?e[0]:{appID:t,type:"tags",reference:"",sessions:{}}},onShowSettings:function(e){var t=new L.Z;t=new L.Z;var i=t.div("MatcDialog MatcHeaderDialog MatcPadding").build(),s=t.div("").build(i),n=this.canvas.getSettings();t.label("","Theme :").build(s);var o=this.$new(P.Z);o.setOptions([{value:"MatcDark",label:"Dark"},{value:"MatcLight",label:"Light"}]),o.setValue(n.canvasTheme),o.placeAt(s),t.label("MatcMarginTop","Mouse Wheel / Touchpad Scroll :").build(s);var a=this.$new(P.Z);a.setOptions([{value:"scroll",label:"Scroll Canvas"},{value:"zoom",label:"Zoom Canvas"}]),a.setValue(n.mouseWheelMode),a.placeAt(s);var r=t.div("MatcButtonBar MatcMarginTopXL").build(i),l=t.a("MatcButton MatcButtonPrimary","Save").build(r),c=t.a(" MatcLinkButton ","Cancel").build(r),h=new x.Z;h.own((0,p.Z)(c,Z.Z.press,m.Z.hitch(h,"close"))),h.own((0,p.Z)(l,Z.Z.press,m.Z.hitch(this,"onSaveSettings",h,o,a))),h.popup(i,e.target),this.canvas.enableMouseZoom(!1),this.canvas.setState("simulate"),this.logger.log(0,"onShowSettings","exit > ")},onSaveSettings:function(e,t,i){var s={canvasTheme:t.getValue(),mouseWheelMode:i.getValue()};this.canvas.setSettings(s),this.canvas.enableMouseZoom(!0),e.close()},showSignUpDialog:function(e){var t=new x.Z,i=new L.Z,s=i.div("MatcDialog ").build();this._createSignUpForm(t,s),t.popup(s,e.target)},_createSignUpForm:function(e,t){var i=this.$new(W.Z);return i.render([{label:"Email",name:"email",type:"text",required:"true",placeholder:"Your email",css:"input-lg MatcIgnoreOnKeyPress",error:"We need your email."},{label:"Password",name:"password",type:"password",min:6,placeholder:"Your password",css:"input-lg MatcIgnoreOnKeyPress",error:"The password should have at least six characters."},{label:'I have read the <a href="#/termsofservice.html" target="_blank">terms of service</a>',name:"tos",type:"check",required:"true",css:"MatcFormCheckBox MatcIgnoreOnKeyPress",error:"You must accept the terms of service!"}],[{label:"Cancel",css:"MatcLinkButton",click:m.Z.hitch(e,"close")},{label:"Create Free Account",css:"MatcButton MatchButtonGreen",click:m.Z.hitch(this,"_signUpAndNew",e,i)}]),i.placeAt(t),i.startup(),i},_signUpAndNew:function(e,t,i){var s=t.validateForm(null,!0);if(s)if(n=this._doPost("rest/user",i),"error"==n.type)n.errors.indexOf("user.email.not.unique")>=0?t.showError("The email is already taken! Please enter another one!","email"):t.showError("Something went wrong! Please try again!",""),e.shake();else{e.close();var n=this._doPost("rest/login/",i);"error"!=n.type?window.location.href="/my-account.html":console.error("_signUpAndSave() > Could not sign in user")}else e.shake()}},mounted:function(){this.db=new L.Z}},be=we,ke=(0,N.Z)(be,ce,he,!1,null,null,null),Ze=ke.exports,Te=i(48459),_e=i(26110),De={name:"AnalyticToolbar",mixins:[_.Z,D.Z,O.Z,r.Z,Ze],data:function(){return{mode:"",modelName:"Loading...",events:null,model:null,user:null,value:!1,analyticMode:"HeatmapClick",analyticHeatMapClicks:-1,canvasViewConfig:{},layerListWidth:256}},components:{ViewConfig:$.Z,HomeMenu:Q,QIcon:ee.Z,AnalyticViewModeButton:le,HeatmapToggleButton:_e.Z},methods:{postCreate:function(){this.logger=new M.Z("AnalyticToolbar"),this.logger.log(2,"constructor","entry"),this.renderToolbar(),this.initLayer()},setCommentService:function(e){this.logger.log(3,"setCommentService","entry"),this.commentService=e},onMove:function(e){this.stopEvent(e),this.canvas.setMode("move")},onEdit:function(e){this.stopEvent(e),this.canvas.setMode("edit")},showHelpDialog:function(e){this.$refs.helpBtn&&this.$refs.helpBtn.show("analytics.canvas",e)},onHomeMenu:function(e,t){this.logger.log(1,"onHomeMenu","entry",t),this[e.value]&&this[e.value](t)},onChangeViewMode:function(e){this.logger.log(-1,"onChangeViewMode","entry",e),this[e]&&this[e]()},showHelp:function(e){var t=new x.Z,i=new L.Z,s=i.div("MatcDialog MatcHelpDialog MatcPadding").build();t.popup(s,e.target);var n=this.$new(Y.Z);n.placeAt(s)},onNewComment:function(e){this.logger.log(2,"onNewComment","entry"),this.stopEvent(e),this.emit("newComment",{type:"comment",event:e})},setAnalyticMode:function(e,t,i){this.logger.log(2,"setAnalyticMode","entry > mode: "+e),this.analyticMode=e,this.analyticModeCallback=i,i||console.warn("setAnalyticMode() called with callback",this.mode),this.canvas&&this.canvas.setAnalyticMode(e,t),this.hideProperties()},onCanvasSelected:function(){this.logger.log(-2,"onCanvasSelected","entry > mode: "+this.analyticMode),"HeatmapClick"===this.analyticMode&&(this.hideAllSections(),this.showHeatMapProperties())},reRenderAnalyticMode:function(){this.logger.log(-2,"reRenderAnalyticMode","entry",this.analyticMode),this.analyticModeCallback?this.analyticModeCallback():this.logger.error("reRenderAnalyticMode","No callback")},setModelService:function(e){this.modelService=e,setTimeout(m.Z.hitch(this,"initMouseData"),500)},setPublic:function(e){this.isPublic=e},setCanvasViewConfig:function(e){this.canvasViewConfig=e},onChangeCanvasViewConfig:function(e,t){this.canvas&&this.canvas.setCanvasViewConfig(e,t)},setUser:function(e){this.user=e},initMouseData:function(){var e=this;return(0,a.Z)((0,o.Z)().mark((function t(){var i,s;return(0,o.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.logger.log(2,"initMouseData","entry"),!e.isPublic){t.next=8;break}return t.next=4,e.modelService.findPublicMouse(e.model.id);case 4:i=t.sent,e.setMouseData(i),t.next=12;break;case 8:return t.next=10,e.modelService.findMouse(e.model.id);case 10:s=t.sent,e.setMouseData(s);case 12:case"end":return t.stop()}}),t)})))()},setMouseData:function(e){this.logger.log(2,"setMouseData","entry >"+e.length),this.mouseData=e},showSharing:function(e){var t=this;return(0,a.Z)((0,o.Z)().mark((function i(){var s,n,a,r,l,c,h,d,u,g,v;return(0,o.Z)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return t.logger.log(-1,"showSharing","entry > ",t.isPublic),i.next=3,t.modelService.findInvitation(t.model.id);case 3:for(a in s=i.sent,n={},s)n[s[a]]=a;r=new L.Z,l=r.div("MatcDialog MatcInfitationDialog MatcInfitationDialogLarge MatcPadding").build(),c=r.div("container").build(l),h=r.div("row").build(c),d=r.div("col-md-12").build(h),r.h3("",t.getNLS("share.Headline")).build(d),u=t.$new(G.Z),u.placeAt(d),u.setInvitation(n[1]),u.setPublic(t.isPublic),h=r.div("row MatcMarginTop").build(c),d=r.div("col-md-12 MatcButtonBar").build(h),g=r.div("MatcButton MatcButtonPrimary","Close").build(d),v=new x.Z,v.own((0,p.Z)(g,Z.Z.press,m.Z.hitch(v,"close"))),v.popup(l,e.target);case 22:case"end":return i.stop()}}),i)})))()},onResizeStart:function(e){var t=this,i=this.layerListWidth;(0,Te.z)(e,(function(e){var s=i+e.x;t.layerListWidth=Math.min(Math.max(196,s),400),localStorage.setItem("quxLayerListWidth",t.layerListWidth),t.setLayerListWidth(t.layerListWidth)}))},initLayer:function(){this.logger.log(-2,"initLayer","entry");var e=localStorage.getItem("quxLayerListWidth");e&&!isNaN(1*e)&&this.setLayerListWidth(1*e)},setLayerListWidth:function(e){this.layerListWidth=e,this.canvas&&this.canvas.setLayerListWidth(e)},showClickHeatMap:function(){var e=this;this.logger.log(-2,"showClickHeatMap","entry > "+this.analyticHeatMapClicks),this.setAnalyticMode("HeatmapClick",{numberOfClicks:this.analyticHeatMapClicks,sessions:this.getSelectedSessions()},(function(){return e.showClickHeatMap()})),this.showHeatMapProperties()},showFirstClickHeatMap:function(e){var t=this;this.logger.log(-1,"showFirstClickHeatMap","entry > "+e),this.analyticHeatMapClicks=e,this.setHeatMapLabel(e),"mouse"===e?this.showMouseHeatMap():this.setAnalyticMode("HeatmapClick",{numberOfClicks:this.analyticHeatMapClicks,sessions:this.getSelectedSessions()},(function(){return t.showFirstClickHeatMap(e)}))},showMouseHeatMap:function(){var e=this;this.logger.log(-2,"showMouseHeatMap","entry"),this.mouseData?(this.canvas.setMouseData(this.mouseData),this.setAnalyticMode("HeatmapMouse",{sessions:this.getSelectedSessions()},(function(){return e.showMouseHeatMap()}))):(this.canvas.showHint("Loading data..."),this.isPublic?this._doGet("/examples/mouse/"+this.model.id+".json",m.Z.hitch(this,"_onMouseDataLoaded")):this._doGet("rest/mouse/"+this.model.id+".json",m.Z.hitch(this,"_onMouseDataLoaded"))),this.showHeatMapProperties()},_onMouseDataLoaded:function(e){var t=this;this.logger.log(2,"_onMouseDataLoaded","entry >"+e.length),this.mouseData=e,this.canvas.setMouseData(this.mouseData),this.setAnalyticMode("HeatmapMouse",{sessions:this.getSelectedSessions()},(function(){return t.showMouseHeatMap()}))},showViewMap:function(){var e=this;this.logger.log(2,"showViewMap","entry"),this.setAnalyticMode("HeatmapViews",{sessions:this.getSelectedSessions()},(function(){return e.showViewMap()}))},showDropOff:function(){this.logger.log(-1,"showDropOff","entry"),this.showDropOffProperties()},showUserJourney:function(){var e=this;this.logger.log(-1,"showUserJourney","entry > ");var t={sessions:this.getSelectedSessions(),time:this.sessionTimeCheckBox.getValue(),color:this.sessionLineColor.getValue(),tree:this.sessionTreeCheckBox.getValue(),task:this.sessionTaskBtn.getValue(),taskColor:this.sessionTaskLineColor.getValue(),outlier:this.sessionOutlierCheckbox.getValue(),outlierColor:this.sessionOutlierColor.getValue()};this.setAnalyticMode("UserJourney",t,(function(){return e.showUserJourney()})),this.showSessionProperties()},showGestureMap:function(){var e=this;this.logger.log(2,"showGestureMap","entry > "),this.setAnalyticMode("Gesture",{color:this.gestureLineColor.getValue(),sessions:this.getSelectedSessions()},(function(){return e.showGestureMap()})),this.showGestureProperties()},showScreenMode:function(){var e=this,t=this.screenModeRadioList.getValue();this.setAnalyticMode(t,{sessions:this.getSelectedSessions()},(function(){return e.showScreenMode()})),l.Z.remove(this.screenModeDiv,"MatcToolbarSectionHidden"),this.logger.log(-1,"showScreenMode","exit > ",t)},changeScreenMode:function(e){this.logger.log(0,"changeScreenMode","entry > ",e)},showDwellDistribution:function(e){if(this.logger.log(0,"showDwellDistribution","entry > "),this._selectedScreen){var t=new E.Z(this.events),i=new I.Z,s=i.getScreenTimeGrouping(t),n=s.get(this._selectedScreen.id);if(n){var o=new L.Z,a=new x.Z,r=o.div("MatcPadding DashTaskListDetailsDialog").build();o.h2("MatcDialogTitle","Dwell Time Distribution &quot"+this._selectedScreen.name+"&quot").build(r);var l=o.div("DashTaskListDialogHist").build(r),c=n.hist(null,10),h=this.$new(U);h.setFormTo((function(e){return Math.round(e/1e3)+" sec"})),h.onHover((function(e){return Math.round(e.from/1e3)+" - "+Math.round(e.to/1e3)+" sec ("+e.count+" x)"})),h.setValue(c,n.mean()),h.placeAt(l),a.popup(r,e.target)}}},showGestureProperties:function(){this.logger.log(1,"showGestureProperties","entry > "),this.showProperties(),l.Z.remove(this.gestureOptionsDiv,"MatcToolbarSectionHidden")},showWidgetProperties:function(e){this.logger.log(1,"showWidgetProperties","entry > "+e.id+" "+e.name),this.showProperties(),l.Z.remove(this.widgetNameDiv,"MatcToolbarSectionHidden"),this.widgetName.value=e.name;var t=this.canvas.getWidgetData(e);if(t[e.id]){var i=t[e.id];this.widgetClickRing.setPs(i.clicksRel),this.widgetClickRing.setValue(i.clicksAbs),isNaN(i.firstClicksRelScreen)&&(i.firstClicksRelScreen=0),this.widgetFirstClickRing.setPs(i.firstClicksRelScreen),this.widgetFirstClickRing.setValue(i.firstClicksAbs),this.setTextContent(this.widgetDiscoverSTDLabel,"+/-"+Math.round(i.discoverTimeStd/1e3)+"s"),this.setTextContent(this.widgetDiscoverLabel,Math.round(i.discoverTimeAbs/1e3)+"s")}},showScreenProperties:function(e){var t,i,s,n,o;this.logger.log(-1,"showScreenProperties","entry"),this.showProperties(),l.Z.remove(this.screenNameDiv,"MatcToolbarSectionHidden"),this.screenName.value=e.name,e.style.overlay?(t=this.canvas.getOverlayDwellTime(),i=this.canvas.getOverlayViews(),s=this.canvas.getOverlayClicks(),n=this.canvas.getOverlayWidgetClicks(),o=this.canvas.getOverlayTest()):(t=this.canvas.getScreenDwellTime(),i=this.canvas.getScreenViews(),s=this.canvas.getScreenClicks(),n=this.canvas.getScreenWidgetClicks(),o=this.canvas.getScreenTests());var a=t.times[e.id];a||(a=0);var r=s.clicks[e.id],c=n.clicks[e.id],h=r+c,d=a/t.sessions,u=i.counts[e.id];u||(u=0);var g=o.counts[e.id];g||(g=0),this.screenTotalViewRing.setValue(u),this.screenTotalViewRing.setPs(u/i.total),this.screenTestRing.setValue(g),this.screenTestRing.setPs(g/o.sessions),this.screenClickRing.setPs(r/h),this.screenClickRing.setValue(r),this.screenWidgetClickRing.setPs(c/h),this.screenWidgetClickRing.setValue(c),this.screenDwellRing.setPs(a/t.total),this.screenDwellRing.setValue(Math.round(d/1e3)+"s")},showSessionProperties:function(){this.logger.log(1,"showSessionProperties","entry"),this.showProperties(),l.Z.remove(this.sessionOptionsDiv,"MatcToolbarSectionHidden"),this.sessionTreeCheckBox.getValue()?(l.Z.add(this.sessionTaskCntr,"MatcToolbarSectionHidden"),l.Z.add(this.sessionLineColor.domNode,"hidden"),l.Z.add(this.sessionTaskBtn.domNode,"hidden"),l.Z.remove(this.sessionShowDiv,"MatcToolbarSectionHidden"),l.Z.add(this.sessionLineColor.domNode,"hidden"),l.Z.add(this.sessionOutlierDiv,"MatcToolbarSectionHidden"),l.Z.add(this.sessionOutlierCheckbox.domNode,"hidden")):(l.Z.remove(this.sessionTaskCntr,"MatcToolbarSectionHidden"),l.Z.remove(this.sessionLineColor.domNode,"hidden"),l.Z.remove(this.sessionTaskBtn.domNode,"hidden"),l.Z.add(this.sessionShowDiv,"MatcToolbarSectionHidden"),l.Z.remove(this.sessionLineColor.domNode,"hidden"),l.Z.remove(this.sessionOutlierDiv,"MatcToolbarSectionHidden"),l.Z.remove(this.sessionOutlierCheckbox.domNode,"hidden"))},selectDropOffTask:function(){this.showDropOffProperties()},showDropOffProperties:function(){var e=this;this.logger.log(0,"showDropOffProperties","entry");var t=this.dropOffTaskBtn.getValue(),i=this.testSettings.tasks[t];i?(this.setAnalyticMode("DropOff",{time:this.dropOffTimeCheckBox.getValue(),task:i,color:"#ccc"},(function(){return e.showDropOffProperties()})),l.Z.remove(this.dropOffConfigDiv,"MatcToolbarSectionHidden"),l.Z.remove(this.dropOffOptionsDiv,"MatcToolbarSectionHidden"),l.Z.remove(this.dropOffChartDivCntr,"MatcToolbarSectionHidden"),this.showDropOffChart(i),this.showProperties()):(this.setAnalyticMode("DropOff",{time:this.dropOffTimeCheckBox.getValue(),task:null,color:"#ccc"},(function(){return e.showDropOffProperties()})),l.Z.remove(this.dropOffConfigDiv,"MatcToolbarSectionHidden"),l.Z.remove(this.dropOffOptionsDiv,"MatcToolbarSectionHidden"),this.showProperties())},showDropOffChart:function(e){var t=new E.Z(this.events),i=new I.Z,s=i.getFunnelSummary(t,e,this.annotation),n=s[s.length-1];this.dropoffTaskSuccess.setPs(n.p),this.dropoffTaskSuccess.setValue(Math.round(100*n.p)+"%"),this.dropOffTaskDuration.innerText=Math.round(n.durationMean/100)/10+"s",this.dropOffTaskDurationLabel.innerText="+/-"+Math.round(n.durationStd/100)/10+"s",this.dropOffInteractions.innerText=Math.round(n.interactionsMean),this.dropOffInteractionsLabel.innerText="+/-"+Math.round(n.interactionsStd)},showDropOffFunnel:function(e){var t=this;this.dropOffChartDiv.innerHTML="";var i=new L.Z,s=i.div().build();e.forEach((function(e,n){if(e.event){i.span("MatcDashLabel",t.getNiceEventLabel(e.event,n)).build(s);var o=i.div("MatcToolbarDropOffChartBar",Math.round(100*e.p)+"%").build(s);o.style.background=t.greenToRed(e.p),o.style.width=100*e.p+"%"}})),this.dropOffChartDiv.appendChild(s)},getNiceEventLabel:function(e,t){if(this.model){var i=[];if(e.widget){if("WidgetGesture"!=e.type||!e.gesture)return!e.state||"WidgetClick"!=e.type&&"WidgetChange"!=e.type?this.getEventLabel(e.type)+" -  "+this.getWidgetName(e.widget)+" @ "+this.getScreenName(e.screen):this.getEventStateLabel(e.state)+" -  "+this.getWidgetName(e.widget)+" @ "+this.getScreenName(e.screen);var s=e.gesture;i=[this.getGestureLabel(s.type),this.getWidgetName(e.widget)]}else if("ScreenGesture"==e.type&&e.gesture){var n=e.gesture;i=["Screen "+this.getGestureLabel(n.type),this.getScreenName(e.screen)]}else i=[this.getEventLabel(e.type),this.getScreenName(e.screen)];return i[0]+" - "+i[1]}return this.getNLS("dash.perf.dropoff.step")+t},showHeatMapProperties:function(){this.showProperties(),l.Z.remove(this.heatmapDiv,"MatcToolbarSectionHidden"),this.heatmapClickList.setValue(this.analyticHeatMapClicks)},showProperties:function(){l.Z.remove(this.propertiesCntr,"MatcToolbarSectionHidden"),this.canvas&&l.Z.add(this.canvas.scrollRight,"MatcCanvasScrollBarRightOpen")},hideProperties:function(){return console.debug("hideProperties() > enter"),"UserJourney"==this.analyticMode?(this.hideAllSections(),void this.showSessionProperties()):"HeatmapClick"==this.analyticMode?(this.hideAllSections(),void this.showHeatMapProperties()):void this.hideAllSections()},hideAllSections:function(){this.logger.log(3,"hideAllSections","entry");for(var e=0;e<this.sections.length;e++){var t=this.sections[e];l.Z.add(t,"MatcToolbarSectionHidden")}},setController:function(e){this.logger.log(3,"setController","entry"),this.controller=e},setCanvas:function(e){this.logger.log(3,"setCanvas","entry"),this.canvas=e},setModelFactory:function(e){this.logger.log(3,"setModelFactory","entry"),this.factory=e},setModel:function(e){this.model=this.createInheritedModel(e),this.modelName=e.name,this.renderToolbar(),this.render()},setAnnotation:function(e){this.logger.log(-1,"setAnnotation","enter > # "),this.annotation=e},setTest:function(e){this.logger.log(2,"setTest","enter > # "),this.testSettings=e},setEvents:function(e){this.logger.log(2,"setEvents","enter > # "+e.length),this.events=e},setMode:function(e){this.logger.log(2,"setMode","entry > '"+e+"'"),this.mode=e,this.onModeChange()},onModeChange:function(){},setSelectedViewButton:function(){},createRing:function(e,t,i){var s="#cecece",n=this.canvas.getSettings();"MatcDark"==n.canvasTheme&&(s="#777");var o=this.$new(B.Z,{size:100,width:5,backgroundColor:s,color:"#365fff",color2:"#83b600",color3:"#ffa713"});return o.setDomSize(120,120),o.setLabel(e),i&&(o.setAction("mdi mdi-chart-bar"),this.tempOwn(o.on("action",m.Z.hitch(this,i)))),t&&(o.setHelp(!0),this.tempOwn(o.on("help",m.Z.hitch(this,"showHelpDialog",t)))),l.Z.add(o.domNode,"MatcMarginTop"),o},createToolBarItem:function(e,t,i,s){var n=document.createElement("div");if(l.Z.add(n,"MatcToolbarItem MatcToolbarPrimaryItem"),i){var o=document.createElement("span");l.Z.add(o,i),n.appendChild(o)}return t&&this.tempOwn((0,p.Z)(n,Z.Z.press,m.Z.hitch(this,t))),s?s.appendChild(n):this.properties.appendChild(n),n},createInput:function(e,t){var i=document.createElement("div");l.Z.add(i,"MatcToolbarItem"),e.appendChild(i);var s=document.createElement("input");return s.disabled=!0,l.Z.add(s,"MatcIgnoreOnKeyPress MatcToobarInput  MatcToobarInlineEditDisabled"),i.appendChild(s),t&&(s.placeholder=t),s},createContent:function(e){var t=document.createElement("div");return l.Z.add(t,"MatcToolbarSectionContent"),e.appendChild(t),t},createSection:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=document.createElement("div");l.Z.add(s,"MatcToolbarSection");var n=this.createSectionHeader(s,e);return this.own((0,p.Z)(n,Z.Z.press,(function(){return l.Z.toggle(s,"MatcToolbarSectionCollabsed"),!1}))),i&&this.sections.push(s),t.appendChild(s),s},createSectionHeader:function(e,t,i){var s=document.createElement("div");if(l.Z.add(s,"MatcToolbarSectionLabel"),e.appendChild(s),s.innerHTML=t,i){var n=document.createElement("span");l.Z.add(n,"MatcToolbarSectionMarker"),n.innerHTML=" *",s.appendChild(n)}var o=document.createElement("span");return l.Z.add(o,"MatcToolbarSectionChevron mdi mdi-chevron-down"),s.appendChild(o),s},createBigNumber:function(e,t,i,s){var n=e.div("MatcToolBarNumberCntr MatcMarginTop").build(t),o=e.div("MatcDashLabel",i).build(n),a=e.div("MatcToolbarBigLabel").build(n),r=e.div("MatcToolbarDetailLabel").build(n);if(s){var l=e.span("mdi mdi-help-circle MatcHelpIcon").build(o);this.tempOwn((0,p.Z)(l,Z.Z.press,m.Z.hitch(this,"showHelpDialog",s)))}return[a,r]},onExit:function(){this.logger.log(0,"onExit","entry",this.isPublic),this.isPublic?(0,T.Z)("#/examples/"+this.model.id+"/design.html"):(0,T.Z)("#/apps/"+this.model.id+"/design.html")},onShare:function(){this.logger.log(0,"onShare","entry")},onWidgetSelected:function(e){this.logger.log(2,"onWidgetSelected","entry"),this._selectedWidget&&this._selectedWidget.id!=e.id&&(this.logger.log(3,"onWidgetSelected","exit > no new selection!"),this.blurWidgetProperties()),this.cleanUp(),this._selection="widget",this._selectedWidget=e,this.showWidgetProperties(e),this.logger.log(3,"onWidgetSelected","exit")},onScreenSelected:function(e){this.logger.log(-1,"onScreenSelected","entry",this._selectedScreen),this._selectedScreen&&this._selectedScreen.id==e.id?this.logger.log(3,"onScreenSelected","exit > no new selection!"):(this.cleanUp(),this._selection="screen",this._selectedScreen=e,this.showScreenProperties(e),this.logger.log(4,"onScreenSelected","exit"))},onLineSelected:function(e){this.cleanUp(),this._selection="line",this._selectedLine=e},onMultiSelect:function(e){this.cleanUp(),this._selection="multi",this._selectedMulti=e},onGroupSelect:function(e){this.cleanUp(),this._selection="group",this._selectedGroup=e,this.showGroupProperties(e)},updatePropertiesView:function(){this._selectedWidget&&this.onWidgetSelected(this._selectedWidget)},onShowSettings:function(e){var t=new L.Z;t=new L.Z;var i=t.div("MatcDialog MatcHeaderDialog MatcPadding").build(),s=t.div("").build(i),n=this.canvas.getSettings();t.label("","Theme :").build(s);var o=this.$new(P.Z);o.setOptions([{value:"MatcLight",label:"Light"},{value:"MatcDark",label:"Dark"},{value:"MatcAuto",label:"Auto"}]),o.setValue(n.canvasTheme),o.placeAt(s),t.label("MatcMarginTop","Mouse Wheel / Touchpad Scroll :").build(s);var a=this.$new(P.Z);a.setOptions([{value:"scroll",label:"Scroll Canvas"},{value:"zoom",label:"Zoom Canvas"}]),a.setValue(n.mouseWheelMode),a.placeAt(s);var r=t.div("MatcButtonBar MatcMarginTopXL").build(i),l=t.a("MatcButton MatcButtonPrimary","Save").build(r),c=t.a(" MatcLinkButton ","Cancel").build(r),h=new x.Z;h.own((0,p.Z)(c,Z.Z.press,m.Z.hitch(h,"close"))),h.own((0,p.Z)(l,Z.Z.press,m.Z.hitch(this,"onSaveSettings",h,o,a))),h.popup(i,e.target),this.canvas.enableMouseZoom(!1),this.canvas.setState("simulate"),this.logger.log(0,"onShowSettings","exit > ")},onSaveSettings:function(e,t,i){var s={canvasTheme:t.getValue(),mouseWheelMode:i.getValue()};this.canvas.setSettings(s),this.canvas.enableMouseZoom(!0),e.close()},showSignUpDialog:function(e){var t=new x.Z,i=new L.Z,s=i.div("MatcDialog ").build();this._createSignUpForm(t,s),t.popup(s,e.target)},_createSignUpForm:function(e,t){var i=this.$new(W.Z);return i.render([{label:"Email",name:"email",type:"text",required:"true",placeholder:"Your email",css:"input-lg MatcIgnoreOnKeyPress",error:"We need your email."},{label:"Password",name:"password",type:"password",min:6,placeholder:"Your password",css:"input-lg MatcIgnoreOnKeyPress",error:"The password should have at least six characters."},{label:'I have read the <a href="#/termsofservice.html" target="_blank">terms of service</a>',name:"tos",type:"check",required:"true",css:"MatcFormCheckBox MatcIgnoreOnKeyPress",error:"You must accept the terms of service!"}],[{label:"Cancel",css:"MatcLinkButton",click:m.Z.hitch(e,"close")},{label:"Create Free Account",css:"MatcButton MatchButtonGreen",click:m.Z.hitch(this,"_signUpAndNew",e,i)}]),i.placeAt(t),i.startup(),i},_signUpAndNew:function(e,t,i){var s=t.validateForm(null,!0);if(s)if(n=this._doPost("rest/user",i),"error"==n.type)n.errors.indexOf("user.email.not.unique")>=0?t.showError("The email is already taken! Please enter another one!","email"):t.showError("Something went wrong! Please try again!",""),e.shake();else{e.close();var n=this._doPost("rest/login/",i);"error"!=n.type?window.location.href="/my-account.html":console.error("_signUpAndSave() > Could not sign in user")}else e.shake()},cleanUp:function(){this.hideAllSections(),this.unselect()},unselect:function(){this._selectedWidget=null,this._selectedLine=null,this._selectedScreen=null,this._selectedMulti=null,this._selectedGroup=null,this._selection=null},blurWidgetProperties:function(){}},mounted:function(){this.db=new L.Z}},Le=De,xe=(0,N.Z)(Le,b,k,!1,null,null,null),Oe=xe.exports,Pe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"},[e._m(0),e._m(1),i("div",{staticClass:"MatcCanvasScrollBar MatcCanvasScrollBarBottom",style:"padding-left:"+this.layerListWidth+"px",attrs:{"data-dojo-attach-point":"scrollBottom"}},[e._m(2)]),i("div",{staticClass:"MatcMessage",attrs:{"data-dojo-attach-point":"message"}})])},We=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvasFrame",attrs:{"data-dojo-attach-point":"frame"}},[i("div",{staticClass:"MatcCanvasContainer MatcCanvasZoomable",attrs:{"data-dojo-attach-point":"container"}},[i("div",{staticClass:"MatcCanvasContainer",attrs:{"data-dojo-attach-point":"zoomContainer"}},[i("div",{staticClass:"MatcCanvasLayer",attrs:{"data-dojo-attach-point":"screenContainer"}}),i("div",{staticClass:"MatcCanvasLayer",attrs:{"data-dojo-attach-point":"widgetContainer"}}),i("div",{staticClass:"MatcCanvasLayer MatcCanvasSVGLayer",attrs:{"data-dojo-attach-point":"svgContainer"}})]),i("div",{staticClass:"MatcDnDLayer",attrs:{"data-dojo-attach-point":"dndContainer"}})])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvasScrollBar MatcCanvasScrollBarRight",attrs:{"data-dojo-attach-point":"scrollRight"}},[i("div",{staticClass:"MatcCanvasScrollBarCntr MatcCanvasScrollBarCntrRight",attrs:{"data-dojo-attach-point":"scrollRightCntr"}},[i("div",{staticClass:"MatchCanvasScrollHandle",attrs:{"data-dojo-attach-point":"scrollRightHandler"}})])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvasScrollBarCntr MatcCanvasScrollBarCntrBottom",attrs:{"data-dojo-attach-point":"scrollBottomCntr"}},[i("div",{staticClass:"MatchCanvasScrollHandle",attrs:{"data-dojo-attach-point":"scrollBottomHandler"}})])}],Be=i(52298),Ae=i(66839),He=i(83246),Ee=i(77433),Ve=i(15405),Fe=i(97079),Ne=i(65448),Re=i(88280),Ue=i(66538),Ie=i(85677),Ge=i(87484),$e=i(24992),ze=i(50681),je=i(56300),Je=i(29701),Ke=i(86081),qe=i(85983),Xe=i(93374),Qe=i(15378),Ye=i(45107),et=i(11477),tt=i(69912),it=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"})},st=[],nt=i(56084),ot=(i(26833),i(4723),{name:"UserJourney",mixins:[],data:function(){return{}},components:{},methods:{highlightSession:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.analyticParams.tree||this.highlightAnalyticLine(e)},highlightAnalyticLine:function(e){if(this.logger.log(1,"highlightAnalyticLine","entry > ",e),this.analyticLines)for(var t in this.analyticLines)this.hideOrShowLine(t,e)},hideOrShowLine:function(e,t){var i=this.analyticLines[e];i&&(t&&t!==e?i.style("opacity",0):i.style("opacity",1));var s=this.analyticLines[e+"taskBackGround"];if(s&&(t&&t+"taskBackGround"!==e+"taskBackGround"?s.style("opacity",0):s.style("opacity",1)),this.analyticCircles[e]){var n=this.analyticCircles[e];n.forEach((function(i){i.style.opacity=t&&t!==e?0:1}))}},_render_global_UserJourney:function(){this.logger.log(1,"_render_global_UserJourney","entry > "),this.setBW(!0),this.cleanUpAnalytics(),this.analyticParams.tree?this._renderUserTree():this._renderUserSingleLines()},_renderUserTree:function(){var e=this.getUserJourney(),t=new L.Z,i=this.analyticParams.time,s=this.analyticParams.sessions,n={},o=0,a=0;for(var r in s)if(!0===s[r]){var l=e[r];l?(this._getSessionGraph(l,n,i),o++):console.debug("_renderUserTree() > No session for ",r)}for(var c in n){var h=n[c];h.count>o&&(console.warn("_renderUserTree() > Update maxcount, because l.count bigger than max count"),o=h.count);var d=h.duration/h.count;a=Math.max(d,a)}var u={};for(var g in n){var v=n[g],m=[];m.push({x:v.from.x,y:v.from.y,d:"right"}),m.push({x:v.to.x,y:v.to.y,d:"right"});var p=v.duration/v.count,f=i?Math.min(1,p/a):Math.min(1,v.count/o),M=Math.min(15,Math.max(1,Math.round(25*f)))+1,C=this.mixColor(Math.min(1,f)),S=v.to.x+","+v.to.y,y=v.from.x+","+v.from.y;u[S]||(u[S]=this._renderTreeEvent(v.to.x,v.to.y,M,C,t)),u[y]||(u[y]=this._renderTreeEvent(v.from.x,v.from.y,M,C,t)),this.drawAnalyticLine(g,m,C,M,this.taskLineOpacity)}},_renderTreeEvent:function(e,t,i,s,n){var o=n.div("MatcAnalyticCanvasEventCntr").build(this.widgetContainer);o.style.left=Math.round(e)+"px",o.style.top=Math.round(t)+"px";var a=n.div("MatcAnalyticCanvasEvent MatcAnalyticCanvasEvent").build(o),r=Math.round(2*i);a.style.width=r+"px",a.style.height=r+"px",a.style.top=-1*Math.round(r/2)+"px",a.style.left=-1*Math.round(r/2)+"px",a.style.background=s},_renderUserSingleLines:function(){var e=this.getUserJourney(),t=this.getOutlierScores(),i=this.getTaskPerformance(),s=new L.Z,n=null;!1!==this.analyticParams.task&&this.analyticParams.task>=0&&(n=this.testSettings.tasks[this.analyticParams.task]);var o=this.analyticParams.sessions;for(var a in o)if(!0===o[a]){var r=e[a],l=i[a],c=t[a];r?this._renderUserGraph(a,r,s,n,l,c):console.debug("_render_global_UserJourney() > No session for ",a)}this.analyticParams.outlier&&this.showHint("Found ".concat(Object.values(t).filter((function(e){return 1===e})).length," outliers"))},_renderUserGraph:function(e,t,i,s,n,o){var a,r,c=t.data,h=[],d=c.length,u=[],g=null,v=0,m=0;s&&n&&(r=n[s.id]);for(var p=0;p<d;p++){g=c[p],a&&(v=g.time-a.time,m=Math.max(v,m));var f=this.getEventScreenId(g),M=this.sourceModel.screens[f],C=this.model.screens[f];if(M&&C){if("SessionStart"==g.type){var S=M.x-Math.max(10,Math.round(30*this.zoom)),y=M.y+Math.max(10,Math.round(30*this.zoom));h.push({x:S,y:y,d:"right",duration:v,type:g.type,session:g.session})}else if(g.x>=0&&g.y>=0&&!g.noheat){var w=g.x*M.w+M.x,b=g.y*M.h+M.y;h.push({x:w,y:b,d:"right",duration:v,type:g.type,session:g.session}),a=g}if(r&&r.startPosition<=p&&r.endPosition>=p){var k=h[h.length-1];k.match=!0,u.push(k)}}else console.warn("_renderUserGraph()","Screen is not there",g.screen)}if(g&&"ScreenLoaded"===g.type){var Z=this.getEventScreenId(g),T=this.sourceModel.screens[Z],_=Math.round(T.x+T.w/2),D=Math.round(T.y+T.h/2);if(h.push({x:_,y:D,d:"right",duration:v,type:g.type,session:g.session}),r&&r.startPosition<=d-1&&r.endPosition>=d-1){var L=h[h.length-1];L.match=!0,u.push(L)}}this.analyticCircles[e]=[];for(var x=0;x<h.length;x++){var O=h[x],P=Math.round(O.duration/m*40)+25,W=this._renderScreenEvent(O.x,O.y,O.type,"",i,O.session,P),B=(0,nt.Z)(W,3),A=B[0],H=B[1],E=B[2];x==h.length-1?(l.Z.add(E,"MatcAnalyticCanvasEventSessionEnd"),A.style.background=this.userJourneyEndColor,H.style.background=this.userJourneyEndColor+28,H.style.borderColor=this.userJourneyEndColor):x>0&&(O.match?(A.style.background=this.analyticParams.taskColor,H.style.background=this.analyticParams.taskColor+28,H.style.borderColor=this.analyticParams.taskColor):o&&this.analyticParams.outlier?(A.style.background=this.analyticParams.outlierColor,H.style.background=this.analyticParams.outlierColor+28,H.style.borderColor=this.analyticParams.outlierColor):(A.style.background=this.analyticParams.color,H.style.background=this.analyticParams.color+28,H.style.borderColor=this.analyticParams.color)),this.analyticCircles[e].push(E)}var V=this.analyticParams.color,F=this.taskLineOpacity,N=2;return this.analyticParams.outlier&&(o?(V=this.analyticParams.outlierColor,F=this.taskLineOpacity,N=4):F=.5*this.taskLineOpacity),s?(F=.5*this.taskLineOpacity,this.drawStraightAnalyticLine(e+"taskBackGround",h,V,N,F),this.drawStraightAnalyticLine(e,u,this.analyticParams.taskColor,4,this.taskLineOpacity)):this.drawStraightAnalyticLine(e,h,V,N,F),!1},_renderScreenEvent:function(e,t,i,s,n,o,a){var r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:15,l=n.div("MatcAnalyticCanvasEventCntr").build(this.widgetContainer);l.style.left=Math.round(e)+"px",l.style.top=Math.round(t)+"px";var c=n.div("MatcAnalyticCanvasEventHalo").build(l);c.style.width=a+"px",c.style.height=a+"px",c.style.top=-1*Math.round(a/2)+"px",c.style.left=-1*Math.round(a/2)+"px";var h=n.div("MatcAnalyticCanvasEvent MatcAnalyticCanvasClickableEvent MatcAnalyticCanvasEvent"+i).build(l);return h.style.width=r+"px",h.style.height=r+"px",h.style.top=-1*Math.round(r/2)+"px",h.style.left=-1*Math.round(r/2)+"px",this.tempOwn((0,p.Z)(h,"click",m.Z.hitch(this,"onScreenEventClick",o))),[h,c,l]},onScreenEventClick:function(e,t){this.stopEvent(t),this.toolbar&&this.toolbar.setSelectSessions([e])},_getSessionGraph:function(e,t){for(var i,s,n=e.data,o=null,a=0,r=0;r<n.length;r++){o=n[r],s&&(a=o.time-s.time);var l=this.getEventScreenId(o),c=this.sourceModel.screens[l];if(c){var h={};if("SessionStart"==o.type)h.x=c.x-Math.max(10,Math.round(30)),h.y=c.y+Math.max(10,Math.round(30)),i=this._addToGraph(i,h,t,0);else if(o.x>=0&&o.y>=0&&!o.noheat)if(o.widget&&this.sourceModel.widgets[o.widget]){var d=this.sourceModel.widgets[o.widget];h.x=Math.round(d.x+d.w/2),h.y=Math.round(d.y+d.h/2),i=this._addToGraph(i,h,t,a),s=o}else h.x=Math.round(Math.min(1,o.x)*c.w+c.x),h.y=Math.round(Math.min(1,o.y)*c.h+c.y),i=this._addToGraph(i,h,t,a),s=o}else console.warn("_getSessionGraph()","Screen is not there",o.screen)}if(o&&"ScreenLoaded"===o.type){var u=this.getEventScreenId(o),g=this.sourceModel.screens[u],v={x:Math.round(g.x+g.w/2),y:Math.round(g.y+g.h/2)};i=this._addToGraph(i,v,t,a)}},_addToGraph:function(e,t,i,s){if(e){var n=e.x+";"+e.y+"-"+t.x+";"+t.y;return i[n]||(i[n]={from:e,to:t,count:0,duration:0}),i[n].count++,i[n].duration+=1*s,t}return t}},mounted:function(){}}),at=ot,rt=(0,N.Z)(at,it,st,!1,null,null,null),lt=rt.exports,ct=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"})},ht=[],dt={name:"DropOff",mixins:[],data:function(){return{}},components:{},methods:{_render_global_DropOff:function(){this.logger.log(1,"_render_global_DropOff","entry > ",this.analyticParams.task),this.setBW(!0),this.analyticParams.task?this.analyticParams.time?this._render_dropoff_task_time(this.analyticParams.task):this._render_dropoff_task_success(this.analyticParams.task):this.showError("No task selected")},_render_dropoff_task_time:function(e){var t=new L.Z,i=new E.Z(this.events),s=new I.Z,n=s.getFunnelSummary(i,e,this.annotation),o=e.flow.length;if(e.flow&&e.flow.length>1)for(var a=Math.max(1,n[n.length-1].durationMean),r=0;r<e.flow.length-1;r++){var l=n[r+1],c=n[r+2],h=e.flow[r],d=e.flow[r+1],u=c.durationMean-l.durationMean,g=Math.min(1,u/a),v=this._getDropOffBoxPosition(h,r,o),m=this._getDropOffBoxPosition(d,r+1,o),p=[v,m],f=this.mixColor(g),M=Math.max(3,Math.round(this.dropOffLineWidth*g));this.drawAnalyticLine("dropOffLine"+r,p,f,M,this.taskLineOpacity),this._renderDropOffEvent(m.x,m.y,"FlowStep",t,f,M+this.dropOffEventWidth,Math.round(u/100)/10,"s"),0===r&&(f=this.mixColor(g),M=Math.max(3,Math.round(this.dropOffLineWidth*g)),this._renderDropOffEvent(v.x,v.y,"FlowStep",t,f,M+this.dropOffEventWidth,"0","s"))}else this.showError("Cannot show task times. The selected task has only one step.")},_render_dropoff_task_success:function(e){var t=new L.Z,i=new E.Z(this.events),s=new I.Z,n=s.getFunnelSummary(i,e,this.annotation),o=e.flow.length;if(e.flow&&e.flow.length>1)for(var a=0;a<e.flow.length-1;a++){var r=n[a+1],l=n[a+2],c=e.flow[a],h=e.flow[a+1],d=this._getDropOffBoxPosition(c,a,o),u=this._getDropOffBoxPosition(h,a+1,o),g=[d,u],v=this.greenToRed(l.p),m=Math.max(3,Math.round(this.dropOffLineWidth*l.p));if(this.drawAnalyticLine("dropOffLine"+a,g,v,m,this.taskLineOpacity),r&&l){var p=r.p-l.p,f={x:d.x+100,y:d.y+100},M=[d,f];m=Math.max(3,Math.round(this.dropOffLineWidth*p)),this.drawAnalyticLine("dropOffLineDrop"+a,M,this.dropOffLineColor,m,this.taskLineOpacity),this._renderDropOffEvent(f.x,f.y,"FlowStep",t,this.dropOffLineColor,m+this.dropOffEventWidth,Math.round(-100*p))}this._renderDropOffEvent(u.x,u.y,"FlowStep",t,v,m+this.dropOffEventWidth,Math.round(100*l.p)),0===a&&(v=this.greenToRed(r.p),m=Math.max(3,Math.round(this.dropOffLineWidth*r.p)),this._renderDropOffEvent(d.x,d.y,"FlowStep",t,v,m+this.dropOffEventWidth,Math.round(100*r.p)))}else this.showError("Cannot show task times. The selected task has only one step.")},_getDropOffBoxPosition:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(e.widget){var s=this.sourceModel.widgets[e.widget];if(s){var n={};return n.x=Math.round(s.x+s.w/2),n.y=Math.round(s.y+s.h/2),n}this.logger.warn("_geDropOffBoxPosition","no widget > ",e.widget)}if(e.screen){var o=this.sourceModel.screens[e.screen];if(o){var a={};return a.x=Math.round(o.x+o.w/2),a.y=Math.min(o.y+o.h,Math.round(o.y+o.h/3)+o.h*t/(2*i)),a}this.logger.warn("_geDropOffBoxPosition","no screen > ",e.screen)}},_renderDropOffEvent:function(e,t,i,s,n,o,a){var r=this,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"%",c=s.div("MatcAnalyticCanvasEventCntr").build(this.widgetContainer);c.style.left=Math.round(e)+"px",c.style.top=Math.round(t)+"px";var h=s.div("MatcAnalyticCanvasEvent MatcAnalyticCanvasEvent"+i).build(c),d=Math.max(5,Math.round(o));return h.style.width=d+"px",h.style.height=d+"px",h.style.top=-1*Math.round(d/2)+"px",h.style.left=-1*Math.round(d/2)+"px",h.style.background=n,this.tempOwn((0,p.Z)(h,"click",(function(e){return r.selectDropOffPoint(e)}))),l&&s.span("MatcAnalyticCanvasEventLabel",a+l).build(h),h},selectDropOffPoint:function(){}},mounted:function(){}},ut=dt,gt=(0,N.Z)(ut,ct,ht,!1,null,null,null),vt=gt.exports,mt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"})},pt=[],ft=i(906),Mt={name:"DataProcessing",mixins:[],data:function(){return{}},components:{},methods:{getOutlierScores:function(){if(!this.cache["outliers"]){var e=new E.Z(this.events),t=ft.by(e,2);this.cache["outliers"]=t}return this.cache["outliers"]},getGestures:function(){if(!this.cache["gestures"]){var e=new E.Z(this.events),t=e.select("type","in",["ScreenGesture","WidgetGesture"]);this.cache["gestures"]=t.data}return this.cache["gestures"]},getUserJourney:function(){if(!this.cache["userJourney"]){var e=new E.Z(this.events);e.sortBy("time");var t=e.groupBy("session"),i=t.data;this.cache["userJourney"]=i}return this.cache["userJourney"]},getTaskPerformance:function(){if(!this.cache["taskPerformance"]){var e=new I.Z,t=new E.Z(this.events);t.sortBy("time");for(var i=e.getTaskPerformance(t,this.testSettings.tasks,!1,!1),s={},n=0;n<i.data.length;n++){var o=i.data[n];s[o.session]||(s[o.session]={}),s[o.session][o.task]?console.warn("getTaskPerformance() Double mactch",o):s[o.session][o.task]=o}this.cache["taskPerformance"]=s}return this.cache["taskPerformance"]},getOverlayViews:function(){if(!this.cache["overlayViews"]){for(var e=this.df.select("type","==","OverlayLoaded"),t=e.count("overlay"),i=e.size(),s={},n=this.getScreens(this.sourceModel),o=0;o<n.length;o++){var a=n[o];s[a.id]=t.get(a.id,null,0)}this.cache["overlayViews"]={total:i,counts:s}}return this.cache["overlayViews"]},getOverlayTest:function(){if(!this.cache["overlayTests"]){for(var e=this.df.groupBy("session"),t=e.size().size(),i={},s=this.getScreens(this.sourceModel),n=0;n<s.length;n++){var o=s[n];i[o.id]=0}e.foreach((function(e){var t=e.count("overlay");t.foreach((function(e,t){i[t]+=1}))})),this.cache["overlayTests"]={sessions:t,counts:i}}return this.cache["overlayTests"]},getScreenViews:function(){if(!this.cache["screenViews"]){for(var e=this.df.select("type","==","ScreenLoaded"),t=e.count("screen"),i=e.size(),s={},n=this.getScreens(this.sourceModel),o=0;o<n.length;o++){var a=n[o];s[a.id]=t.get(a.id,null,0)}this.cache["screenViews"]={total:i,counts:s}}return this.cache["screenViews"]},getScreenTests:function(){if(!this.cache["screenTests"]){for(var e=this.df.groupBy("session"),t=e.size().size(),i={},s=this.getScreens(this.sourceModel),n=0;n<s.length;n++){var o=s[n];i[o.id]=0}e.foreach((function(e){var t=e.count("screen");t.foreach((function(e,t){i[t]+=1}))})),this.cache["screenTests"]={sessions:t,counts:i}}return this.cache["screenTests"]},getScreenDwellTime:function(){if(!this.cache["screenDwell"]){for(var e=this.df.count("session"),t=e.size(),i=new I.Z,s=i.getScreenTimeGrouping(this.df),n=s.sum().sum(),o={},a=this.getScreens(this.sourceModel),r=0;r<a.length;r++){var l=a[r],c=s.get(l.id);o[l.id]=c?c.sum():0}this.cache["screenDwell"]={total:n,times:o,sessions:t}}return this.cache["screenDwell"]},getOverlayDwellTime:function(){if(!this.cache["overlayDwell"]){for(var e=this.df.count("session"),t=e.size(),i=new I.Z,s=i.getScreenTimeGrouping(this.df),n=s.sum().sum(),o=i.getOverlayTimeGrouping(this.df),a={},r=this.getScreens(this.sourceModel),l=0;l<r.length;l++){var c=r[l],h=o.get(c.id);a[c.id]=h?h.sum():0}this.cache["overlayDwell"]={total:n,times:a,sessions:t}}return this.cache["overlayDwell"]},getScreenWidgetClicks:function(){if(!this.cache["screenWidgetClicks"]){var e=this.df.select("type","==","WidgetClick"),t=e.count("screen"),i=t.sum();e=e.select("overlay","==",null),t=e.count("screen");for(var s={},n=this.getScreens(this.sourceModel),o=0;o<n.length;o++){var a=n[o];s[a.id]=t.get(a.id,null,0)}this.cache["screenWidgetClicks"]={clicks:s,total:i}}return this.cache["screenWidgetClicks"]},getScreenClicksOnBackground:function(e){var t=e.select("type","==","ScreenClick");return t},getMissedClicks:function(e){var t=this,i=Object.values(this.sourceModel.screens),s={};i.forEach((function(e){var i=t.getFromLines(e);0===i.length&&(s[e.id]=!0)}));var n=[],o=Object.values(this.sourceModel.widgets);o.forEach((function(e){if("Box"===e.type||"Button"===e.type||"HotSpot"===e.type){var i=t.getFromLines(e);0===i.length&&(n[e.id]=!0)}}));var a=e.select("type","in",["ScreenClick","WidgetClick"]).as_array(),r=a.filter((function(e){return"ScreenClick"===e.type&&!0===s[e.screen]||"WidgetClick"===e.type&&!0===n[e.widget]}));return r},getScreenClicks:function(){if(!this.cache["screenClicks"]){for(var e=this.df.select("type","in",["ScreenClick","WidgetClick"]),t=e.count("screen"),i=t.sum(),s=this.df.select("type","==","ScreenClick"),n=s.count("screen"),o={},a=this.getScreens(this.sourceModel),r=0;r<a.length;r++){var l=a[r];o[l.id]=n.get(l.id,null,0)}this.cache["screenClicks"]={clicks:o,total:i}}return this.cache["screenClicks"]},getOverlayClicks:function(){if(!this.cache["overlayCicks"]){for(var e=this.df.select("type","==","ScreenClick"),t=e.count("overlay"),i=t.sum(),s={},n=this.getScreens(this.sourceModel),o=0;o<n.length;o++){var a=n[o];s[a.id]=t.get(a.id,null,0)}this.cache["overlayCicks"]={clicks:s,total:i}}return this.cache["overlayCicks"]},getOverlayWidgetClicks:function(){if(!this.cache["overlayWidgetCicks"]){for(var e=this.df.select("type","==","WidgetClick"),t=e.count("overlay"),i=t.sum(),s={},n=this.getScreens(this.sourceModel),o=0;o<n.length;o++){var a=n[o];s[a.id]=t.get(a.id,null,0)}this.cache["overlayWidgetCicks"]={clicks:s,total:i}}return this.cache["overlayWidgetCicks"]},getLineWidgetData:function(){var e=this;return this.cache["lineWidgetData"]||function(){var t={},i=e.getWidgetData(),s=0;for(var n in e.model.lines){var o=e.model.lines[n].from;if(i[o]){var a=i[o].clicksAbs;t[o]={clicksAbs:a},s=Math.max(s,a)}Object.values(t).forEach((function(e){e.clicksRel=e.clicksAbs/s}))}e.cache["lineWidgetData"]=t}(),this.cache["lineWidgetData"]},getWidgetData:function(){if(!this.cache["widgetData"]){var e=new I.Z,t={},i=e.getWidgetStatistics(this.sourceModel,this.df);for(var s in i)t[s]=i[s];this.cache["widgetData"]=t}return this.cache["widgetData"]},getFirstNClicksData:function(e,t){console.debug("getFirstNClicksData",e.length);var i=new I.Z;return i.getFirstNClicks(e,t)}},mounted:function(){}},Ct=Mt,St=(0,N.Z)(Ct,mt,pt,!1,null,null,null),yt=St.exports,wt={name:"AnalyticCanvas",props:["viewport"],mixins:[r.Z,He.Z,D.Z,_.Z,Ve.Z,Fe.Z,Ne.Z,Re.Z,Ue.Z,Ie.Z,Ge.Z,$e.Z,ze.Z,je.Z,Je.Z,Ke.Z,Xe.Z,Qe.Z,Ye.Z,qe.Z,Ee.Z,lt,vt,yt],data:function(){return{mode:"view",zoom:1,analyticMode:"HeatmapClick",resizeEnabled:!1,renderDND:!0,dragNDropMinTimeSpan:0,wireInheritedWidgets:!0,taskLineOpacity:1,isBlackAndWhite:!1,dropOffLineWidth:25,dropOffLineColor:"#555",dropOffEventWidth:40,userJourneyEndColor:"#f03131",layerListWidth:256}},components:{},methods:{postCreate:function(){this.logger=new M.Z("AnalyticCanvas"),this.logger.log(2,"constructor","entry"),this.cache={},this.moveMode="classic",this.domUtil=new et.Z,this.analyticLines={},this.analyticCircles={},this.logger.log(2,"postCreate","entry"),this.initSize(),this.canvasPos={x:this.canvasStartX,y:this.canvasStartY,w:this.canvasFlowWidth,h:this.canvasFlowHeight},this.initViewport(),this.initContainerSize(),this.setContainerPos(),this.initSelection(),this.initRender(),this.initAnalyticSVG(),this.initZoom(),this.initScrollBars(),this.initComment(),this.initSettings(),this.initWiring(),this.initKeys(),this.initMouseTracker(),this.initDarkModeListener(),this.initLayer(),this.db=new L.Z,this.own(Ae.Z.subscribe("matc/toolbar/click",m.Z.hitch(this,"onToolbarClick"))),this.own((0,p.Z)(Be.Z.body(),"keydown",m.Z.hitch(this,"onKeyPress"))),this.own((0,p.Z)(Be.Z.body(),"keyup",m.Z.hitch(this,"onKeyUp"))),this.logger.log(2,"postCreate","exit!!!")},initLayer:function(){this.logger.log(-2,"initLayer","entry");var e=localStorage.getItem("quxLayerListWidth");e&&!isNaN(1*e)&&this.setLayerListWidth(1*e)},setLayerListWidth:function(e){this.layerListWidth=e},showError:function(e){this.message&&(l.Z.add(this.message,"MatcMessageError"),l.Z.remove(this.message,"MatcMessageSuccess MatcMessageHint"),this.message.textContent=e,setTimeout(m.Z.hitch(this,"hideMessage"),3e3))},XlineFunction:function(e){return this.straightLineFunction(e)},setPublic:function(e){this.isPublic=e},setModelService:function(e){this.sourceModelService=e},setCommentService:function(e){this.commentService=e},setToolbar:function(e){this.toolbar=e,this.onChangeCanvasViewConfig()},setMouseListener:function(e){this.mouseListenerCallback=e},inlineEditInit:function(){this.logger.log(2,"inlineEditInit","enter")},setMouseData:function(e){this.logger.log(0,"setMouseData","enter > "+e.length),this.mouseData=e,0==e.length&&this.showError("No Mouse data was recorded")},setBW:function(e){this.logger.log(1,"setBW","enter > "+e),e?l.Z.add(this.container,"MatcCanvasBW"):l.Z.remove(this.container,"MatcCanvasBW")},onChangeCanvasViewConfig:function(){this.toolbar&&this.toolbar.setCanvasViewConfig({zoom:this.zoom,renderLines:this.renderLines,showComments:this.showComments,isBlackAndWhite:this.isBlackAndWhite})},setCanvasViewConfig:function(e,t){this.logger.log(-1,"setCanvasViewConfig","enter > "+e,t),"zoom"===e&&this.setZoomFactor(t),"renderLines"===e&&this.setViewLines(t),"showComments"===e&&this.setCommentView(t),"isBlackAndWhite"===e&&(this.isBlackAndWhite=t,this.setBW(t))},initAnalyticSVG:function(){this.logger.log(3,"initAnalyticSVG","entry");var e=tt.Ys(this.svgContainer);this.analyticSVG=e.append("svg").attr("width",this.canvasPos.h).attr("height",this.canvasPos.w)},cleanUpAnalyticLines:function(){this.analyticSVG&&this.analyticSVG.selectAll("*").remove(),this.analyticLines={},this.analyticCircles={}},drawLine:function(e,t){var i=this.defaultLineColor,s=this.defaultLineWidth;if(this.model&&this.model.lines&&this.model.lines[e]){var n=this.model.lines[e],o=this.getLineWidgetData();if(o[n.from]){var a=o[n.from],r=a.clicksRel;i=this.mixColor(r)}}return this.drawSVGLine(e,t,i,s,1)},drawAnalyticLine:function(e,t,i,s,n){var o=this.analyticSVG.append("path").attr("d",this.lineFunction(t)).attr("stroke",i).attr("stroke-width",s).attr("fill","none").style("opacity",n);this.analyticLines[e]=o},drawStraightAnalyticLine:function(e,t,i,s,n){var o=this.analyticSVG.append("path").attr("d",this.straightLineFunction(t)).attr("stroke",i).attr("stroke-width",s).attr("fill","none").style("opacity",n);this.analyticLines[e]=o},initWiring:function(){var e=this;this.logger.log(-1,"initWiring","enter"),this.own((0,p.Z)(this.dndContainer,"mousedown",(function(t){return e.dispatchMouseDown(t)})))},dispatchMouseDownScreen:function(e,t){this.logger.log(-1,"dispatchMouseDownScreen","enter",t);var i=this.screenDivs[t],s=this.model.screens[t];this.onScreenDndClick(s.id,i,null)},dispatchMouseDownWidget:function(e,t){this.logger.log(-1,"dispatchMouseDownWidget","enter",t);var i=this.widgetDivs[t];this.onWidgetDndClick(t,i)},afterUpdateDnd:function(e){this.logger.log(1,"afterUpdateDnd","enter > ",e)},initSettings:function(){this.logger.log(1,"initSettings","enter > "),this.settings={canvasTheme:"MatcLight",lineColor:"#333",lineWidth:1,storePropView:!0,moveMode:"ps",mouseWheelMode:"scroll"};var e=this._getStatus("matcSettings");e?(e.canvasTheme&&(this.settings.canvasTheme=e.canvasTheme),e.lineColor&&(this.settings.lineColor=e.lineColor),e.lineWidth&&(this.settings.lineWidth=e.lineWidth)):this.logger.log(2,"initSettings","exit>  no saved settings"),this.applySettings(this.settings)},getSettings:function(){return this.settings},setSettings:function(e){e.canvasTheme&&(this.settings.canvasTheme=e.canvasTheme),e.lineColor&&(this.settings.lineColor=e.lineColor),e.lineWidth&&(this.settings.lineWidth=e.lineWidth),null!=e.storePropView&&(this.settings.storePropView=e.storePropView),null!=e.mouseWheelMode&&(this.settings.mouseWheelMode=e.mouseWheelMode),this._setStatus("matcSettings",this.settings),this.applySettings(this.settings),this.rerender()},applySettings:function(e){this.logger.log(2,"applySettings","enter > "+e.canvasTheme+" &> "+e.moveMode),e.lineColor&&(this.defaultLineColor=e.lineColor),e.lineWidth&&(this.defaultLineWidth=e.lineWidth),e.canvasTheme&&this.setCanvasTheme(e.canvasTheme),e.mouseWheelMode&&(this._mouseWheelMode=e.mouseWheelMode),this.settings=e},setCanvasTheme:function(e){"MatcAuto"===e&&(this.logger.log(-1,"setCanvasTheme","enter > auto: "+e+" > OS: "+this.isDarkModeOS()),e=this.isDarkModeOS()?"MatcDark":"MatcLight"),this._lastCanvasTheme&&l.Z.remove(Be.Z.body(),this._lastCanvasTheme),l.Z.add(Be.Z.body(),e),this._lastCanvasTheme=e,this.defaultLineColor="#49C0F0"},initDarkModeListener:function(){var e=this,t=window.matchMedia("(prefers-color-scheme: dark)");this.own((0,p.Z)(t,"change",(function(){e.logger.log(-1,"initDarkModeListener","change"),"MatcAuto"===e.settings.canvasTheme&&e.setCanvasTheme(e.settings.canvasTheme)})))},isDarkModeOS:function(){return!window.matchMedia||!!window.matchMedia("(prefers-color-scheme: dark)").matches},onWidgetDndClick:function(e,t,i,s){this.logger.log(2,"onWidgetDndClick","enter > "+e),this.stopEvent(s),this.onWidgetSelected(e),this.selectAnalyticDiv(e),this.setState(0)},onScreenDndClick:function(e,t,i,s){this.logger.log(2,"onScreenDndClick","entry > "+e),this.stopEvent(s),this.setSelectedScreens([e]),this.selectAnalyticDiv(e),this.setState(0)},onCanvasSelected:function(){this.logger.log(2,"onCanvasSelected","entry > "),this.selectAnalyticDiv(null),this.toolbar&&(this.toolbar.unselect(),this.toolbar.onCanvasSelected())},selectAnalyticDiv:function(e){if(this._analyticLastSelectedDiv&&(l.Z.remove(this._analyticLastSelectedDiv,"MatcHeapMapWidgetSelected"),delete this._analyticLastSelectedDiv),this.analyticsDivs&&this.analyticsDivs[e]){var t=this.analyticsDivs[e];l.Z.add(t,"MatcHeapMapWidgetSelected"),this._analyticLastSelectedDiv=t}if(this.widgetDivs&&this.widgetDivs[e]){var i=this.widgetDivs[e];l.Z.add(i,"MatcHeapMapWidgetSelected"),this._analyticLastSelectedDiv=i}},renderLayerList:function(){this.logger.log(1,"renderLayerList","entry > ")},afterRender:function(){this.logger.log(1,"afterRender","entry > "+this.analyticMode),this.cleanUpAnalytics();try{this._renderHeatMap()}catch(e){this.logger.error("afterRender","Could not render heatmaps ",e),this.logger.sendError(e)}},hasSelect:function(){return"addComment"!=this.mode},_renderHeatMap:function(){this.logPageView("/analytics/workspace/"+this.analyticMode+".html"),this.setBW(this.isBlackAndWhite),this.cleanUpHeat(),"smartphone"==this.sourceModel.type||"tablet"==this.sourceModel.type?(this.defaultRadius=this.sourceModel.screenSize.w/20,this.defaultBlur=this.sourceModel.screenSize.w/15):(this.defaultRadius=this.sourceModel.screenSize.w/120,this.defaultBlur=this.sourceModel.screenSize.w/100),this.logger.log(0,"onScreenRendered","adjust radios to "+this.defaultRadius);var e=this.df.groupBy("screen");for(var t in this.heatmapDivs={},this.sourceModel.screens){var i=this.sourceModel.screens[t],s=e.get(t),n=[];if(s&&(n=s.as_array()),this["_render_"+this.analyticMode]){var o=this.createBox(i);l.Z.add(o,"MatcHeatMapScreen");var a=this.db.div("MatcHeapMapContainer").build(o),r=this.db.canvas(i.w,i.h).build(a),c=r.getContext("2d");this["_render_"+this.analyticMode](n,i,c,o),this.hasSelect()&&this.tempOwn((0,p.Z)(o,Z.Z.press,m.Z.hitch(this,"onScreenDndClick",i.id,o,null))),this.widgetContainer.appendChild(o),this.heatmapDivs[i.id]=o,this.analyticsDivs[i.id]=o}}"UserJourney"!=this.analyticMode&&"Gesture"!=this.analyticMode&&"DropOff"!=this.analyticMode?this.hideWidgetDND=!0:this.hideWidgetDND=!1,this["_render_global_"+this.analyticMode]&&this["_render_global_"+this.analyticMode]()},_render_HeatmapMouse:function(e,t,i){this.logger.log(0,"_render_HeatmapMouse","entry > "+t.name);var s=this.mouseData.filter((function(e){return e.screen===t.id}));s=this._filterSelectedSessions(s);var n=this.computeMouseDistribution(s,this.sourceModel);if(n[t.id]){var o=n[t.id];this.draw(i,o.values,o.max,t.w,t.h)}},_render_HeatmapClick:function(e,t,i,s){this.logger.log(2,"_render_HeatmapClick","entry > ");var n=this._filterSelectedSessions(this.events),o=new E.Z(n),a=-1;if(this.analyticParams&&(a=this.analyticParams.numberOfClicks),"screenClicks"===a){var r=this.getScreenClicksOnBackground(o);r=r.as_array(),this._render_pixel_screen_heatmap(r,t,i,s)}else if("missedClicks"===a){var l=this.getMissedClicks(o);this._render_pixel_screen_heatmap(l,t,i,s)}else if(a>0){var c=this.getFirstNClicksData(n,a);this._render_pixel_screen_heatmap(c,t,i,s)}else{var h=this.getClickEvents(new E.Z(n)),d=h.as_array();this._render_pixel_screen_heatmap(d,t,i,s)}},_filterSelectedSessions:function(e){if(this.analyticParams&&this.analyticParams.sessions){var t=this.analyticParams.sessions;return e.filter((function(e){return!0===t[e.session]}))}return e},_render_pixel_screen_heatmap:function(e,t,i){if(t.w<=0||t.h<=0)this.logger.error("_render_pixel_screen_heatmap","Error > bad screen dimension: "+t.name);else try{for(var s=[],n=0;n<e.length;n++){var o=e[n],a=this.getEventScreenId(o);a==t.id&&s.push(o)}var r=this.computeClickDistribution(s,t.w,t.h);this.draw(i,r.values,r.max,t.w,t.h)}catch(l){this.logger.error("_render_pixel_screen_heatmap","Error > "+t.name)}},_render_HeatmapScrollView:function(e,t,i){this.logger.log(2,"_render_HeatmapScrollView","entry > ");var s=this.computeScrollVisibiltyDistribution(e,this.sourceModel.screenSize.h,t.h);this.drawSections(s,i,t.h,t.w)},_render_HeatmapScrollTime:function(e,t,i){this.logger.log(2,"_render_HeatmapScrollTime","entry > ");var s=this.computeScrollDurationDistrubtion(e,this.sourceModel.screenSize.h,t.h);this.drawSections(s,i,t.h,t.w)},_render_HeatmapViews:function(e,t,i){if(this.logger.log(2,"HeatmapViews","entry > "),t.style.overlay){var s=this.getOverlayViews(),n=s.counts[t.id];n||(n=0),i.globalAlpha=.4;var o=this.mixColor(n/s.total);i.fillStyle=o,i.fillRect(0,0,t.w,t.h)}else{var a=this.getScreenViews(),r=a.counts[t.id];r||(r=0),i.globalAlpha=.4;var l=this.mixColor(r/a.total);i.fillStyle=l,i.fillRect(0,0,t.w,t.h)}},_render_HeatmapDwelTime:function(e,t,i){if(this.logger.log(2,"HeatmapDwelTime","entry > "),t.style.overlay){var s=this.getOverlayDwellTime(),n=s.times[t.id];n||(n=0),i.globalAlpha=.4;var o=this.mixColor(n/s.total);i.fillStyle=o,i.fillRect(0,0,t.w,t.h)}else{var a=this.getScreenDwellTime(),r=a.times[t.id];r||(r=0),i.globalAlpha=.4;var l=this.mixColor(r/a.total);i.fillStyle=l,i.fillRect(0,0,t.w,t.h)}},drawDurationLine:function(e,t,i,s){for(var n=0;n<t.length-1;n++){var o=t[n],a=t[n+1],r=a.duration/s,l=Math.round(6*r)+2,c=i;this.drawStraightAnalyticLine(e,[o,a],c,l,this.taskLineOpacity)}},_render_global_Gesture:function(){this.logger.log(0,"_render_global_Gesture","entry > ");for(var e=this.getGestures(),t=new L.Z,i=0;i<e.length;i++){var s=e[i],n=s.gesture,o=this.getEventScreenId(s),a=this.sourceModel.screens[o];if(a&&n){var r=[],l=s.gesture.start,c=s.gesture.end;if(l&&c){var h=l.x*a.w+a.x,d=l.y*a.h+a.y;r.push({x:h,y:d,d:"right"}),this._renderGestureStart(h,d,this.analyticParams.color,t),h=c.x*a.w+a.x,d=c.y*a.h+a.y,r.push({x:h,y:d,d:"right"});var u=Math.max(1,Math.round(3*this.zoom));this.drawSVGLine("",r,this.analyticParams.color,u,1)}}else console.warn("_render_global_Gesture()","Screen is not there",s.screen)}},_renderGestureStart:function(e,t,i,s){var n=s.div("MatcAnalyticCanvasEventCntr").build(this.widgetContainer);n.style.left=Math.round(e)+"px",n.style.top=Math.round(t)+"px";var o=s.div("MatcAnalyticCanvasEvent MatcAnalyticCanvasEvent").build(n),a=Math.max(5,Math.round(15*this.zoom));return o.style.width=a+"px",o.style.height=a+"px",o.style.top=-1*Math.round(a/2)+"px",o.style.left=-1*Math.round(a/2)+"px",o.style.backgroundColor=i,o},cleanUpAnalytics:function(){this.cleanUpAnalyticLines(),this.cleanUpNode(this.widgetContainer),this.analyticsDivs={}},setController:function(e){this.logger.log(2,"setController","enter"),this.controller=e,e.setCanvas(this)},getController:function(){return this._controllerCallback&&this[this._controllerCallback](),this.controller},setControllerCallback:function(e){this._controllerCallback=e},setModelFactory:function(e){this.logger.log(3,"setModelFactory","enter"),this.factory=e},setRenderFactory:function(e){this.logger.log(3,"setRenderFactory","enter"),this.renderFactory=e},setModel:function(e){this.sourceModel=e,this.model=e,this.grid=this.sourceModel.grid,this.setCommentView(this.showComments)},setEvents:function(e){this.logger.log(1,"setEvents","enter > # "+e.length);var t=new I.Z;this.events=t.nornalizeContainerChildEvents(e),this.df=new E.Z(e),this.df.sortBy("time"),this.fixGestures(e)},setAnnotation:function(e){this.logger.log(2,"setAnnotation","enter > # "),this.annotation=e},setTest:function(e){this.logger.log(2,"setTest","enter > # "),this.testSettings=e},setAnalyticMode:function(e,t){this.logger.log(2,"setAnalyticMode","entry > mode: "+e),this.analyticMode=e,this.analyticParams=t,this.rerender(),this.analyticCSS&&l.Z.remove(this.domNode,this.analyticCSS),this.analyticCSS=e,l.Z.add(this.domNode,this.analyticCSS)},setUser:function(e){this.user=e},setMode:function(e,t){this.logger.log(2,"setMode","enter > "+e+" != "+this.mode+" > "+t),e!=this.mode?(this.mode=e,this.toolbar&&this.toolbar.setMode(e),this.rerender()):t&&this.rerender()},setSubMode:function(){},onKeyPress:function(e){if(this._currentKeyEvent=e,"simulate"!=this.state&&"dialog"!=this.state){var t=e.target;if(!l.Z.contains(t,"MatcIgnoreOnKeyPress")){var i=e.keyCode?e.keyCode:e.which;32==i?this._inlineEditStarted||(this.stopEvent(e),"move"!=this.getMode()&&(this.setMode("move"),this.showHint("Move the mouse to move canvas..."),this.onDragStart(this.container,"container","onCanvasDnDStart","onCanvasDnDMove","onCanvasDnDEnd",null,this._lastMouseMoveEvent,!0))):37==i?this.onArrowLeft():39==i?this.onArrowRight():40==i?this.onArrowDown():38==i?this.onArrowUp():171==i||187==i?this._inlineEditStarted||(this.onClickPlus(),this.stopEvent(e)):173!=i&&189!=i||this._inlineEditStarted||(this.onClickMinus(),this.stopEvent(e))}}},getMode:function(){return this.mode},onKeyUp:function(e){var t=e.keyCode?e.keyCode:e.which;32==t&&(this.onDragEnd(this._lastMouseMoveEvent),this.setMode("view")),delete this._currentKeyEvent},initMouseTracker:function(){this.own((0,p.Z)(Be.Z.body(),"mousemove",m.Z.hitch(this,"onMouseMove")))},onMouseMove:function(e){var t=this.getCanvasMousePosition(e,!0);this._lastMousePos=t,this._lastMouseMoveEvent=e},destroy:function(){this.cleanUp()},logPageView:function(e){this.logger.log(4,"logPageView","enter",e)}},mounted:function(){}},bt=wt,kt=(0,N.Z)(bt,Pe,We,!1,null,null,null),Zt=kt.exports,Tt=i(39110),_t=i(26720),Dt=i(71251),Lt=i(62811),xt=function(e){(0,Tt.Z)(i,e);var t=(0,_t.Z)(i);function i(){var e;return(0,C.Z)(this,i),e=t.call(this),e.logger=new M.Z("AnalyticController"),e.logger.log(2,"constructor","exit"),e}return(0,S.Z)(i,[{key:"setModelService",value:function(e){this.modelService=e}},{key:"setCanvas",value:function(e){this.logger.log(3,"setCanvas","entry"),this._canvas=e}},{key:"setToolbar",value:function(e){this.logger.log(3,"setToolbar","entry"),this.toolbar=e}},{key:"setModelFactory",value:function(e){this.logger.log(3,"setModelFactory","entry"),this.factory=e}},{key:"setModel",value:function(e,t){var i=this;this.logger.log(2,"setModel","entry > "+t),this.model=e,this.inheritedModel=this.createInheritedModel(e),this.inheritedModel=Dt.Z.addContainerChildrenToModel(this.inheritedModel),this.oldModel=m.Z.clone(e),this.render(t,(function(){i.toolbar?i.toolbar.setModel(e):console.debug("No toolbar in controller!")})),this._canvas&&(this._canvas.setFonts(e.fonts),this._canvas.setModel(this.model)),this.logger.log(3,"setModel","entry > "+t)}},{key:"setMode",value:function(e){this.logger.log(0,"setMode","entry > "+e),this.toolbar.setMode(e),this._canvas.setMode(e)}},{key:"setSinglePage",value:function(e){this.logger.log(0,"setSinglePage","entry > "+e)}},{key:"getZoomFactor",value:function(){return this._canvas?this._canvas.getZoomFactor():1}},{key:"render",value:function(e,t){var i=this;if(this.logger.log(2,"render","enter > screenID : "+e),this._canvas){var s=Lt.Z.createInheritedModel(this.model);requestAnimationFrame((function(){i._canvas.render(s),e&&i._canvas.moveToScreen(e),t&&t()}))}}},{key:"_requestRendering",value:function(e){this._zoomedModel&&(this._canvas.render(this._zoomedModel),e&&this._canvas.moveToScreen(e)),this._zoomedModel=null}},{key:"_zoomToScreen",value:function(e){if(e&&this.model.screens[e]){var t=this.model.screens[e],i=c.Z.getBox(),s=i.w/t.w,n=i.h/t.h,o=Math.floor(10*Math.min(s,n))/10-.2;this._canvas.setZoom(o)}}},{key:"onWidgetSelected",value:function(e){this.logger.log(0,"onWidgetSelected","enter > "+e);var t=this.inheritedModel.widgets[e];t?this.toolbar&&this.toolbar.onWidgetSelected(t):console.warn("onWidgetSelected() > No width with id",e)}},{key:"onScreenSelected",value:function(e){this.logger.log(1,"onScreenSelected","enter > "+e);var t=this.model.screens[e];this.toolbar&&this.toolbar.onScreenSelected(t)}},{key:"onCanvasSelected",value:function(){this.logger.log(1,"onCanvasSelected","enter "),this.toolbar&&this.toolbar.onCanvasSelected()}},{key:"onLineSelected",value:function(e){this.logger.log(1,"onLineSelected","enter > "+e);var t=this.model.lines[e];this.toolbar&&this.toolbar.onLineSelected(t)}},{key:"onMultiSelect",value:function(e){this.logger.log(1,"onMultiSelect","enter > "),this.toolbar&&this.toolbar.onMultiSelect(e)}},{key:"onGroupSelected",value:function(e){if(this.logger.log(1,"onGroupSelected","enter > "+e),this.model.groups&&this.model.groups[e]&&this.toolbar){var t=this.model.groups[e];this.toolbar.onGroupSelect(t)}}},{key:"unSelect",value:function(){this._canvas&&this._canvas.unSelect(),this.toolbar&&this.toolbar.cleanUp()}},{key:"showSuccess",value:function(e){this._canvas&&this._canvas.showSuccess(e)}},{key:"showError",value:function(e){this._canvas&&this._canvas.showError(e)}}]),i}(Dt.Z),Ot={name:"Design",mixins:[r.Z],data:function(){return{selectedViewMode:"",viewport:null}},components:{DesignToolbar:h.Z,DesignCanvas:d.Z,AnalyticToolbar:Oe,AnalyticCanvas:Zt},computed:{pub:function(){return this.$route.meta&&this.$route.meta.isPublic},mode:function(){return this.pub?"public":"private"}},methods:{onViewPortChange:function(e){this.viewport=e},onVieModeChange:function(e){this.logger.log(-1,"onVieModeChange","enter",e),this.load(e)},onMouseWheel:function(e){e&&Math.abs(e.deltaX)>50&&(this.logger.log(-1,"onMouseWheel","cancel"),e.preventDefault())},load:function(e){"Design"===e?this.loadData(e):this.loadAnlyticData(e)},loadData:function(e){var t=this,i=this.$route.params.id;this.logger.log(3,"loadData","enter",i),Promise.all([this.loadApp(i),this.loadCommands(i),this.loadInvitations(i)]).then((function(i){t.cache.app=i[0],t.cache.commands=i[1],t.cache.inivitations=i[2];var s=i[2],n=t.getHashFromInvitation(s);t.selectedViewMode=e,t.$nextTick((function(){t.buildCanvas(i[0],i[1],n)}))}))},loadAnlyticData:function(e){var t=this,i=this.$route.params.id;this.logger.log(0,"loadAnlyticData","enter",i),Promise.all([this.loadApp(i),this.loadTest(i),this.loadEvents(i),this.loadAnnotations(i),this.loadInvitations(i)]).then((function(i){t.cache.app=i[0],t.cache.test=i[1],t.cache.events=i[2],t.cache.annotation=i[3],t.cache.inivitations=i[4];var s=i[4],n=t.getHashFromInvitation(s);t.selectedViewMode=e,t.$nextTick((function(){t.buildAnalyticCanvas(i[0],i[1],i[2],i[3],n)}))}))},getHashFromInvitation:function(e){var t={};for(var i in e)t[e[i]]=i;var s=t[1];return s},loadAll:function(){var e=this,t=this.$route.params.id;this.logger.log(2,"loadAll","enter",t),Promise.all([this.loadApp(t),this.loadTest(t),this.loadEvents(t),this.loadAnnotations(t),this.loadInvitations(t),this.loadCommands(t)]).then((function(t){e.cache.app=t[0],e.cache.test=t[1],e.cache.events=t[2],e.cache.annotation=t[3],e.cache.inivitations=t[4],e.cache.commands=t[5]}))},loadTest:function(e){return this.cache.test?this.cache.test:this.modelService.findTest(e)},loadEvents:function(e){return this.cache.events?this.cache.events:this.modelService.findEvents(e)},loadAnnotations:function(e){return this.cache.annotation?this.cache.annotation:this.modelService.findSessionAnnotations(e)},loadApp:function(e){return this.cache.app?this.cache.app:this.modelService.findApp(e)},loadCommands:function(e){return this.cache.commands?this.cache.commands:this.modelService.getCommands(e)},loadInvitations:function(e){return this.cache.inivitations?this.cache.inivitations:this.modelService.findInvitation(e)},setCache:function(e,t){this.cache[e]=t},buildCanvas:function(e,t,i){var s=this;this.logger.log(3,"buildCanvas","enter");var n=this.$refs.canvas,o=this.$refs.toolbar,a=new u.Z,r=this.modelService,l=new g.Z;l.setModel(e);var c=new v.Z;c.setModel(e),c.setHash(i),a.setModelService(r),a.setToolbar(o),a.setModelFactory(l),this.pub&&(a.setPublic(!0),n.setPublic(!0),o.setPublic(!0)),o.setController(a),o.setCommentService(f.Z.getCommentService()),o.setCanvas(n),o.setUser(this.user),o.setModelFactory(l),o.setContext(this.context),o.setModelService(r),o.setHash(i),n.setController(a),n.setCommentService(f.Z.getCommentService()),n.setToolbar(o),n.setRenderFactory(c),n.setModelFactory(l),n.setModelService(r),n.setUser(this.user),this.tempOwn((0,p.Z)(o,"newScreen",m.Z.hitch(n,"addScreen"))),this.tempOwn((0,p.Z)(o,"newWidget",m.Z.hitch(n,"addWidget"))),this.tempOwn((0,p.Z)(o,"newLine",m.Z.hitch(n,"addLine"))),this.tempOwn((0,p.Z)(o,"newComment",m.Z.hitch(n,"addComment"))),this.tempOwn((0,p.Z)(o,"newTemplatedWidget",m.Z.hitch(n,"addTemplatedWidget"))),this.tempOwn((0,p.Z)(o,"newTemplatedScreen",m.Z.hitch(n,"addTemplatedScreen"))),this.tempOwn((0,p.Z)(o,"newTemplatedGroup",m.Z.hitch(n,"addTemplatedGroup"))),this.tempOwn((0,p.Z)(o,"newThemedScreen",m.Z.hitch(n,"addThemedScreen"))),this.tempOwn((0,p.Z)(o,"newThemedGroup",m.Z.hitch(n,"addThemedGroup"))),this.tempOwn((0,p.Z)(o,"newThemedWidget",m.Z.hitch(n,"addThemedWidget"))),this.tempOwn((0,p.Z)(o,"newMultiThemedScreen",m.Z.hitch(n,"addMultiThemedScreens"))),this.tempOwn((0,p.Z)(o,"newThemedScreenAndWidget",m.Z.hitch(n,"addThemedScreenAndWidgets"))),this.tempOwn((0,p.Z)(o,"newImportApp",m.Z.hitch(n,"addImportedApp"))),this.tempOwn((0,p.Z)(o,"onNewLogicObject",m.Z.hitch(n,"addLogicGroup"))),this.tempOwn((0,p.Z)(o,"onNewRestObject",m.Z.hitch(n,"addRestObject"))),this.tempOwn((0,p.Z)(o,"onNewScriptObject",m.Z.hitch(n,"addScriptObject"))),this.tempOwn((0,p.Z)(o,"onNewSVG",m.Z.hitch(n,"addSVG"))),this.tempOwn((0,p.Z)(o,"onEditSVG",m.Z.hitch(n,"openSVGEditor"))),a.setCommandStack(t),a.setModel(e,this.$route.params.sid),n.initLayer(),this.pub||"guest"===this.user.role||(this.collabSession=new w(this.user),this.collabSession.initWebsocket(e,n,a,o),window.onbeforeunload=function(){s.collabSession.sendBye()})},buildAnalyticCanvas:function(e,t,i,s,n){this.logger.log(-1,"buildAnalyticCanvas","enter",n);var o=this.$refs.canvas,a=this.$refs.toolbar,r=new xt,l=f.Z.getModelService(),c=new g.Z;c.setModel(e);var h=new v.Z;h.setModel(e),h.setHash(n),r.setModelService(l),r.setToolbar(a),r.setModelFactory(c),a.setController(r),a.setCanvas(o),a.setUser(this.user),a.setModelFactory(c),a.setModelService(l),a.setEvents(i),a.setAnnotation(s),a.setTest(t),a.setCommentService(f.Z.getCommentService()),a.setPublic(this.isPublic),o.setController(r),o.setToolbar(a),o.setRenderFactory(h),o.setModelFactory(c),o.setCommentService(f.Z.getCommentService()),o.setUser(this.user),o.setEvents(i),o.setAnnotation(s),o.setTest(t),this.tempOwn((0,p.Z)(a,"newComment",m.Z.hitch(o,"addComment")));var d=null;for(var u in e.screens){var M=e.screens[u];if(M.props&&M.props.start){d=u;break}}r.setModel(e,d)},getModeFromRoute:function(){return"Heatmap"===this.$route.meta.viewMode?"Heatmap":"Design"}},beforeDestroy:function(){this.collabSession&&(this.collabSession.sendBye(),this.collabSession.close())},mounted:function(){var e=this;return(0,a.Z)((0,o.Z)().mark((function t(){var i;return(0,o.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.logger=new M.Z("Design"),e.cache={},l.Z.add(c.Z.body(),"MatcVisualEditor"),t.next=5,f.Z.getUserService().load();case 5:e.user=t.sent,e.modelService=f.Z.getModelService(e.$route),i=e.getModeFromRoute(),e.load(i),e.logger.log(-1,"mounted","exit > "+i),setTimeout((function(){return e.loadAll()}),3e3);case 11:case"end":return t.stop()}}),t)})))()}},Pt=Ot,Wt=(0,N.Z)(Pt,s,n,!1,null,null,null),Bt=Wt.exports},21967:function(e,t,i){i.r(t),i.d(t,{default:function(){return re}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvasPage MatcShare",attrs:{id:"CanvasNode"}},[i("ShareCanvas",{ref:"canvas"})],1)},n=[],o=i(50124),a=i(48534),r=(i(41539),i(78783),i(33948),i(93921)),l=i(93134),c=i(32551),h=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"},[i("div",{staticClass:"MatcCanvasFrame",attrs:{"data-dojo-attach-point":"frame"}},[i("div",{staticClass:"MatcCanvasContainer MatcCanvasZoomable ",attrs:{"data-dojo-attach-point":"container"}},[e._m(0),i("div",{staticClass:"MatcDnDLayer",attrs:{"data-dojo-attach-point":"dndContainer"},on:{click:e.onDNDLayerClick}})])]),e._m(1),e._m(2),i("div",{staticClass:"MatcMessage",attrs:{"data-dojo-attach-point":"message"}})])},d=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvasContainer ",attrs:{"data-dojo-attach-point":"zoomContainer"}},[i("div",{staticClass:"MatcCanvasLayer",attrs:{"data-dojo-attach-point":"screenContainer"}}),i("div",{staticClass:"MatcCanvasLayer",attrs:{"data-dojo-attach-point":"widgetContainer"}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvasScrollBar MatcCanvasScrollBarRight",attrs:{"data-dojo-attach-point":"scrollRight"}},[i("div",{staticClass:"MatcCanvasScrollBarCntr MatcCanvasScrollBarCntrRight",attrs:{"data-dojo-attach-point":"scrollRightCntr"}},[i("div",{staticClass:"MatchCanvasScrollHandle",attrs:{"data-dojo-attach-point":"scrollRightHandler"}})])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcCanvasScrollBar MatcCanvasScrollBarBottom",attrs:{"data-dojo-attach-point":"scrollBottom"}},[i("div",{staticClass:"MatcCanvasScrollBarCntr MatcCanvasScrollBarCntrBottom",attrs:{"data-dojo-attach-point":"scrollBottomCntr"}},[i("div",{staticClass:"MatchCanvasScrollHandle",attrs:{"data-dojo-attach-point":"scrollBottomHandler"}})])])}],u=i(14285),g=i(24615),v=i(42477),m=i(52298),p=i(66839),f=i(40626),M=i(55887),C=i(51804),S=i(73964),y=i(83246),w=i(77433),b=i(15405),k=i(97079),Z=i(65448),T=i(88280),_=i(66538),D=i(85677),L=i(24992),x=i(50681),O=i(56300),P=i(29701),W=i(86081),B=i(85983),A=i(98825),H=i(50597),E=i(11747),V=i(93374),F=i(15378),N=i(45107),R=i(21987),U=i(11477),I={name:"ShareCanvas",mixins:[r.Z,y.Z,H.Z,b.Z,k.Z,Z.Z,T.Z,_.Z,D.Z,L.Z,x.Z,O.Z,P.Z,W.Z,B.Z,V.Z,F.Z,N.Z,w.Z,R.Z],data:function(){return{mode:"view",zoom:.4,zoomLevelPos:3,analyticMode:"HeatmapClick",resizeEnabled:!1,renderDND:!0,dragNDropMinTimeSpan:0,wireInheritedWidgets:!0,taskLineOpacity:1}},components:{},methods:{postCreate:function(){this.logger=new u.Z("ShareCanvas"),this.logger.log(2,"postCreate","entry"),this.domUtil=new U.Z,this.initSize(),this.initWiring(),this.cache={},this.moveMode="classic",this.canvasPos={x:this.canvasStartX,y:this.canvasStartY,w:this.canvasFlowWidth,h:this.canvasFlowHeight},this.initContainerSize(),this.setContainerPos(),this.db=new M.Z,this.initSelection(),this.initRender(),this.initZoom(),this.initScrollBars(),this.initComment(),this.initSettings(),this.initMouseTracker(),this.initButtons(),this.own(p.Z.subscribe("matc/toolbar/click",v.Z.hitch(this,"onToolbarClick"))),this.own((0,g.Z)(m.Z.body(),"keydown",v.Z.hitch(this,"onKeyPress"))),this.own((0,g.Z)(m.Z.body(),"keyup",v.Z.hitch(this,"onKeyUp"))),this.logger.log(2,"postCreate","exit!!!")},closeSVGEditor:function(){},setModelService:function(e){this.modelService=e},setCommentService:function(e){this.commentService=e},setPublic:function(e){this.isPublic=e},inlineEditInit:function(){this.logger.log(2,"inlineEditInit","enter")},onZoomMinusClick:function(){var e=Math.round(10*(this.zoom-.1))/10;this.setZoomFactor(e)},onZoomPlusClick:function(){var e=Math.round(10*(this.zoom+.1))/10;this.setZoomFactor(e)},onTogggleLine:function(){this.setViewLines(!this.renderLines)},setSubMode:function(){},cleanUpGridResize:function(){},setBW:function(e){this.logger.log(-1,"setBW","enter > "+e),e?l.Z.add(this.container,"MatcCanvasBW"):l.Z.remove(this.container,"MatcCanvasBW")},onChangeCanvasViewConfig:function(){},setCanvasViewConfig:function(e,t){this.logger.log(-1,"setCanvasViewConfig","enter > "+e,t)},setHash:function(e){this.logger.log(-1,"setHash","entry > ",e),this.hash=e},renderLayerList:function(){this.logger.log(1,"renderLayerList","entry > ")},onDNDLayerClick:function(){},initButtons:function(){var e=this.db.div("MatcTestCommentButton MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-comment MatcMiddle").build(e),this.own((0,g.Z)(e,"click",v.Z.hitch(this,"onNewComment"))),setTimeout((function(){l.Z.remove(e,"MatcFadeOut")}),100);var t=this.db.div("MatcTestQRButton  MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-play MatcMiddle").build(t),this.own((0,g.Z)(t,"click",v.Z.hitch(this,"onSimulator"))),setTimeout((function(){l.Z.remove(t,"MatcFadeOut")}),200);var i=this.db.div("MatcTestQRButton MatcShareZoomOut MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-magnify-minus-outline MatcMiddle").build(i),this.own((0,g.Z)(i,"click",v.Z.hitch(this,"onZoomMinusClick"))),setTimeout((function(){l.Z.remove(i,"MatcFadeOut")}),300);var s=this.db.div("MatcTestQRButton  MatcShareZoomIn MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-magnify-plus-outline MatcMiddle").build(s),this.own((0,g.Z)(s,"click",v.Z.hitch(this,"onZoomPlusClick"))),setTimeout((function(){l.Z.remove(s,"MatcFadeOut")}),400);var n=this.db.div("MatcTestQRButton MatcShareLine MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-vector-line MatcMiddle").build(n),this.own((0,g.Z)(n,"click",v.Z.hitch(this,"onTogggleLine"))),setTimeout((function(){l.Z.remove(n,"MatcFadeOut")}),500)},onNewComment:function(e){this.logger.log(1,"onNewComment","enter > "),this.addComment({event:e,type:"comment"})},loadComments:function(){var e=this;return(0,a.Z)((0,o.Z)().mark((function t(){var i;return(0,o.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.logger.log(1,"loadComments","enter > ",e.model),e.model&&e.hash||console.error("loadComments() > no model or hash"),t.next=4,e.commentService.findByHash(e.model.id,e.hash,"ScreenComment");case 4:i=t.sent,e.onCommentsLoaded(i);case 6:case"end":return t.stop()}}),t)})))()},saveDNDChange:function(e){var t=this;return(0,a.Z)((0,o.Z)().mark((function i(){var s;return(0,o.Z)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.commentService.updateByHash(t.model.id,t.hash,e);case 2:s=i.sent,t.onCommentSaved(s);case 4:case"end":return i.stop()}}),i)})))()},onSaveComment:function(e){var t=arguments,i=this;return(0,a.Z)((0,o.Z)().mark((function s(){var n,a,r,l;return(0,o.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(n=t.length>1&&void 0!==t[1]&&t[1],!e.id){s.next=14;break}return a=i.comments[e.id],a.message=e.message,a.status=e.status,a.modified=(new Date).getTime(),a.edited=!0,s.next=9,i.commentService.updateByHash(i.model.id,i.hash,a);case 9:r=s.sent,i.updateCommentIcon(a),i.onCommentSaved(r),s.next=18;break;case 14:return s.next=16,i.commentService.createByHash(i.model.id,i.hash,e);case 16:l=s.sent,i.onCommentSaved(l);case 18:n||i.onCloseCommentPopup();case 19:case"end":return s.stop()}}),s)})))()},onSimulator:function(e){this.startSimilator(e)},startSimilator:function(){this.logger.log(0,"startSimilator","entry");var e=f.Z.position(m.Z.body()),t=e.h-100;l.Z.add(m.Z.body(),"MatcCanvasSimulatorVisible"),"desktop"===this.defaultModel.type?(e.w=.75*e.w,e.h=.75*e.h,this._showDesktopSimulator(this.model,e,t)):"tablet"===this.defaultModel.type?this.defaultModel.screenSize.w>this.model.screenSize.h?(e.w=.65*e.w,e.h=.65*e.h,this._showMobileTest(this.defaultModel,e,"MatchSimulatorWrapperTablet",t)):(e.w=.35*e.w,e.h=.35*e.h,this._showMobileTest(this.defaultModel,e,"MatchSimulatorWrapperTablet",t)):(e.w=.25*e.w,e.h=.25*e.h,this._showMobileTest(this.defaultModel,e,"MatchSimulatorWrapperMobile",t))},_showDesktopSimulator:function(e,t,i){var s=document.createElement("div");l.Z.add(s,"MatchSimulatorDialog");var n=document.createElement("div");if(l.Z.add(n,"MatchSimulatorContainer"),s.appendChild(n),t=this.getScaledSize(t,"width",this.model),t.h>i){var o=t.h/i;t.h=t.h/o,t.w=t.w/o}n.style.width=Math.round(t.w)+"px",n.style.height=Math.round(t.h)+"px";var a=this.$new(A.Z,{mode:"debug",logData:!1});a.scrollListenTarget="parent",a.isDesktopTest=!0,a.setHash(this.hash);var r=this.$new(S.Z,{canDestroy:!0});r.placeAt(n);var c=new C.Z;c.hasCSSAnimation=!1,c.popup(s,this.simulatorButton),c.own(c.on("close",v.Z.hitch(this,"stopSimulator",a,r))),c.own((0,g.Z)(s,"click",(function(e){e.target===s&&c.close()}))),e=this.defaultModel;var h=this._getSimulatorScreen();a.setStartScreen(h),setTimeout((function(){r.wrap(a.domNode),a.setModel(e)}),500),this.canvas&&(this.canvas.enableMouseZoom(!1),this.canvas.setState("simulate"))},_showMobileTest:function(e,t,i,s){var n=document.createElement("div");l.Z.add(n,"MatchSimulatorDialog");var o=document.createElement("div");l.Z.add(o,"MatchSimulatorWrapper "),i&&l.Z.add(o,i),n.appendChild(o);var a=document.createElement("div");if(l.Z.add(a,"MatchSimulatorContainer"),t=this.getScaledSize(t,"width",this.model),t.h>s){var r=t.h/s;t.h=Math.ceil(t.h/r),t.w=Math.ceil(t.w/r)}a.style.width=Math.ceil(t.w)+"px",a.style.height=Math.ceil(t.h)+"px",o.style.width=Math.ceil(t.w)+"px",o.style.height=Math.ceil(t.h)+"px",l.Z.add(o,"MatcSimulatorFadeOut"),o.appendChild(a);var c=this.$new(S.Z,{canDestroy:!0});c.placeAt(a);var h=this.$new(A.Z,{mode:"debug",logData:!1});h.scrollListenTarget="parent",h.isDesktopTest=!0,h.setHash(this.hash);var d=this.getSettings();if(!1!==d.hasQRCode){var u=document.createElement("div");l.Z.add(u,"MatcSimulatorQRWrapper"),n.appendChild(u);var m=document.createElement("img");E.Z.getQRCode(this.hash,!1,!0).then((function(e){m.src=e})),l.Z.add(m,"MatcSimulatorQR"),u.appendChild(m)}var p=new C.Z;p.hasCSSAnimation=!1,p.popup(n,this.simulatorButton),p.on("close",v.Z.hitch(this,"stopSimulator",h,c)),p.own((0,g.Z)(n,"click",(function(e){e.target===n&&p.close()}))),e=this.defaultModel;var f=this._getSimulatorScreen();console.debug(f),h.setStartScreen(f),setTimeout((function(){c.wrap(h.domNode),h.setModel(e),l.Z.remove(o,"MatcSimulatorFadeOut")}),600),this.canvas&&(this.canvas.enableMouseZoom(!1),this.canvas.setState("simulate"))},_getSimulatorScreen:function(){if(this._selectedScreen)return this._selectedScreen;if(this._selectedGroup){var e=this._selectedGroup.children[0];return this.getParentScreen({id:e})}return this._selectedWidget?this.getParentScreen(this._selectedWidget):void 0},initWiring:function(){var e=this;this.logger.log(-1,"initWiring","enter"),this.own((0,g.Z)(this.dndContainer,"mousedown",(function(t){return e.dispatchMouseDown(t)})))},dispatchMouseDownCanvas:function(e){this.logger.log(1,"dispatchMouseDownCanvas","enter",e,this.mode),this.onDragStart(this.container,"container","onCanvasDnDStart","onCanvasDnDMove","onCanvasDnDEnd",null,e)},dispatchMouseDownScreen:function(e,t){this.logger.log(-1,"dispatchMouseDownScreen","enter",t)},dispatchMouseDownWidget:function(e,t){this.logger.log(-1,"dispatchMouseDownWidget","enter",t);var i=this.widgetDivs[t];this.onWidgetDndClick(t,i)},onWidgetDndClick:function(e,t,i,s){this.stopEvent(s),this.logger.log(1,"onWidgetDndClick","enter > "+e),this.setState(0)},highlightActionWidgets:function(){this.logger.log(2,"highlightActionWidgets","entry > ");var e=[];for(var t in this.model.widgets){var i=this.model.widgets[t];if(i){var s=this.getLinesForWidget(i);if(s){var n=this.analyticsDivs[i.id];n&&(e.push(n),l.Z.add(n,"MatcSimulatorWidgetHightlight"))}}}setTimeout((function(){for(var t=0;t<e.length;t++)l.Z.remove(e[t],"MatcSimulatorWidgetHightlight")}),500)},onScreenDndClick:function(e,t,i,s){this.logger.log(-1,"onScreenDndClick","entry > "+e),this.stopEvent(s),this.highlightActionWidgets(),this.setState(0),this.onCanvasSelected()},onCanvasSelected:function(){this.logger.log(-2,"onCanvasSelected","entry > ")},updateGridRezise:function(){},animateToScreen:function(e,t){this.moveToScreen(e),setTimeout((function(){l.Z.remove(t,"MatcShareCanvasAnimatedContainer")}),500)},afterRender:function(){this.logger.log(-1,"afterRender","entry > "+this.analyticMode),this.cleanUpAnalytics()},hasSelect:function(){return"addComment"!=this._mode},cleanUpAnalytics:function(){this.analyticsDivs={}},setController:function(e){this.logger.log(2,"setController","enter"),this.controller=e,e.setCanvas(this)},getController:function(){return this._controllerCallback&&this[this._controllerCallback](),this.controller},setControllerCallback:function(e){this._controllerCallback=e},setModelFactory:function(e){this.logger.log(3,"setModelFactory","enter"),this.factory=e},setRenderFactory:function(e){this.logger.log(0,"setRenderFactory","enter"),this.renderFactory=e},setModel:function(e){this.logger.log(-3,"setModel","enter"),this.model=e,this.defaultModel=e,this.grid=this.model.grid,this.isCommentsLoaded||(this.loadComments(),this.isCommentsLoaded=!0)},setTest:function(e){this.logger.log(2,"setTest","enter > # "),this.testSettings=e},setUser:function(e){this.user=e},setMode:function(e,t){this.logger.log(2,"setMode","enter > "+e+" != "+this._mode+" > "+t),e!=this._mode?(this._mode=e,this.toolbar&&this.toolbar.setMode(e),this.rerender()):t&&this.rerender()},getMode:function(){return this._mode},onKeyPress:function(e){if(this._currentKeyEvent=e,"simulate"!=this.state&&"dialog"!=this.state){var t=e.target;if(!l.Z.contains(t,"MatcIgnoreOnKeyPress")){var i=e.keyCode?e.keyCode:e.which;32==i?this._inlineEditStarted||(this.stopEvent(e),"move"!=this.getMode()&&(this.showHint("Move the mouse to move canvas..."),this.onDragStart(this.container,"container","onCanvasDnDStart","onCanvasDnDMove","onCanvasDnDEnd",null,this._lastMouseMoveEvent,!0),this.setMode("move"))):171==i||187==i?this._inlineEditStarted||(this.onClickPlus(),this.stopEvent(e)):173!=i&&189!=i||this._inlineEditStarted||(this.onClickMinus(),this.stopEvent(e))}}},onKeyUp:function(e){var t=e.keyCode?e.keyCode:e.which;32==t&&(this.onDragEnd(this._lastMouseMoveEvent),this.setMode("view")),delete this._currentKeyEvent},initSettings:function(){this.logger.log(1,"initSettings","enter > "),this.settings={canvasTheme:"MatcLight",lineColor:"#999",lineWidth:1,storePropView:!0,moveMode:"ps",mouseWheelMode:"scroll"};var e=this._getStatus("matcSettings");e?(e.canvasTheme,e.lineColor&&(this.settings.lineColor=e.lineColor),e.lineWidth&&(this.settings.lineWidth=e.lineWidth)):this.logger.log(2,"initSettings","exit>  no saved settings"),this.applySettings(this.settings)},getSettings:function(){return this.settings},setSettings:function(e){e.canvasTheme&&(this.settings.canvasTheme=e.canvasTheme),e.lineColor,e.lineWidth&&(this.settings.lineWidth=e.lineWidth),null!=e.storePropView&&(this.settings.storePropView=e.storePropView),null!=e.mouseWheelMode&&(this.settings.mouseWheelMode=e.mouseWheelMode),this._setStatus("matcSettings",this.settings),this.applySettings(this.settings),this.rerender()},applySettings:function(e){this.logger.log(2,"applySettings","enter > "+e.canvasTheme+" &> "+e.moveMode),e.lineWidth&&(this.defaultLineWidth=e.lineWidth),e.canvasTheme&&(this._lastCanvasTheme&&l.Z.remove(m.Z.body(),this._lastCanvasTheme),l.Z.add(m.Z.body(),e.canvasTheme),this._lastCanvasTheme=e.canvasTheme),e.mouseWheelMode&&(this._mouseWheelMode=e.mouseWheelMode),this.settings=e},getLinesForWidget:function(e){e.inherited&&this.model.widgets[e.inherited]&&(e=this.model.widgets[e.inherited]);var t=e.id,i=this.getFromLines(e);if(i&&i.length>0)return i;var s=this.getParentGroup(t);if(s){var n=this.getFromLines(s);if(n&&n.length>0)return n}},getLineForGesture:function(e,t){for(var i=0;i<e.length;i++)if(e[i].event===t||"click"===t&&!e[i].event)return e[i]},initMouseTracker:function(){this.own((0,g.Z)(m.Z.body(),"mousemove",v.Z.hitch(this,"onMouseMove")))},onMouseMove:function(e){var t=this.getCanvasMousePosition(e,!0);this._lastMousePos=t,this._lastMouseMoveEvent=e},destroy:function(){this.cleanUp()}},mounted:function(){}},G=I,$=i(43736),z=(0,$.Z)(G,h,d,!1,null,null,null),j=z.exports,J=i(13087),K=i(62833),q=i(39110),X=i(26720),Q=i(71251),Y=i(62811),ee=function(e){(0,q.Z)(i,e);var t=(0,X.Z)(i);function i(){var e;return(0,J.Z)(this,i),e=t.call(this),e.logger=new u.Z("ShareContoller"),e.logger.log(2,"constructor","exit"),e}return(0,K.Z)(i,[{key:"setCanvas",value:function(e){this.logger.log(3,"setCanvas","entry"),this._canvas=e}},{key:"setToolbar",value:function(e){this.logger.log(3,"setToolbar","entry"),this.toolbar=e}},{key:"setModelService",value:function(e){this.modelService=e}},{key:"setModelFactory",value:function(e){this.logger.log(3,"setModelFactory","entry"),this.factory=e}},{key:"setModel",value:function(e,t){this.logger.log(2,"setModel","entry > "+t),this.model=e;var i=this.countProps(e.screens);i>4&&this._canvas&&(this._canvas.zoom=.25,this._canvas.zoomLevelPos=2),this.inheritedModel=this.createInheritedModel(e),this.oldModel=v.Z.clone(e),this.render(t),this.toolbar&&this.toolbar.setModel(e),this._canvas&&this._canvas.setFonts(e.fonts),this.logger.log(3,"setModel","entry > "+t)}},{key:"setMode",value:function(e){this.logger.log(0,"setMode","entry > "+e),this.toolbar&&this.toolbar.setMode(e),this._canvas.setMode(e)}},{key:"setSinglePage",value:function(e){this.logger.log(0,"setSinglePage","entry > "+e)}},{key:"getZoomFactor",value:function(){return this._canvas?this._canvas.getZoomFactor():1}},{key:"render",value:function(e){var t=this;if(this.logger.log(2,"render","enter > screenID : "+e),this._canvas){var i=Y.Z.createInheritedModel(this.model);requestAnimationFrame((function(){t._canvas.setModel(i),t._canvas.render(i),e&&t._canvas.moveToScreen(e)}))}}},{key:"_requestRendering",value:function(e){this._zoomedModel&&(this._canvas.render(this._zoomedModel),e&&this._canvas.moveToScreen(e)),this._zoomedModel=null}},{key:"_zoomToScreen",value:function(e){if(e&&this.model.screens[e]){var t=this.model.screens[e],i=c.Z.getBox(),s=i.w/t.w,n=i.h/t.h,o=Math.floor(10*Math.min(s,n))/10-.2;this._canvas.setZoom(o)}}},{key:"onWidgetSelected",value:function(e){this.logger.log(0,"onWidgetSelected","enter > "+e);var t=this.inheritedModel.widgets[e];t?this.toolbar&&this.toolbar.onWidgetSelected(t):console.warn("onWidgetSelected() > No width with id",e)}},{key:"onScreenSelected",value:function(e){this.logger.log(1,"onScreenSelected","enter > "+e);var t=this.model.screens[e];this.toolbar&&this.toolbar.onScreenSelected(t)}},{key:"onCanvasSelected",value:function(){this.logger.log(1,"onCanvasSelected","enter "),this.toolbar&&this.toolbar.onCanvasSelected()}},{key:"onLineSelected",value:function(e){this.logger.log(1,"onLineSelected","enter > "+e);var t=this.model.lines[e];this.toolbar&&this.toolbar.onLineSelected(t)}},{key:"onMultiSelect",value:function(e){this.logger.log(1,"onMultiSelect","enter > "),this.toolbar&&this.toolbar.onMultiSelect(e)}},{key:"onGroupSelected",value:function(e){if(this.logger.log(1,"onGroupSelected","enter > "+e),this.model.groups&&this.model.groups[e]&&this.toolbar){var t=this.model.groups[e];this.toolbar.onGroupSelect(t)}}},{key:"unSelect",value:function(){this._canvas&&this._canvas.unSelect(),this.toolbar&&this.toolbar.cleanUp()}},{key:"showSuccess",value:function(e){this._canvas&&this._canvas.showSuccess(e)}},{key:"showError",value:function(e){this._canvas&&this._canvas.showError(e)}}]),i}(Q.Z),te=i(73311),ie=i(95989),se=i(27437),ne={name:"Design",mixins:[r.Z],data:function(){return{}},components:{ShareCanvas:j},computed:{pub:function(){return this.$route.meta&&this.$route.meta.isPublic},mode:function(){return this.pub?"public":"private"}},methods:{loadData:function(){var e=this,t=this.$route.query.h;this.logger.log(0,"loadData","enter",t),Promise.all([this.modelService.findAppByHash(t)]).then((function(t){e.buildCanvas(t[0])}))},buildCanvas:function(e){this.logger.log(0,"buildCanvas","enter");var t=this.$refs.canvas,i=new ee,s=this.modelService,n=new te.Z;n.setModel(e);var o=new ie.Z;o.setModel(e),o.setHash(this.$route.query.h),i.setModelService(s),i.setModelFactory(n),this.pub&&i.setPublic(!0),t.setController(i),t.setCommentService(se.Z.getCommentService()),t.setRenderFactory(o),t.setModelFactory(n),t.setModelService(s),t.setUser(this.user),t.setHash(this.$route.query.h);var a=null;for(var r in e.screens){var l=e.screens[r];if(l.props&&l.props.start){a=r;break}}i.setModel(e,a)}},mounted:function(){var e=this;return(0,a.Z)((0,o.Z)().mark((function t(){return(0,o.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.logger=new u.Z("Design"),l.Z.add(c.Z.body(),"MatcVisualEditor"),e.modelService=se.Z.getModelService(e.$route),t.next=5,se.Z.getUserService().load();case 5:e.user=t.sent,e.loadData(),e.logger.log(3,"mounted","exit");case 8:case"end":return t.stop()}}),t)})))()}},oe=ne,ae=(0,$.Z)(oe,s,n,!1,null,null,null),re=ae.exports}}]);
//# sourceMappingURL=design-legacy.ffda54c4.js.map