"use strict";(self["webpackChunkquant_ux"]=self["webpackChunkquant_ux"]||[]).push([[598],{5928:function(e,t,s){s.r(t),s.d(t,{default:function(){return _t}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvasPage",attrs:{id:"CanvasNode"},on:{wheel:e.onMouseWheel}},["Design"===e.selectedViewMode?[s("DesignToolbar",{ref:"toolbar",attrs:{pub:e.pub},on:{viewModeChange:e.onVieModeChange}}),s("DesignCanvas",{ref:"canvas",attrs:{viewport:e.viewport},on:{viewport:e.onViewPortChange}})]:e._e(),"Heatmap"===e.selectedViewMode?[s("AnalyticToolbar",{ref:"toolbar",on:{viewModeChange:e.onVieModeChange}}),s("AnalyticCanvas",{ref:"canvas",attrs:{viewport:e.viewport},on:{viewport:e.onViewPortChange}})]:e._e()],2)},o=[],a=s(99917),n=s(93134),r=s(32551),l=s(13108),h=s(8160),c=s(59495),d=s(73311),g=s(41891),u=s(42477),m=s(24615),p=s(27437),v=s(14285),M=s(64686);class C{constructor(e){this.user=e,this.collabUsers=[]}initWebsocket(e,t,s,i){M.Z.log(3,"CollabSession.initWebsocket()","enter");try{let o=this.user,a=p.Z.getWebSocketService(e.id,o.token,o);a?(a.onMessage((e=>this.dispatchWebSocketMessage(t,s,i,o,e))),a.init((e=>{e&&this.sendHello(),t.setMouseListener((e=>{this.sendMouse(e)})),s.setModelChangeListener((e=>{this.sendChange(e)}))})),this.websocket=a):M.Z.log(1,"CollabSession.initWebsocket()","exit > No session created")}catch(o){M.Z.error("CollabSession.initWebsocket()","Cannot init WebSocket",o)}}hasOtherUsers(){let e=this.collabUsers.find((e=>e.id!==this.user.id));return void 0!==e}sendChange(e){M.Z.log(1,"CollabSession.sendChange()","enter",e),this.websocket&&this.hasOtherUsers()?(M.Z.log(2,"CollabSession.sendChange()","send",e),this.websocket.send({type:"change",changeEvent:e})):M.Z.log(2,"CollabSession.sendChange()","NOT SEND")}sendMouse(e){this.websocket&&this.hasOtherUsers()&&this.websocket.send({type:"mouse",pos:e})}sendBye(){M.Z.log(-1,"CollabSession.sendBye()","enter"),this.websocket&&this.websocket.send({type:"bye"})}sendHello(){M.Z.log(2,"CollabSession.sendHello()","enter"),this.websocket&&this.websocket.send({type:"hello"})}sendImHere(){M.Z.log(2,"CollabSession.sendImHere()","enter"),this.websocket&&this.websocket.send({type:"imhere"})}dispatchWebSocketMessage(e,t,s,i,o){"hello"===o.type&&(M.Z.log(2,"CollabSession.dispatchWebSocketMessage()","hello"),s.addCollabUser(o.user),e.addCollabUser(o.user),this.addCollabUser(o.user),this.sendImHere()),"imhere"===o.type&&(M.Z.log(2,"CollabSession.dispatchWebSocketMessage()","imhere"),s.addCollabUser(o.user),e.addCollabUser(o.user),this.addCollabUser(o.user)),"bye"===o.type&&(M.Z.log(2,"CollabSession.dispatchWebSocketMessage()","bye"),s.removeCollabUser(o.user),e.removeCollabUser(o.user),this.removeCollabUser(o.user)),"mouse"===o.type&&e.setCollabMouse(o.user,o.pos),"change"===o.type&&(M.Z.log(2,"CollabSession.dispatchWebSocketMessage()","change"),t.collabRecieveChanges(o.user,o.changeEvent))}addCollabUser(e){M.Z.log(1,"CollabSession.addCollabUser()",e);const t=this.collabUsers.find((t=>t.id===e.id));t||this.collabUsers.push(e)}removeCollabUser(e){M.Z.log(1,"CollabSession.removeCollabUser()",e),this.collabUsers=this.collabUsers.filter((t=>t.id!==e.id))}close(){M.Z.log(1,"CollabSession.dispatchWebSocketMessage()","close"),this.websocket&&this.websocket.close()}}var S=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcToolbar MatcAnalyticsToolbar MatcLayerListVisible"},[s("div",{staticClass:"MatcToolbarLayerList MatcToolbarAnalyticList MatcToobarPropertiesSection",style:"width:"+e.layerListWidth+"px"},[s("div",{staticClass:"MatcToolbarLayerListCntr",attrs:{"data-dojo-attach-point":"testListCntr"}}),s("div",{ref:"dndHanlde",staticClass:"MatcToolbarLayerListDND",on:{mousedown:function(t){return t.stopPropagation(),e.onResizeStart.apply(null,arguments)}}})]),s("div",{staticClass:"MatcToolbarTop "},[s("div",{staticClass:"MatcToolbarTopHome",style:"width:"+e.layerListWidth+"px"},[s("HomeMenu",{attrs:{name:e.modelName},on:{select:e.onHomeMenu}})],1),s("div",{staticClass:"MatcToolbarTopCntr",style:"width:calc(100% - "+e.layerListWidth+"px)"},[s("div",{staticClass:"MatcToolbarSection MatcToolbarTopLeft"},[s("div",{class:["MatcToolbarItem MatcToolbarPrimaryItem",{MatcToolbarItemSelected:"addComment"===e.mode}],attrs:{"data-dojo-attach-point":"commentBtn"},on:{click:e.onNewComment}},[s("QIcon",{attrs:{icon:"Comment"}})],1)]),s("div",{staticClass:"MatcToolbarTopCenterCntr"},[s("div",{staticClass:"MatcToolbarSection",attrs:{"data-dojo-attach-point":"screenSection"}},[e.events?s("AnalyticViewModeButton",{on:{change:e.onChangeViewMode}}):e._e()],1)]),s("div",{staticClass:"MatcToolbarNotificationSection MatcToolbarTopRight MatcToolbarSection",attrs:{"data-dojo-attach-point":"notificationSection"}},[s("ViewConfig",{attrs:{value:e.canvasViewConfig,analytic:!0},on:{change:e.onChangeCanvasViewConfig}}),s("HeatmapToggleButton",{attrs:{value:"Heatmap"},on:{change:function(t){return e.$emit("viewModeChange",t)}}}),s("div",{staticClass:"MatcToolbarItem",on:{click:e.showSharing}},[s("div",{staticClass:"MatcToobarPrimaryButton"},[e._v(" Share ")])])],1)])]),s("div",{staticClass:"MatcToobarPropertiesSection MatcToolbarSectionHidden",attrs:{"data-dojo-attach-point":"propertiesCntr"}})])},y=[],w=s(4623),b=s(53321),f=s(37339),Z=s(27519),k=s(55887),T=s(51804),_=s(17994),D=s(60359),L=s(95423),x=s(59947),O=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcDashHistogram"})},P=[],W=s(77907),B={name:"Histogram",mixins:[Z.Z,_.Z,a.Z],data:function(){return{x_prefix:""}},components:{},methods:{postCreate(){if(this.log=new v.Z("Histogram"),this.counts){var e=this.counts.split(","),t=new W.Z(e),s=t.hist(null,this.bins);this.setValue(s,t.mean())}},setPopoverFct(e){this.popoverLabelFct=e},setLabel(e){this.label.innerHTML=e},setMaxMin(e){this.minMaxFct=e},setFormTo(e){this.toFromFct=e},onHover(e){this.hoverFCT=e},setValue(e,t){var s=e.size(),i=e.max("count"),o=e.min("count"),a=e.min("from"),r=e.max("to"),l=100/(2*s-1),h=(t-a)/(r-a),c=new k.Z,d=c.div("MatcDashHistogramCntr").build(),g=this;if(e.foreach((function(e,t){var s=e.count,o=c.div("MatcDashHistogramBar").build(d);if(o.style.height=Math.max(1,100*s/i)+"%",o.style.width=l+"%",o.style.left=l*(2*t)+"%",g.hoverFCT){var a=g.hoverFCT(e);n.Z.add(o,"MatcDashHistogramBarHover"),g.addTooltip(o,a)}})),this.toFromFct&&(r=this.toFromFct(r),a=this.toFromFct(a)),c.span("MatcDashHistogramLabelMax MatcDashHistogramLabel",i).build(d),c.span("MatcDashHistogramLabelMin MatcDashHistogramLabel",o).build(d),c.span("MatcDashHistogramLabelFrom MatcDashHistogramLabel",a+this.x_prefix).build(d),c.span("MatcDashHistogramLabelTo MatcDashHistogramLabel",r+this.x_prefix).build(d),this.domNode.innerHTML,this.domNode.appendChild(d),null!=t&&void 0!=t){let e=c.div("MatcDashHistogramLabelMean").build(d);e.style.left=100*h+"%",this.toFromFct&&(t=this.toFromFct(t)),c.span("MatcDashHistogramLabel MatcHorizontalMiddle",t+this.x_prefix).build(e);let s=c.div("MatcDashHistogramBarMean").build(d);s.style.left=100*h+"%"}}},mounted(){}},A=B,H=s(1001),E=(0,H.Z)(A,O,P,!1,null,null,null),V=E.exports,F=s(21200),N=s(59841),R=s(52817),U=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:" MatcToolbarArrowDropDown MatcToolbarDropDownButton MatcToobarHomeSection MatcToobarHomeSectionBlueX"},[i("div",{ref:"button",staticClass:"MatcToolbarItem MatcToolbarPrimaryItem",attrs:{type:"button"}},[i("img",{attrs:{src:s(38879)}}),i("span",{staticClass:"MatcToobarHomeSectionAppNameLabel"},[e._v(e._s(e.name))]),i("span",{staticClass:"caret"})]),i("div",{staticClass:"MatcToolbarPopUp MatcToolbarDropDownButtonPopup",attrs:{role:"menu","data-dojo-attach-point":"popup"},on:{mousedown:function(e){e.stopPropagation()}}},[i("div",{staticClass:"MatcToolbarPopUpWrapper"},[i("ul",{attrs:{role:"menu"}},e._l(e.items,(function(t){return i("li",{key:t.value,staticClass:"MatcToolbarMenuItem",class:t.css,on:{click:function(s){return s.stopPropagation(),e.onSelect(t,s)}}},[i("label",{staticClass:"MatcToolbarPopUpLabel"},[e._v(e._s(t.label))])])})),0)]),e._m(0)])])},I=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcToolbarPopUpArrowCntr"},[s("div",{staticClass:"MatcToolbarPopUpArrow"})])}],G=s(89815),$={name:"CreateBasicButton",mixins:[f.Z,a.Z,G.Z],props:["name"],data:function(){return{selectedTool:null,tools:[{value:"onExit",icon:"",label:this.getNLS("toolbar.menu.exit")},{value:3,css:"MatcToolbarPopUpLine"},{value:"onShowSettings",icon:"",label:this.getNLS("toolbar.menu.settings")},{value:"showHelp",icon:"",label:this.getNLS("toolbar.menu.help")}]}},computed:{items(){return this.tools}},components:{},methods:{onSelect(e,t){this.$emit("select",e,t)},onHide(){n.Z.remove(this.domNode,"MatcToolbarItemActive"),this.selectedTool=null},async init(){}},mounted(){}},z=$,j=(0,H.Z)(z,U,I,!1,null,null,null),J=j.exports,K=s(43865),q=s(75183),X=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:["MatcToolbarNavButton",{MatcToolbarEditModeAnimated:e.animated}]},[s("div",{ref:"cntr",staticClass:"MatcToolbarEditModeCntr"},[e._l(e.modes,(function(t,i){return s("a",{key:t.value,ref:"btns",refInFor:!0,class:["MatcToolbarItem vommondToolTipCntr",{MatcToolbarEditModeActive:t.value===e.selected}],on:{click:function(s){return e.setSelected(t,i)}}},[s("span",{ref:"icons",refInFor:!0,class:"MatcToolbarResponsiveIcon "+t.icon}),s("span",{staticClass:"MatcToolbarResponsiveLabel"},[e._v(" "+e._s(t.label)+" ")])])})),s("div",{staticClass:"MatcToolbarEditModeHighlight",style:{width:e.highlightWidth+"px",left:e.highlightX+"px"}})],2)])},Q=[],Y=s(77852),ee=s(40626),te={name:"EditModeButton",mixins:[_.Z,Y.Z],props:["value"],data:function(){return{animated:!1,highlightWidth:0,highlightX:0,selected:"showClickHeatMap",modes:[{label:"Heatmaps",value:"showClickHeatMap",icon:"mdi mdi-cursor-default",tooltip:"tooltip.analyics-heatmaps"},{label:"User Journey",value:"showUserJourney",icon:"mdi mdi-vector-polyline",tooltip:"tooltip.analyics-user"},{label:"Tasks & Drop Off",value:"showDropOff",icon:"mdi mdi-chart-timeline-variant-shimmer",tooltip:"tooltip.analyics-task"},{label:"Screens",value:"showScreenMode",icon:"mdi mdi-chart-timeline-variant-shimmer",tooltip:"tooltip.analyics-screen"}]}},computed:{hasData(){return!this.value||this.value.hasDataView}},components:{},methods:{setSelected(e,t){this.log.log(1,"setSelected","enter",e),this.selected=e.value,this.setHighlight(t),this.$emit("change",e.value)},setHighlight(e){const t=this.$refs.btns[e],s=ee.Z.position(t),i=ee.Z.position(this.$refs.cntr);this.highlightWidth=s.w,this.highlightX=s.x-i.x-1},nextView(){}},watch:{value(e){this.log.log(2,"watch(value)","enter",e),this.value=e}},async mounted(){this.log=new v.Z("AnalyticViewModeButton"),this.setHighlight(0),setTimeout((()=>{this.modes.forEach(((e,t)=>{const s=this.$refs.btns[t];this.addTooltip(s,this.getNLS(e.tooltip))}))}),100),setTimeout((()=>this.animated=!0),500)}},se=te,ie=(0,H.Z)(se,X,Q,!1,null,null,null),oe=ie.exports,ae=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcToolbar MatcAnalyticsToolbar MatcLayerListVisible"})},ne=[],re=s(84866),le=s(65454),he=s(93284),ce=s(96121),de=s(21391),ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcToolbarSessionCntr MatcScrollContainer"},[s("div",{staticClass:"MatcToolbarSessionList "},e._l(e.sortedSession,(function(t){return s("div",{key:t.id,staticClass:"MatcToobarRow MatcToolbarIconButton",on:{click:function(s){return e.toggleSession(t)},mouseout:function(s){return e.onMouseOut(t,s)},dblclick:function(s){return e.onEdit(t)},mouseover:function(s){return e.onMouseOver(t,s)}}},[s("CheckBox",{attrs:{value:e.selected[t.session]}}),s("div",{staticClass:"MatcToolbarSessionLabels"},[t.session===e.selectedSession?s("input",{ref:"sessionInput",refInFor:!0,staticClass:"MatcIgnoreOnKeyPress",domProps:{value:t.label},on:{change:function(s){return e.onChangeSessionLabel(t,s)},click:function(e){e.stopPropagation()}}}):s("span",[e._v(e._s(t.label))]),s("div",{staticClass:"MatcToolbarSessionListDetails"},[s("div",[e._v(e._s(t.date))]),s("div",[e._v(e._s(t.duration)+"s")])])]),s("div",{staticClass:"MatcToobarRowRightIcon"},[s("QIcon",{attrs:{icon:"PlayVideo"},on:{click:function(s){return s.stopPropagation(),e.onPlay(t,s)}}})],1)],1)})),0)])},ue=[],me=(s(78525),{name:"SessionList",props:[],mixins:[a.Z],data:function(){return{sessions:[],selected:{},order:"date",selectedSession:""}},components:{CheckBox:le.Z,QIcon:q.Z},computed:{sortedSession(){const e=this.order;return this.sessions.toSorted(((t,s)=>"duration"===e?s.duration-t.duration:"date"===e?t.start-s.start:"weirdness"===e?s.weirdness-t.weirdness:s.size-t.size))}},methods:{onChangeSessionLabel(e,t){const s=t.target.value.trim();e.label=s,this.selectedSession=!1,this.emit("label",e.session,s)},onEdit(e){this.selectedSession=e.session,setTimeout((()=>{const e=this.$refs.sessionInput[0];e&&(e.focus(),e.select())}),100)},onPlay(e,t){this.emit("play",e,t)},onMouseOver(e){this.emit("hover",e)},onMouseOut(){this.emit("hover",null)},onChange(){this.emit("select",this.selected)},getSelected(){return this.selected},toggleSession(e){this.$set(this.selected,e.session,!this.selected[e.session]),this.$forceUpdate(),this.onChange()},setSessions(e){this.sessions=e,this.sessions.forEach((e=>{this.selected[e.session]=!0})),this.onChange()},setOrder(e){this.order=e},setAllSelected(e){this.sessions.forEach((t=>{this.selected[t.session]=e})),this.$forceUpdate()}},mounted(){this.logger=new v.Z("SessionList"),this.logger.log(2,"constructor","entry")}}),pe=me,ve=(0,H.Z)(pe,ge,ue,!1,null,null,null),Me=ve.exports,Ce={name:"AnalyticToolbarRender",mixins:[],data:function(){return{hasSelectAll:!1,hasSessionDetails:!0}},components:{},methods:{renderToolbar(){this.logger.log(3,"renderToolbar","enter"),this.isRendered||(this.isRendered=!0,this.logger.log(3,"renderToolbar","exit"))},render(){this.logger.log(3,"render","entry"),this.properties=document.createElement("div"),n.Z.add(this.properties,"MatcToobarPropertiesSectionCntr"),this.sections=[],this.propertiesStates={},this.renderScreenProperties(),this.renderScreenModes(),this.renderWidgetProperties(),this.renderSessionProperties(),this.renderSessionSection(),this.renderDropOffProperties(),this.renderHeatMapProperties(),this.renderGestureProperties(),this.propertiesCntr.appendChild(this.properties),this.scroller=this.$new(re.Z),this.scroller.placeAt(this.propertiesCntr),this.scroller.wrap(this.properties,40),this.hideAllSections(),this.showHeatMapProperties(),this.showClickHeatMap(),this.logger.log(3,"render","exit")},renderScreenProperties(){this.logger.log(3,"renderScreenProperties","entry");var e=new k.Z;this.screenNameDiv=this.createSection("Screen",this.properties);var t=this.createContent(this.screenNameDiv);this.screenName=this.createInput(t,"Screen Name"),this.screenName.readOnly=!0;var s=e.div("MatcCenter").build(t),i=e.div("MatcMarginBottom").build(s);this.screenTestRing=this.createRing("Test Coverage","analytics.canvas.kpi.coverage"),this.screenTestRing.placeAt(i),i=e.div("MatcMarginBottom").build(s),this.screenDwellRing=this.createRing("Dwell Time","analytics.canvas.kpi.dwell"),this.screenDwellRing.placeAt(i),i=e.div("MatcMarginBottom").build(s),this.screenTotalViewRing=this.createRing("Screen Views","analytics.canvas.kpi.screen-views"),this.screenTotalViewRing.placeAt(i),i=e.div("MatcMarginBottom").build(s),this.screenClickRing=this.createRing("Screen Clicks","analytics.canvas.kpi.screen-clicks"),this.screenClickRing.placeAt(i),i=e.div("MatcMarginBottom").build(s),this.screenWidgetClickRing=this.createRing("Widget Clicks","analytics.canvas.kpi.screen-widget-clicks"),this.screenWidgetClickRing.placeAt(i)},renderWidgetProperties(){this.logger.log(3,"renderWidgetProperties","entry");var e=new k.Z;this.widgetNameDiv=this.createSection("Widget ",this.properties);var t=this.createContent(this.widgetNameDiv);this.widgetName=this.createInput(t,"Screen"),this.widgetName.readOnly=!0;var s=e.div("MatcCenter").build(t);let i=e.div("MatcMarginBottom").build(s);this.widgetClickRing=this.createRing("Widget Clicks","analytics.canvas.kpi.clicks"),this.widgetClickRing.placeAt(i),i=e.div("MatcMarginBottom").build(s),this.widgetFirstClickRing=this.createRing("First Clicks","analytics.canvas.kpi.first-clicks"),this.widgetFirstClickRing.placeAt(i),i=e.div("MatcMarginBottom").build(s);var o=this.createBigNumber(e,i,"Time before Click","analytics.canvas.kpi.before-click");this.widgetDiscoverLabel=o[0],this.widgetDiscoverSTDLabel=o[1]},renderHeatMapProperties(){this.logger.log(1,"renderHeatMapProperties","entry");var e=new k.Z;this.heatmapDiv=this.createSection("Show",this.properties);let t=this.createContent(this.heatmapDiv);var s=e.div("MatcToobarRow MatcMarginBottom").build(t),i=this.$new(D.Z);n.Z.add(i.domNode,"MatcToolbarRadioList"),i.setOptions([{value:-1,label:"All Clicks"},{value:1,label:"First Click"},{value:3,label:"First three Clicks"},{value:"missedClicks",label:"Missed Clicks"},{value:"mouse",label:"Mouse"}]),i.placeAt(e.div().build(s)),this.own(i.on("change",u.Z.hitch(this,"showFirstClickHeatMap"))),this.heatmapLabel=e.div("MatcToobarRow").label("MatcToolbarLabel MatcToolbarHelpSection").build(t),this.heatmapClickList=i,this.setHeatMapLabel(-1)},setHeatMapLabel(e){let t="";-1===e&&(t=this.getNLS("analytics.canvas.heatamp.hintAll")),1===e&&(t=this.getNLS("analytics.canvas.heatamp.hintFirst")),3===e&&(t=this.getNLS("analytics.canvas.heatamp.hintFirstThree")),"missedClicks"===e&&(t=this.getNLS("analytics.canvas.heatamp.hintMissed")),"mouse"===e&&(t=this.getNLS("analytics.canvas.heatamp.hintMouse")),this.heatmapLabel.textContent=t},renderDropOffProperties(){this.logger.log(2,"renderSessionProperties","entry");var e=new k.Z;this.dropOffConfigDiv=this.createSection("Show",this.properties);var t=this.createContent(this.dropOffConfigDiv),s=e.div("MatcToobarRow MatcToolbarRadioList").build(t);this.dropOffTimeCheckBox=this.$new(D.Z,{maxLabelLength:20}),this.dropOffTimeCheckBox.setOptions([{value:!1,label:"Drop Off"},{value:!0,label:"Time"}]),this.dropOffTimeCheckBox.setValue(!1),this.dropOffTimeCheckBox.placeAt(s),this.own((0,m.Z)(this.dropOffTimeCheckBox,"change",u.Z.hitch(this,"selectDropOffTask"))),this.dropOffOptionsDiv=this.createSection("Tasks",this.properties),t=this.createContent(this.dropOffOptionsDiv),s=e.div("MatcToobarRow ").build(t),this.dropOffTaskBtn=this.$new(D.Z,{maxLabelLength:20});let i=[];this.testSettings.tasks&&this.testSettings.tasks.length>=1?i=this.testSettings.tasks.map(((e,t)=>({value:t,label:e.name}))):this.dropOffOptionsLabel=e.span("MatcToolbarLabel MatcToolbarHelpSection",this.getNLS("analytics.canvas.dropoff.hintNoTasksDefined")).build(s),this.dropOffTaskBtn.setOptions(i),this.dropOffTaskBtn.setValue(0),n.Z.add(this.dropOffTaskBtn.domNode,"MatcToolbarRadioList"),this.dropOffTaskBtn.placeAt(s),this.own((0,m.Z)(this.dropOffTaskBtn,"change",u.Z.hitch(this,"selectDropOffTask"))),this.dropOffChartDivCntr=this.createSection("Insights",this.properties),t=this.createContent(this.dropOffChartDivCntr);var o=e.div("MatcCenter ").build(t);this.dropoffTaskSuccess=this.createRing("Success","analytics.canvas.kpi.first-clicks"),n.Z.add(this.dropoffTaskSuccess.domNode,"MatcMarginBottom"),this.dropoffTaskSuccess.placeAt(o);let a=e.div("MatcMarginBottom").build(o);var r=this.createBigNumber(e,a,"Duration","analytics.canvas.kpi.before-click");this.dropOffTaskDuration=r[0],this.dropOffTaskDurationLabel=r[1],a=e.div("MatcMarginBottom").build(o),r=this.createBigNumber(e,a,"Interactions","analytics.canvas.kpi.before-click"),this.dropOffInteractions=r[0],this.dropOffInteractionsLabel=r[1],this.dropOffFunnelDivCntr=this.createSection("Drop Off",this.properties),t=this.createContent(this.dropOffFunnelDivCntr),this.dropOffChartDiv=e.div("MatcToolbarDropOffChart","").build(t)},renderSessionProperties(){this.logger.log(1,"renderSessionProperties","entry");const e=new k.Z;this.sessionOptionsDiv=this.createSection("Show",this.properties);let t=this.createContent(this.sessionOptionsDiv),s=e.div("MatcToobarRow MatcToolbarRadioList").build(t);this.sessionTreeCheckBox=this.$new(D.Z),this.sessionTreeCheckBox.setOptions([{value:!0,label:"Merged Graph"},{value:!1,label:"Individual Tests"}]),this.sessionTreeCheckBox.setValue(!0),this.sessionTreeCheckBox.placeAt(s),this.own((0,m.Z)(this.sessionTreeCheckBox,"change",u.Z.hitch(this,"showUserJourney"))),s=e.div("MatcToobarRow").build(t),this.sessionOutlierCheckbox=this.$new(le.Z),n.Z.add(this.sessionOutlierCheckbox.domNode,"MatcToolbarItem"),this.sessionOutlierCheckbox.setValue(!1),this.sessionOutlierCheckbox.setLabel("Show Outlier"),this.sessionOutlierCheckbox.placeAt(s),this.own((0,m.Z)(this.sessionOutlierCheckbox,"change",u.Z.hitch(this,"showUserJourneyOutlier"))),this.sessionOutlierDiv=this.createSection("Colors",this.properties),t=this.createContent(this.sessionOutlierDiv),s=e.div("MatcToobarRow ").build(t),this.sessionLineColor=this.$new(ce.Z,{updateColor:!0,hasCustomColor:!1,hasPicker:!1}),this.sessionLineColor.placeAt(s),this.sessionLineColor.setLabel("Graph"),this.sessionLineColor.setModel(this.model),this.sessionLineColor.setValue("#33b5e5"),n.Z.add(this.sessionLineColor.domNode," hidden"),this.own((0,m.Z)(this.sessionLineColor,"change",u.Z.hitch(this,"showUserJourney"))),this.sessionTaskLineColor=this.$new(ce.Z,{updateColor:!0,hasCustomColor:!1,hasPicker:!1}),this.sessionTaskLineColor.placeAt(s),this.sessionTaskLineColor.setLabel("Task"),this.sessionTaskLineColor.setModel(this.model),this.sessionTaskLineColor.setValue("#92c500"),n.Z.add(this.sessionTaskLineColor.domNode,""),this.own((0,m.Z)(this.sessionTaskLineColor,"change",u.Z.hitch(this,"showUserJourney"))),this.sessionOutlierColor=this.$new(ce.Z,{updateColor:!0,hasCustomColor:!1,hasPicker:!1}),this.sessionOutlierColor.placeAt(s),this.sessionOutlierColor.setLabel("Outlier"),this.sessionOutlierColor.setModel(this.model),this.sessionOutlierColor.setValue("#ffb61c"),n.Z.add(this.sessionOutlierColor.domNode,""),this.own((0,m.Z)(this.sessionOutlierColor,"change",u.Z.hitch(this,"showUserJourney"))),this.sessionShowDiv=this.createSection("Options",this.properties),t=this.createContent(this.sessionShowDiv),s=e.div("MatcToobarRow MatcToolbarRadioList").build(t),this.sessionTimeCheckBox=this.$new(D.Z,{maxLabelLength:20}),this.sessionTimeCheckBox.setOptions([{value:!1,label:"Navigation"},{value:!0,label:"Time"}]),this.sessionTimeCheckBox.setValue(!1),this.sessionTimeCheckBox.placeAt(s),this.own((0,m.Z)(this.sessionTimeCheckBox,"change",u.Z.hitch(this,"showUserJourney"))),this.sessionTaskCntr=this.createSection("Tasks",this.properties),t=this.createContent(this.sessionTaskCntr),s=e.div("MatcToobarRow ").build(t);var i=[{value:-1,label:"No Task"}];if(this.testSettings.tasks)for(let o=0;o<this.testSettings.tasks.length;o++){let e=this.testSettings.tasks[o];i.push({value:o,label:e.name})}this.sessionTaskBtn=this.$new(D.Z,{maxLabelLength:20}),this.sessionTaskBtn.setOptions(i),this.sessionTaskBtn.setValue(-1),n.Z.add(this.sessionTaskBtn.domNode,"MatcToolbarRadioList"),this.sessionTaskBtn.placeAt(s),this.own((0,m.Z)(this.sessionTaskBtn,"change",u.Z.hitch(this,"selectUserJournyTask")))},renderSessionSection(){this.sessionDiv=this.db.div("MatcToolbarSection").build(this.testListCntr);let e=this.createContent(this.sessionDiv);n.Z.add(e,"MatcMarginBottomXXL");let t=this.db.div("MatcToobarRow").build(e);this.sessionOrderBrn=this.$new(he.Z,{maxLabelLength:20}),this.sessionOrderBrn.setOptions([{value:"date",label:"Sort by Date",icon:"Calendar"},{value:"duration",label:"Sort by Duration",icon:"Duration"},{value:"events",label:"Sort by Events",icon:"Hash"},{value:"weirdness",label:"Sort by Outlier",icon:"Outlier"},{value:"",css:"MatcToolbarPopUpLine",label:""},{value:"",label:"Select all",callback:()=>this.selectAllSessions(!0),icon:"CheckBoxOn"},{value:"",label:"Unselect all",callback:()=>this.selectAllSessions(!1),icon:"CheckBoxOff"}]),this.sessionOrderBrn.setPopupCss("MatcActionAnimProperties MatcPopupArrowLeft"),this.sessionOrderBrn.updateLabel=!1,this.sessionOrderBrn.hasFixedLabel=!0,this.sessionOrderBrn.reposition=!0,this.sessionOrderBrn.repositionPosition="right",this.sessionOrderBrn.setValue("date"),this.sessionOrderBrn.setLabel("Test Sessions"),this.sessionOrderBrn.placeAt(t),this.tempOwn((0,m.Z)(this.sessionOrderBrn,"change",(e=>{this.sessionListWidget.setOrder(e)}))),this.sessionList=this._getTestList(this.events,this.annotation,this.testSettings),this.sessionListWidget=this.$new(Me),this.sessionListWidget.placeAt(e),this.sessionListWidget.setSessions(this.sessionList),this.sessionListWidget.on("select",(()=>{this.onSessionSelectionChanged()})),this.sessionListWidget.on("hover",(e=>{this.hoverSession(e)})),this.sessionListWidget.on("play",((e,t)=>{this.showSession(e,t)})),this.sessionListWidget.on("label",((e,t)=>{this.onChangeSessionLabel(e,t)}))},hoverSession(e){"UserJourney"===this.analyticMode&&this.canvas&&this.canvas.highlightSession(e?.session)},showUserJourneyOutlier(e){if(e){let e=this.canvas.getOutlierScores();for(let t in this.sessionCheckBoxes){let s=this.sessionCheckBoxes[t];e[t]?n.Z.remove(s.domNode,"MatcToolbarItemStrikeThrough"):n.Z.add(s.domNode,"MatcToolbarItemStrikeThrough")}}else for(let t in this.sessionCheckBoxes){let e=this.sessionCheckBoxes[t];n.Z.remove(e.domNode,"MatcToolbarItemPassive"),n.Z.remove(e.domNode,"MatcToolbarItemStrikeThrough")}this.showUserJourney()},selectUserJournyTask(e){if(e>=0){let t=this.testSettings.tasks[e],s=this.canvas.getTaskPerformance();for(let e in this.sessionCheckBoxes){let i=this.sessionCheckBoxes[e];s[e]&&s[e][t.id]?n.Z.remove(i.domNode,"MatcToolbarItemStrikeThrough"):n.Z.add(i.domNode,"MatcToolbarItemStrikeThrough")}}else for(let t in this.sessionCheckBoxes){let e=this.sessionCheckBoxes[t];n.Z.remove(e.domNode,"MatcToolbarItemPassive"),n.Z.remove(e.domNode,"MatcToolbarItemStrikeThrough")}this.showUserJourney()},setSelectSessions(e){if(this.sessionCheckBoxes){for(var t in this.sessionCheckBoxes)e.indexOf(t)>=0?this.sessionCheckBoxes[t].setValue(!0):this.sessionCheckBoxes[t].setValue(!1);this.sessionAllCheckBox&&this.sessionAllCheckBox.setValue(!1),this.onSessionSelectionChanged()}},selectAllSessions(e){this.sessionListWidget.setAllSelected(e),this.onSessionSelectionChanged()},selectSession(){this.onSessionSelectionChanged()},onSessionSelectionChanged(){this.logger.log(-1,"onSessionSelectionChanged","enter"),this.reRenderAnalyticMode()},getSelectedSessions(){return this.sessionListWidget.getSelected()},onChangeSessionLabel(e,t){const s=this.events.find((t=>"SessionStart"===t.type&&t.session===e));s&&s.label!==t&&(s.label=t,this.modelService.updateEvent(this.model.id,s))},_getTestList(e,t,s){const i=[];s.tasks||(s.tasks=[],console.warn("_getTestList() > Added missing task array"));const o=new W.Z(e);o.sortBy("time");const a=o.groupBy("session"),n=a.data,r=new W.Z(t).groupBy("reference"),l=new F.Z,h=s.tasks.length,c=l.getMergedTaskPerformance(o,s.tasks,t),d=c.count("session"),g=this.canvas.getOutlierScores();let u=1;for(let m in n){let e=`Test ${u}`,t=n[m],s=this.formatDate(t.min("time"),!0),o=r.get(m),a='<span class="MatchDashStatusSuccess">Valid</span>',l=!0;o&&(l=o.get(0).get("isValid"),l||(a='<span class="MatchDashStatusFailure">Failure</span>'));let c=d.get(m);c||(c=0);const p=t.data.find((e=>"SessionStart"===e.type));p&&p.label&&(e=p.label);const v=new W.Z(t.data),M=v.select("type","in",["ScreenClick","WidgetClick","WidgetChange","ScreenGesture","WidgetGesture"]),C={session:m,taskPerformance:c+" / "+h,weirdness:g[m],duration:Math.ceil((t.max("time")-t.min("time"))/1e3),date:s,start:t.min("time"),size:M.size(),status:a,isValid:l,id:u,label:e,screens:t.unique("screen")};i.push(C),u++}return i.sort(((e,t)=>e.id-t.id)),i},renderGestureProperties(){const e=new k.Z;this.gestureOptionsDiv=this.createSection("Options",this.properties);const t=this.createContent(this.gestureOptionsDiv),s=e.div("MatcToobarRow MatcMarginBottomXXL").build(t);e.span("MatcToolbarItemLabel","Gesture Color").build(s),this.gestureLineColor=this.$new(ce.Z,{updateColor:!0,hasCustomColor:!1,hasPicker:!1}),this.gestureLineColor.placeAt(s),this.gestureLineColor.setLabel("Line Color"),this.gestureLineColor.setModel(this.model),this.gestureLineColor.setValue("#0099cc"),this.own((0,m.Z)(this.gestureLineColor,"change",u.Z.hitch(this,"showGestureMap")))},renderScreenModes(){this.logger.log(3,"renderScreenModes","entry"),this.screenModeDiv=this.createSection("Show",this.properties);const e=this.createContent(this.screenModeDiv),t=this.db.div("MatcToobarRow MatcMarginBottom").build(e),s=this.$new(D.Z);n.Z.add(s.domNode,"MatcToolbarRadioList"),s.setOptions([{label:"Dwell Time",value:"HeatmapDwelTime",icon:"mdi mdi-timelapse"},{label:"Scroll",value:"HeatmapScrollView",icon:"mdi mdi-swap-vertical"},{label:"Scroll Time",value:"HeatmapScrollTime",icon:"mdi mdi-timer"}]),s.setValue("HeatmapDwelTime"),this.screenModeRadioList=s,s.placeAt(t),this.own(s.on("change",u.Z.hitch(this,"showScreenMode")))},showProperties(){n.Z.remove(this.propertiesCntr,"MatcToolbarSectionHidden"),this.canvas&&n.Z.add(this.canvas.scrollRight,"MatcCanvasScrollBarRightOpen")},hideProperties(){return"UserJourney"==this.analyticMode?(this.hideAllSections(),void this.showSessionProperties()):"HeatmapClick"==this.analyticMode?(this.hideAllSections(),void this.showHeatMapProperties()):void this.hideAllSections()},hideAllSections(){this.logger.log(3,"hideAllSections","entry");for(var e=0;e<this.sections.length;e++){var t=this.sections[e];n.Z.add(t,"MatcToolbarSectionHidden")}},setController(e){this.logger.log(3,"setController","entry"),this.controller=e},setCanvas(e){this.logger.log(3,"setCanvas","entry"),this.canvas=e},setModelFactory(e){this.logger.log(3,"setModelFactory","entry"),this.factory=e},setModel(e){this.model=this.createInheritedModel(e),this.modelName=e.name,this.renderToolbar(),this.render()},setAnnotation(e){this.logger.log(-1,"setAnnotation","enter > # "),this.annotation=e},setTest(e){this.logger.log(2,"setTest","enter > # "),this.testSettings=e},setEvents(e){this.logger.log(2,"setEvents","enter > # "+e.length),this.events=e},setMode(e){this.logger.log(2,"setMode","entry > '"+e+"'"),this.mode=e,this.onModeChange()},onModeChange(){},setSelectedViewButton(){},createRing(e,t,s){var i="#cecece",o=this.canvas.getSettings();"MatcDark"==o.canvasTheme&&(i="#777");var a=this.$new(x.Z,{size:100,width:5,backgroundColor:i,color:"#365fff",color2:"#83b600",color3:"#ffa713"});return a.setDomSize(120,120),a.setLabel(e),s&&(a.setAction("mdi mdi-chart-bar"),this.tempOwn(a.on("action",u.Z.hitch(this,s)))),t&&(a.setHelp(!0),this.tempOwn(a.on("help",u.Z.hitch(this,"showHelpDialog",t)))),n.Z.add(a.domNode,"MatcMarginTop"),a},createToolBarItem(e,t,s,i){var o=document.createElement("div");if(n.Z.add(o,"MatcToolbarItem MatcToolbarPrimaryItem"),s){var a=document.createElement("span");n.Z.add(a,s),o.appendChild(a)}return t&&this.tempOwn((0,m.Z)(o,w.Z.press,u.Z.hitch(this,t))),i?i.appendChild(o):this.properties.appendChild(o),o},createInput(e,t){var s=document.createElement("div");n.Z.add(s,"MatcToolbarItem"),e.appendChild(s);let i=document.createElement("input");return i.disabled=!0,n.Z.add(i,"MatcIgnoreOnKeyPress MatcToobarInput  MatcToobarInlineEditDisabled"),s.appendChild(i),t&&(i.placeholder=t),i},createContent(e){var t=document.createElement("div");return n.Z.add(t,"MatcToolbarSectionContent"),e.appendChild(t),t},createSection(e,t,s=!0){const i=document.createElement("div");n.Z.add(i,"MatcToolbarSection");const o=this.createSectionHeader(i,e);return this.own((0,m.Z)(o,w.Z.press,(()=>(n.Z.toggle(i,"MatcToolbarSectionCollabsed"),!1)))),s&&this.sections.push(i),t.appendChild(i),i},createSectionHeader(e,t,s){var i=document.createElement("div");if(n.Z.add(i,"MatcToolbarSectionLabel"),e.appendChild(i),i.innerHTML=t,s){var o=document.createElement("span");n.Z.add(o,"MatcToolbarSectionMarker"),o.innerHTML=" *",i.appendChild(o)}var a=document.createElement("span");return n.Z.add(a,"MatcToolbarSectionChevron mdi mdi-chevron-down"),i.appendChild(a),i},createBigNumber(e,t,s,i){var o=e.div("MatcToolBarNumberCntr MatcMarginTop").build(t);let a=e.div("MatcDashLabel",s).build(o);var n=e.div("MatcToolbarBigLabel").build(o),r=e.div("MatcToolbarDetailLabel").build(o);if(i){var l=e.span("mdi mdi-help-circle MatcHelpIcon").build(a);this.tempOwn((0,m.Z)(l,w.Z.press,u.Z.hitch(this,"showHelpDialog",i)))}return[n,r]},onExit(){this.logger.log(0,"onExit","entry",this.isPublic),this.isPublic?(0,b.Z)("#/examples/"+this.model.id+"/design.html"):(0,b.Z)("#/apps/"+this.model.id+"/design.html")},onShare(){this.logger.log(0,"onShare","entry")},onWidgetSelected(e){this.logger.log(2,"onWidgetSelected","entry"),this._selectedWidget&&this._selectedWidget.id!=e.id&&(this.logger.log(3,"onWidgetSelected","exit > no new selection!"),this.blurWidgetProperties()),this.cleanUp(),this._selection="widget",this._selectedWidget=e,this.showWidgetProperties(e),this.logger.log(3,"onWidgetSelected","exit")},onScreenSelected(e){this.logger.log(-1,"onScreenSelected","entry",this._selectedScreen),this._selectedScreen&&this._selectedScreen.id==e.id?this.logger.log(3,"onScreenSelected","exit > no new selection!"):(this.cleanUp(),this._selection="screen",this._selectedScreen=e,this.showScreenProperties(e),this.logger.log(4,"onScreenSelected","exit"))},onLineSelected(e){this.cleanUp(),this._selection="line",this._selectedLine=e},onMultiSelect(e){this.cleanUp(),this._selection="multi",this._selectedMulti=e},onGroupSelect(e){this.cleanUp(),this._selection="group",this._selectedGroup=e,this.showGroupProperties(e)},onCanvasSelected(){this.cleanUp(),this.hideProperties()},updatePropertiesView(){this._selectedWidget&&this.onWidgetSelected(this._selectedWidget)},showSession(e,t){const s=e.session,i=new T.Z,o=new k.Z,a=o.div("MatcDialog MatcPlayerDialog ").build(),n=o.div("").build(a);i.onOpen((()=>{this.isPublic?Promise.all([this.modelService.findPublicTagAnnotations(this.model.id),this.modelService.findPublicMouseBySession(this.model.id,s)]).then((e=>{this._showSession(s,n,i,e)})):Promise.all([this.modelService.findTagAnnotations(this.model.id),this.modelService.findMouseBySession(this.model.id,s)]).then((e=>{this._showSession(s,n,i,e)}))})),i.popup(a,t.target)},_showSession(e,t,s,i){try{const o=i[1],a=new W.Z(this.events);a.sortBy("time");const n=a.groupBy("session"),r=n.get(e),l=this.$new(de.Z);l.setDialog(s),l.placeAt(t),l.setModel(this.model),l.setTestSettings(this.testSettings),l.setMouse(o),l.setMouse(o),l.setSession(r,e),s.own((0,m.Z)(s,"close",(function(){l.destroy()})))}catch(o){console.error(o)}},_getSessionAnnotation(e,t){if(e.length>1)for(let i=1;i<e.length;i++){var s=e[i];this._doDelete("rest/annotations/apps/"+t+"/"+s.id+".json")}return e.length>=1?e[0]:{appID:t,type:"tags",reference:"",sessions:{}}},onShowSettings(e){var t=new k.Z;t=new k.Z;var s=t.div("MatcDialog MatcHeaderDialog MatcPadding").build(),i=t.div("").build(s),o=this.canvas.getSettings();t.label("","Theme :").build(i);var a=this.$new(D.Z);a.setOptions([{value:"MatcDark",label:"Dark"},{value:"MatcLight",label:"Light"}]),a.setValue(o.canvasTheme),a.placeAt(i),t.label("MatcMarginTop","Mouse Wheel / Touchpad Scroll :").build(i);var n=this.$new(D.Z);n.setOptions([{value:"scroll",label:"Scroll Canvas"},{value:"zoom",label:"Zoom Canvas"}]),n.setValue(o.mouseWheelMode),n.placeAt(i);var r=t.div("MatcButtonBar MatcMarginTopXL").build(s),l=t.a("MatcButton MatcButtonPrimary","Save").build(r),h=t.a(" MatcLinkButton ","Cancel").build(r),c=new T.Z;c.own((0,m.Z)(h,w.Z.press,u.Z.hitch(c,"close"))),c.own((0,m.Z)(l,w.Z.press,u.Z.hitch(this,"onSaveSettings",c,a,n))),c.popup(s,e.target),this.canvas.enableMouseZoom(!1),this.canvas.setState("simulate"),this.logger.log(0,"onShowSettings","exit > ")},onSaveSettings(e,t,s){var i={canvasTheme:t.getValue(),mouseWheelMode:s.getValue()};this.canvas.setSettings(i),this.canvas.enableMouseZoom(!0),e.close()},showSignUpDialog(e){var t=new T.Z,s=new k.Z,i=s.div("MatcDialog ").build();this._createSignUpForm(t,i),t.popup(i,e.target)},_createSignUpForm(e,t){let s=this.$new(L.Z);return s.render([{label:"Email",name:"email",type:"text",required:"true",placeholder:"Your email",css:"input-lg MatcIgnoreOnKeyPress",error:"We need your email."},{label:"Password",name:"password",type:"password",min:6,placeholder:"Your password",css:"input-lg MatcIgnoreOnKeyPress",error:"The password should have at least six characters."},{label:'I have read the <a href="#/termsofservice.html" target="_blank">terms of service</a>',name:"tos",type:"check",required:"true",css:"MatcFormCheckBox MatcIgnoreOnKeyPress",error:"You must accept the terms of service!"}],[{label:"Cancel",css:"MatcLinkButton",click:u.Z.hitch(e,"close")},{label:"Create Free Account",css:"MatcButton MatchButtonGreen",click:u.Z.hitch(this,"_signUpAndNew",e,s)}]),s.placeAt(t),s.startup(),s},_signUpAndNew(e,t,s){var i=t.validateForm(null,!0);if(i)if(o=this._doPost("rest/user",s),"error"==o.type)o.errors.indexOf("user.email.not.unique")>=0?t.showError("The email is already taken! Please enter another one!","email"):t.showError("Something went wrong! Please try again!",""),e.shake();else{e.close();var o=this._doPost("rest/login/",s);"error"!=o.type?window.location.href="/my-account.html":console.error("_signUpAndSave() > Could not sign in user")}else e.shake()}},mounted(){this.db=new k.Z}},Se=Ce,ye=(0,H.Z)(Se,ae,ne,!1,null,null,null),we=ye.exports,be=s(48459),fe=s(62799),Ze={name:"AnalyticToolbar",mixins:[f.Z,Z.Z,_.Z,a.Z,we],data:function(){return{mode:"",modelName:"Loading...",events:null,model:null,user:null,value:!1,analyticMode:"HeatmapClick",analyticHeatMapClicks:-1,canvasViewConfig:{},layerListWidth:256}},components:{ViewConfig:R.Z,HomeMenu:J,QIcon:q.Z,AnalyticViewModeButton:oe,HeatmapToggleButton:fe.Z},methods:{postCreate(){this.logger=new v.Z("AnalyticToolbar"),this.logger.log(2,"constructor","entry"),this.renderToolbar(),this.initLayer()},setCommentService(e){this.logger.log(3,"setCommentService","entry"),this.commentService=e},onMove(e){this.stopEvent(e),this.canvas.setMode("move")},onEdit(e){this.stopEvent(e),this.canvas.setMode("edit")},showHelpDialog(e){this.$refs.helpBtn&&this.$refs.helpBtn.show("analytics.canvas",e)},onHomeMenu(e,t){this.logger.log(1,"onHomeMenu","entry",t),this[e.value]&&this[e.value](t)},onChangeViewMode(e){this.logger.log(-1,"onChangeViewMode","entry",e),this[e]&&this[e]()},showHelp(e){let t=new T.Z;var s=new k.Z;let i=s.div("MatcDialog MatcHelpDialog MatcPadding").build();t.popup(i,e.target);let o=this.$new(K.Z);o.placeAt(i)},onNewComment(e){this.logger.log(2,"onNewComment","entry"),this.stopEvent(e),this.emit("newComment",{type:"comment",event:e})},setAnalyticMode(e,t,s){this.logger.log(2,"setAnalyticMode","entry > mode: "+e),this.analyticMode=e,this.analyticModeCallback=s,s||console.warn("setAnalyticMode() called with callback",this.mode),this.canvas&&this.canvas.setAnalyticMode(e,t),this.hideProperties()},onCanvasSelected(){this.logger.log(-2,"onCanvasSelected","entry > mode: "+this.analyticMode),"HeatmapClick"===this.analyticMode&&(this.hideAllSections(),this.showHeatMapProperties())},reRenderAnalyticMode(){this.logger.log(-2,"reRenderAnalyticMode","entry",this.analyticMode),this.analyticModeCallback?this.analyticModeCallback():this.logger.error("reRenderAnalyticMode","No callback")},setModelService(e){this.modelService=e,setTimeout(u.Z.hitch(this,"initMouseData"),500)},setPublic(e){this.isPublic=e},setCanvasViewConfig(e){this.canvasViewConfig=e},onChangeCanvasViewConfig(e,t){this.canvas&&this.canvas.setCanvasViewConfig(e,t)},setUser(e){this.user=e},async initMouseData(){if(this.logger.log(2,"initMouseData","entry"),this.isPublic){let e=await this.modelService.findPublicMouse(this.model.id);this.setMouseData(e)}else{let e=await this.modelService.findMouse(this.model.id);this.setMouseData(e)}},setMouseData(e){this.logger.log(2,"setMouseData","entry >"+e.length),this.mouseData=e},async showSharing(e){this.logger.log(-1,"showSharing","entry > ",this.isPublic);const t=await this.modelService.findInvitation(this.model.id),s={};for(let d in t)s[t[d]]=d;const i=new k.Z,o=i.div("MatcDialog MatcInfitationDialog MatcInfitationDialogLarge MatcPadding").build(),a=i.div("container").build(o);let n=i.div("row").build(a),r=i.div("col-md-12").build(n);i.h3("",this.getNLS("share.Headline")).build(r);const l=this.$new(N.Z);l.placeAt(r),l.setInvitation(s[1]),l.setPublic(this.isPublic),n=i.div("row MatcMarginTop").build(a),r=i.div("col-md-12 MatcButtonBar").build(n);const h=i.div("MatcButton MatcButtonPrimary","Close").build(r),c=new T.Z;c.own((0,m.Z)(h,w.Z.press,u.Z.hitch(c,"close"))),c.popup(o,e.target)},onResizeStart(e){const t=this.layerListWidth;(0,be.z)(e,(e=>{let s=t+e.x;this.layerListWidth=Math.min(Math.max(196,s),400),localStorage.setItem("quxLayerListWidth",this.layerListWidth),this.setLayerListWidth(this.layerListWidth)}))},initLayer(){this.logger.log(-2,"initLayer","entry");const e=localStorage.getItem("quxLayerListWidth");e&&!isNaN(1*e)&&this.setLayerListWidth(1*e)},setLayerListWidth(e){this.layerListWidth=e,this.canvas&&this.canvas.setLayerListWidth(e)},showClickHeatMap(){this.logger.log(-2,"showClickHeatMap","entry > "+this.analyticHeatMapClicks),this.setAnalyticMode("HeatmapClick",{numberOfClicks:this.analyticHeatMapClicks,sessions:this.getSelectedSessions()},(()=>this.showClickHeatMap())),this.showHeatMapProperties()},showFirstClickHeatMap(e){this.logger.log(-1,"showFirstClickHeatMap","entry > "+e),this.analyticHeatMapClicks=e,this.setHeatMapLabel(e),"mouse"===e?this.showMouseHeatMap():this.setAnalyticMode("HeatmapClick",{numberOfClicks:this.analyticHeatMapClicks,sessions:this.getSelectedSessions()},(()=>this.showFirstClickHeatMap(e)))},showMouseHeatMap(){this.logger.log(-2,"showMouseHeatMap","entry"),this.mouseData?(this.canvas.setMouseData(this.mouseData),this.setAnalyticMode("HeatmapMouse",{sessions:this.getSelectedSessions()},(()=>this.showMouseHeatMap()))):(this.canvas.showHint("Loading data..."),this.isPublic?this._doGet("/examples/mouse/"+this.model.id+".json",u.Z.hitch(this,"_onMouseDataLoaded")):this._doGet("rest/mouse/"+this.model.id+".json",u.Z.hitch(this,"_onMouseDataLoaded"))),this.showHeatMapProperties()},_onMouseDataLoaded(e){this.logger.log(2,"_onMouseDataLoaded","entry >"+e.length),this.mouseData=e,this.canvas.setMouseData(this.mouseData),this.setAnalyticMode("HeatmapMouse",{sessions:this.getSelectedSessions()},(()=>this.showMouseHeatMap()))},showViewMap(){this.logger.log(2,"showViewMap","entry"),this.setAnalyticMode("HeatmapViews",{sessions:this.getSelectedSessions()},(()=>this.showViewMap()))},showDropOff(){this.logger.log(-1,"showDropOff","entry"),this.showDropOffProperties()},showUserJourney(){this.logger.log(-1,"showUserJourney","entry > ");const e={sessions:this.getSelectedSessions(),time:this.sessionTimeCheckBox.getValue(),color:this.sessionLineColor.getValue(),tree:this.sessionTreeCheckBox.getValue(),task:this.sessionTaskBtn.getValue(),taskColor:this.sessionTaskLineColor.getValue(),outlier:this.sessionOutlierCheckbox.getValue(),outlierColor:this.sessionOutlierColor.getValue()};this.setAnalyticMode("UserJourney",e,(()=>this.showUserJourney())),this.showSessionProperties()},showGestureMap(){this.logger.log(2,"showGestureMap","entry > "),this.setAnalyticMode("Gesture",{color:this.gestureLineColor.getValue(),sessions:this.getSelectedSessions()},(()=>this.showGestureMap())),this.showGestureProperties()},showScreenMode(){const e=this.screenModeRadioList.getValue();this.setAnalyticMode(e,{sessions:this.getSelectedSessions()},(()=>this.showScreenMode())),n.Z.remove(this.screenModeDiv,"MatcToolbarSectionHidden"),this.logger.log(-1,"showScreenMode","exit > ",e)},changeScreenMode(e){this.logger.log(0,"changeScreenMode","entry > ",e)},showDwellDistribution(e){if(this.logger.log(0,"showDwellDistribution","entry > "),this._selectedScreen){var t=new W.Z(this.events),s=new F.Z,i=s.getScreenTimeGrouping(t),o=i.get(this._selectedScreen.id);if(o){var a=new k.Z,n=new T.Z,r=a.div("MatcPadding DashTaskListDetailsDialog").build();a.h2("MatcDialogTitle","Dwell Time Distribution &quot"+this._selectedScreen.name+"&quot").build(r);var l=a.div("DashTaskListDialogHist").build(r),h=o.hist(null,10),c=this.$new(V);c.setFormTo((function(e){return Math.round(e/1e3)+" sec"})),c.onHover((function(e){return Math.round(e.from/1e3)+" - "+Math.round(e.to/1e3)+" sec ("+e.count+" x)"})),c.setValue(h,o.mean()),c.placeAt(l),n.popup(r,e.target)}}},showGestureProperties(){this.logger.log(1,"showGestureProperties","entry > "),this.showProperties(),n.Z.remove(this.gestureOptionsDiv,"MatcToolbarSectionHidden")},showWidgetProperties(e){this.logger.log(1,"showWidgetProperties","entry > "+e.id+" "+e.name),this.showProperties(),n.Z.remove(this.widgetNameDiv,"MatcToolbarSectionHidden"),this.widgetName.value=e.name;const t=this.canvas.getWidgetData(e);if(t[e.id]){const s=t[e.id];this.widgetClickRing.setPs(s.clicksRel),this.widgetClickRing.setValue(s.clicksAbs),isNaN(s.firstClicksRelScreen)&&(s.firstClicksRelScreen=0),this.widgetFirstClickRing.setPs(s.firstClicksRelScreen),this.widgetFirstClickRing.setValue(s.firstClicksAbs),this.setTextContent(this.widgetDiscoverSTDLabel,"+/-"+Math.round(s.discoverTimeStd/1e3)+"s"),this.setTextContent(this.widgetDiscoverLabel,Math.round(s.discoverTimeAbs/1e3)+"s")}},showScreenProperties(e){var t,s,i,o,a;this.logger.log(-1,"showScreenProperties","entry"),this.showProperties(),n.Z.remove(this.screenNameDiv,"MatcToolbarSectionHidden"),this.screenName.value=e.name,e.style.overlay?(t=this.canvas.getOverlayDwellTime(),s=this.canvas.getOverlayViews(),i=this.canvas.getOverlayClicks(),o=this.canvas.getOverlayWidgetClicks(),a=this.canvas.getOverlayTest()):(t=this.canvas.getScreenDwellTime(),s=this.canvas.getScreenViews(),i=this.canvas.getScreenClicks(),o=this.canvas.getScreenWidgetClicks(),a=this.canvas.getScreenTests());var r=t.times[e.id];r||(r=0);var l=i.clicks[e.id],h=o.clicks[e.id],c=l+h,d=r/t.sessions,g=s.counts[e.id];g||(g=0);var u=a.counts[e.id];u||(u=0),this.screenTotalViewRing.setValue(g),this.screenTotalViewRing.setPs(g/s.total),this.screenTestRing.setValue(u),this.screenTestRing.setPs(u/a.sessions),this.screenClickRing.setPs(l/c),this.screenClickRing.setValue(l),this.screenWidgetClickRing.setPs(h/c),this.screenWidgetClickRing.setValue(h),this.screenDwellRing.setPs(r/t.total),this.screenDwellRing.setValue(Math.round(d/1e3)+"s")},showSessionProperties(){this.logger.log(1,"showSessionProperties","entry"),this.showProperties(),n.Z.remove(this.sessionOptionsDiv,"MatcToolbarSectionHidden"),this.sessionTreeCheckBox.getValue()?(n.Z.add(this.sessionTaskCntr,"MatcToolbarSectionHidden"),n.Z.add(this.sessionLineColor.domNode,"hidden"),n.Z.add(this.sessionTaskBtn.domNode,"hidden"),n.Z.remove(this.sessionShowDiv,"MatcToolbarSectionHidden"),n.Z.add(this.sessionLineColor.domNode,"hidden"),n.Z.add(this.sessionOutlierDiv,"MatcToolbarSectionHidden"),n.Z.add(this.sessionOutlierCheckbox.domNode,"hidden")):(n.Z.remove(this.sessionTaskCntr,"MatcToolbarSectionHidden"),n.Z.remove(this.sessionLineColor.domNode,"hidden"),n.Z.remove(this.sessionTaskBtn.domNode,"hidden"),n.Z.add(this.sessionShowDiv,"MatcToolbarSectionHidden"),n.Z.remove(this.sessionLineColor.domNode,"hidden"),n.Z.remove(this.sessionOutlierDiv,"MatcToolbarSectionHidden"),n.Z.remove(this.sessionOutlierCheckbox.domNode,"hidden"))},selectDropOffTask(){this.showDropOffProperties()},showDropOffProperties(){this.logger.log(0,"showDropOffProperties","entry");let e=this.dropOffTaskBtn.getValue(),t=this.testSettings.tasks[e];t?(this.setAnalyticMode("DropOff",{time:this.dropOffTimeCheckBox.getValue(),task:t,color:"#ccc"},(()=>this.showDropOffProperties())),n.Z.remove(this.dropOffConfigDiv,"MatcToolbarSectionHidden"),n.Z.remove(this.dropOffOptionsDiv,"MatcToolbarSectionHidden"),n.Z.remove(this.dropOffChartDivCntr,"MatcToolbarSectionHidden"),this.showDropOffChart(t),this.showProperties()):(this.setAnalyticMode("DropOff",{time:this.dropOffTimeCheckBox.getValue(),task:null,color:"#ccc"},(()=>this.showDropOffProperties())),n.Z.remove(this.dropOffConfigDiv,"MatcToolbarSectionHidden"),n.Z.remove(this.dropOffOptionsDiv,"MatcToolbarSectionHidden"),this.showProperties())},showDropOffChart(e){var t=new W.Z(this.events),s=new F.Z;let i=s.getFunnelSummary(t,e,this.annotation),o=i[i.length-1];this.dropoffTaskSuccess.setPs(o.p),this.dropoffTaskSuccess.setValue(Math.round(100*o.p)+"%"),this.dropOffTaskDuration.innerText=Math.round(o.durationMean/100)/10+"s",this.dropOffTaskDurationLabel.innerText="+/-"+Math.round(o.durationStd/100)/10+"s",this.dropOffInteractions.innerText=Math.round(o.interactionsMean),this.dropOffInteractionsLabel.innerText="+/-"+Math.round(o.interactionsStd)},showDropOffFunnel(e){this.dropOffChartDiv.innerHTML="";let t=new k.Z,s=t.div().build();e.forEach(((e,i)=>{if(e.event){t.span("MatcDashLabel",this.getNiceEventLabel(e.event,i)).build(s);let o=t.div("MatcToolbarDropOffChartBar",Math.round(100*e.p)+"%").build(s);o.style.background=this.greenToRed(e.p),o.style.width=100*e.p+"%"}})),this.dropOffChartDiv.appendChild(s)},getNiceEventLabel(e,t){if(this.model){var s=[];if(e.widget){if("WidgetGesture"!=e.type||!e.gesture)return!e.state||"WidgetClick"!=e.type&&"WidgetChange"!=e.type?this.getEventLabel(e.type)+" -  "+this.getWidgetName(e.widget)+" @ "+this.getScreenName(e.screen):this.getEventStateLabel(e.state)+" -  "+this.getWidgetName(e.widget)+" @ "+this.getScreenName(e.screen);{let t=e.gesture;s=[this.getGestureLabel(t.type),this.getWidgetName(e.widget)]}}else if("ScreenGesture"==e.type&&e.gesture){let t=e.gesture;s=["Screen "+this.getGestureLabel(t.type),this.getScreenName(e.screen)]}else s=[this.getEventLabel(e.type),this.getScreenName(e.screen)];return s[0]+" - "+s[1]}return this.getNLS("dash.perf.dropoff.step")+t},showHeatMapProperties(){this.showProperties(),n.Z.remove(this.heatmapDiv,"MatcToolbarSectionHidden"),this.heatmapClickList.setValue(this.analyticHeatMapClicks)},showProperties(){n.Z.remove(this.propertiesCntr,"MatcToolbarSectionHidden"),this.canvas&&n.Z.add(this.canvas.scrollRight,"MatcCanvasScrollBarRightOpen")},hideProperties(){return console.debug("hideProperties() > enter"),"UserJourney"==this.analyticMode?(this.hideAllSections(),void this.showSessionProperties()):"HeatmapClick"==this.analyticMode?(this.hideAllSections(),void this.showHeatMapProperties()):void this.hideAllSections()},hideAllSections(){this.logger.log(3,"hideAllSections","entry");for(var e=0;e<this.sections.length;e++){var t=this.sections[e];n.Z.add(t,"MatcToolbarSectionHidden")}},setController(e){this.logger.log(3,"setController","entry"),this.controller=e},setCanvas(e){this.logger.log(3,"setCanvas","entry"),this.canvas=e},setModelFactory(e){this.logger.log(3,"setModelFactory","entry"),this.factory=e},setModel(e){this.model=this.createInheritedModel(e),this.modelName=e.name,this.renderToolbar(),this.render()},setAnnotation(e){this.logger.log(-1,"setAnnotation","enter > # "),this.annotation=e},setTest(e){this.logger.log(2,"setTest","enter > # "),this.testSettings=e},setEvents(e){this.logger.log(2,"setEvents","enter > # "+e.length),this.events=e},setMode(e){this.logger.log(2,"setMode","entry > '"+e+"'"),this.mode=e,this.onModeChange()},onModeChange(){},setSelectedViewButton(){},createRing(e,t,s){var i="#cecece",o=this.canvas.getSettings();"MatcDark"==o.canvasTheme&&(i="#777");var a=this.$new(x.Z,{size:100,width:5,backgroundColor:i,color:"#365fff",color2:"#83b600",color3:"#ffa713"});return a.setDomSize(120,120),a.setLabel(e),s&&(a.setAction("mdi mdi-chart-bar"),this.tempOwn(a.on("action",u.Z.hitch(this,s)))),t&&(a.setHelp(!0),this.tempOwn(a.on("help",u.Z.hitch(this,"showHelpDialog",t)))),n.Z.add(a.domNode,"MatcMarginTop"),a},createToolBarItem(e,t,s,i){var o=document.createElement("div");if(n.Z.add(o,"MatcToolbarItem MatcToolbarPrimaryItem"),s){var a=document.createElement("span");n.Z.add(a,s),o.appendChild(a)}return t&&this.tempOwn((0,m.Z)(o,w.Z.press,u.Z.hitch(this,t))),i?i.appendChild(o):this.properties.appendChild(o),o},createInput(e,t){var s=document.createElement("div");n.Z.add(s,"MatcToolbarItem"),e.appendChild(s);let i=document.createElement("input");return i.disabled=!0,n.Z.add(i,"MatcIgnoreOnKeyPress MatcToobarInput  MatcToobarInlineEditDisabled"),s.appendChild(i),t&&(i.placeholder=t),i},createContent(e){var t=document.createElement("div");return n.Z.add(t,"MatcToolbarSectionContent"),e.appendChild(t),t},createSection(e,t,s=!0){const i=document.createElement("div");n.Z.add(i,"MatcToolbarSection");const o=this.createSectionHeader(i,e);return this.own((0,m.Z)(o,w.Z.press,(()=>(n.Z.toggle(i,"MatcToolbarSectionCollabsed"),!1)))),s&&this.sections.push(i),t.appendChild(i),i},createSectionHeader(e,t,s){var i=document.createElement("div");if(n.Z.add(i,"MatcToolbarSectionLabel"),e.appendChild(i),i.innerHTML=t,s){var o=document.createElement("span");n.Z.add(o,"MatcToolbarSectionMarker"),o.innerHTML=" *",i.appendChild(o)}var a=document.createElement("span");return n.Z.add(a,"MatcToolbarSectionChevron mdi mdi-chevron-down"),i.appendChild(a),i},createBigNumber(e,t,s,i){var o=e.div("MatcToolBarNumberCntr MatcMarginTop").build(t);let a=e.div("MatcDashLabel",s).build(o);var n=e.div("MatcToolbarBigLabel").build(o),r=e.div("MatcToolbarDetailLabel").build(o);if(i){var l=e.span("mdi mdi-help-circle MatcHelpIcon").build(a);this.tempOwn((0,m.Z)(l,w.Z.press,u.Z.hitch(this,"showHelpDialog",i)))}return[n,r]},onExit(){this.logger.log(0,"onExit","entry",this.isPublic),this.isPublic?(0,b.Z)("#/examples/"+this.model.id+"/design.html"):(0,b.Z)("#/apps/"+this.model.id+"/design.html")},onShare(){this.logger.log(0,"onShare","entry")},onWidgetSelected(e){this.logger.log(2,"onWidgetSelected","entry"),this._selectedWidget&&this._selectedWidget.id!=e.id&&(this.logger.log(3,"onWidgetSelected","exit > no new selection!"),this.blurWidgetProperties()),this.cleanUp(),this._selection="widget",this._selectedWidget=e,this.showWidgetProperties(e),this.logger.log(3,"onWidgetSelected","exit")},onScreenSelected(e){this.logger.log(-1,"onScreenSelected","entry",this._selectedScreen),this._selectedScreen&&this._selectedScreen.id==e.id?this.logger.log(3,"onScreenSelected","exit > no new selection!"):(this.cleanUp(),this._selection="screen",this._selectedScreen=e,this.showScreenProperties(e),this.logger.log(4,"onScreenSelected","exit"))},onLineSelected(e){this.cleanUp(),this._selection="line",this._selectedLine=e},onMultiSelect(e){this.cleanUp(),this._selection="multi",this._selectedMulti=e},onGroupSelect(e){this.cleanUp(),this._selection="group",this._selectedGroup=e,this.showGroupProperties(e)},updatePropertiesView(){this._selectedWidget&&this.onWidgetSelected(this._selectedWidget)},onShowSettings(e){var t=new k.Z;t=new k.Z;var s=t.div("MatcDialog MatcHeaderDialog MatcPadding").build(),i=t.div("").build(s),o=this.canvas.getSettings();t.label("","Theme :").build(i);var a=this.$new(D.Z);a.setOptions([{value:"MatcLight",label:"Light"},{value:"MatcDark",label:"Dark"},{value:"MatcAuto",label:"Auto"}]),a.setValue(o.canvasTheme),a.placeAt(i),t.label("MatcMarginTop","Mouse Wheel / Touchpad Scroll :").build(i);var n=this.$new(D.Z);n.setOptions([{value:"scroll",label:"Scroll Canvas"},{value:"zoom",label:"Zoom Canvas"}]),n.setValue(o.mouseWheelMode),n.placeAt(i);var r=t.div("MatcButtonBar MatcMarginTopXL").build(s),l=t.a("MatcButton MatcButtonPrimary","Save").build(r),h=t.a(" MatcLinkButton ","Cancel").build(r),c=new T.Z;c.own((0,m.Z)(h,w.Z.press,u.Z.hitch(c,"close"))),c.own((0,m.Z)(l,w.Z.press,u.Z.hitch(this,"onSaveSettings",c,a,n))),c.popup(s,e.target),this.canvas.enableMouseZoom(!1),this.canvas.setState("simulate"),this.logger.log(0,"onShowSettings","exit > ")},onSaveSettings(e,t,s){var i={canvasTheme:t.getValue(),mouseWheelMode:s.getValue()};this.canvas.setSettings(i),this.canvas.enableMouseZoom(!0),e.close()},showSignUpDialog(e){var t=new T.Z,s=new k.Z,i=s.div("MatcDialog ").build();this._createSignUpForm(t,i),t.popup(i,e.target)},_createSignUpForm(e,t){let s=this.$new(L.Z);return s.render([{label:"Email",name:"email",type:"text",required:"true",placeholder:"Your email",css:"input-lg MatcIgnoreOnKeyPress",error:"We need your email."},{label:"Password",name:"password",type:"password",min:6,placeholder:"Your password",css:"input-lg MatcIgnoreOnKeyPress",error:"The password should have at least six characters."},{label:'I have read the <a href="#/termsofservice.html" target="_blank">terms of service</a>',name:"tos",type:"check",required:"true",css:"MatcFormCheckBox MatcIgnoreOnKeyPress",error:"You must accept the terms of service!"}],[{label:"Cancel",css:"MatcLinkButton",click:u.Z.hitch(e,"close")},{label:"Create Free Account",css:"MatcButton MatchButtonGreen",click:u.Z.hitch(this,"_signUpAndNew",e,s)}]),s.placeAt(t),s.startup(),s},_signUpAndNew(e,t,s){var i=t.validateForm(null,!0);if(i)if(o=this._doPost("rest/user",s),"error"==o.type)o.errors.indexOf("user.email.not.unique")>=0?t.showError("The email is already taken! Please enter another one!","email"):t.showError("Something went wrong! Please try again!",""),e.shake();else{e.close();var o=this._doPost("rest/login/",s);"error"!=o.type?window.location.href="/my-account.html":console.error("_signUpAndSave() > Could not sign in user")}else e.shake()},cleanUp(){this.hideAllSections(),this.unselect()},unselect(){this._selectedWidget=null,this._selectedLine=null,this._selectedScreen=null,this._selectedMulti=null,this._selectedGroup=null,this._selection=null},blurWidgetProperties(){}},mounted(){this.db=new k.Z}},ke=Ze,Te=(0,H.Z)(ke,S,y,!1,null,null,null),_e=Te.exports,De=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"},[e._m(0),e._m(1),s("div",{staticClass:"MatcCanvasScrollBar MatcCanvasScrollBarBottom",style:"padding-left:"+this.layerListWidth+"px",attrs:{"data-dojo-attach-point":"scrollBottom"}},[e._m(2)]),s("div",{staticClass:"MatcMessage",attrs:{"data-dojo-attach-point":"message"}})])},Le=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvasFrame",attrs:{"data-dojo-attach-point":"frame"}},[s("div",{staticClass:"MatcCanvasContainer MatcCanvasZoomable",attrs:{"data-dojo-attach-point":"container"}},[s("div",{staticClass:"MatcCanvasContainer",attrs:{"data-dojo-attach-point":"zoomContainer"}},[s("div",{staticClass:"MatcCanvasLayer",attrs:{"data-dojo-attach-point":"screenContainer"}}),s("div",{staticClass:"MatcCanvasLayer",attrs:{"data-dojo-attach-point":"widgetContainer"}}),s("div",{staticClass:"MatcCanvasLayer MatcCanvasSVGLayer",attrs:{"data-dojo-attach-point":"svgContainer"}})]),s("div",{staticClass:"MatcDnDLayer",attrs:{"data-dojo-attach-point":"dndContainer"}})])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvasScrollBar MatcCanvasScrollBarRight",attrs:{"data-dojo-attach-point":"scrollRight"}},[s("div",{staticClass:"MatcCanvasScrollBarCntr MatcCanvasScrollBarCntrRight",attrs:{"data-dojo-attach-point":"scrollRightCntr"}},[s("div",{staticClass:"MatchCanvasScrollHandle",attrs:{"data-dojo-attach-point":"scrollRightHandler"}})])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvasScrollBarCntr MatcCanvasScrollBarCntrBottom",attrs:{"data-dojo-attach-point":"scrollBottomCntr"}},[s("div",{staticClass:"MatchCanvasScrollHandle",attrs:{"data-dojo-attach-point":"scrollBottomHandler"}})])}],xe=s(52298),Oe=s(66839),Pe=s(60481),We=s(49634),Be=s(15222),Ae=s(46482),He=s(96473),Ee=s(13776),Ve=s(56192),Fe=s(80783),Ne=s(74790),Re=s(87914),Ue=s(85482),Ie=s(66341),Ge=s(80720),$e=s(86179),ze=s(2226),je=s(26227),Je=s(1649),Ke=s(81215),qe=s(11477),Xe=s(69912),Qe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"})},Ye=[],et={name:"UserJourney",mixins:[],data:function(){return{}},components:{},methods:{highlightSession(e=!1){this.analyticParams.tree||this.highlightAnalyticLine(e)},highlightAnalyticLine(e){if(this.logger.log(1,"highlightAnalyticLine","entry > ",e),this.analyticLines)for(let t in this.analyticLines)this.hideOrShowLine(t,e)},hideOrShowLine(e,t){const s=this.analyticLines[e];s&&(t&&t!==e?s.style("opacity",0):s.style("opacity",1));const i=this.analyticLines[e+"taskBackGround"];if(i&&(t&&t+"taskBackGround"!==e+"taskBackGround"?i.style("opacity",0):i.style("opacity",1)),this.analyticCircles[e]){const s=this.analyticCircles[e];s.forEach((s=>{s.style.opacity=t&&t!==e?0:1}))}},_render_global_UserJourney(){this.logger.log(1,"_render_global_UserJourney","entry > "),this.setBW(!0),this.cleanUpAnalytics(),this.analyticParams.tree?this._renderUserTree():this._renderUserSingleLines()},_renderUserTree(){let e=this.getUserJourney(),t=new k.Z,s=this.analyticParams.time,i=this.analyticParams.sessions,o={},a=0,n=0;for(let l in i)if(!0===i[l]){let t=e[l];t?(this._getSessionGraph(t,o,s),a++):console.debug("_renderUserTree() > No session for ",l)}for(let l in o){const e=o[l];e.count>a&&(console.warn("_renderUserTree() > Update maxcount, because l.count bigger than max count"),a=e.count);const t=e.duration/e.count;n=Math.max(t,n)}const r={};for(let l in o){const e=o[l],i=[];i.push({x:e.from.x,y:e.from.y,d:"right"}),i.push({x:e.to.x,y:e.to.y,d:"right"});const h=e.duration/e.count,c=s?Math.min(1,h/n):Math.min(1,e.count/a),d=Math.min(15,Math.max(1,Math.round(25*c)))+1,g=this.mixColor(Math.min(1,c)),u=e.to.x+","+e.to.y,m=e.from.x+","+e.from.y;r[u]||(r[u]=this._renderTreeEvent(e.to.x,e.to.y,d,g,t)),r[m]||(r[m]=this._renderTreeEvent(e.from.x,e.from.y,d,g,t)),this.drawAnalyticLine(l,i,g,d,this.taskLineOpacity)}},_renderTreeEvent(e,t,s,i,o){const a=o.div("MatcAnalyticCanvasEventCntr").build(this.widgetContainer);a.style.left=Math.round(e)+"px",a.style.top=Math.round(t)+"px";const n=o.div("MatcAnalyticCanvasEvent MatcAnalyticCanvasEvent").build(a),r=Math.round(2*s);n.style.width=r+"px",n.style.height=r+"px",n.style.top=-1*Math.round(r/2)+"px",n.style.left=-1*Math.round(r/2)+"px",n.style.background=i},_renderUserSingleLines(){const e=this.getUserJourney(),t=this.getOutlierScores(),s=this.getTaskPerformance(),i=new k.Z;let o=null;!1!==this.analyticParams.task&&this.analyticParams.task>=0&&(o=this.testSettings.tasks[this.analyticParams.task]);const a=this.analyticParams.sessions;for(let n in a)if(!0===a[n]){const a=e[n],r=s[n],l=t[n];a?this._renderUserGraph(n,a,i,o,r,l):console.debug("_render_global_UserJourney() > No session for ",n)}this.analyticParams.outlier&&this.showHint(`Found ${Object.values(t).filter((e=>1===e)).length} outliers`)},_renderUserGraph(e,t,s,i,o,a){const r=t.data,l=[],h=r.length,c=[];let d,g,u=null,m=0,p=0;i&&o&&(g=o[i.id]);for(let n=0;n<h;n++){u=r[n],d&&(m=u.time-d.time,p=Math.max(m,p));const e=this.getEventScreenId(u),t=this.sourceModel.screens[e],s=this.model.screens[e];if(t&&s){if("SessionStart"==u.type){const e=t.x-Math.max(10,Math.round(30*this.zoom)),s=t.y+Math.max(10,Math.round(30*this.zoom));l.push({x:e,y:s,d:"right",duration:m,type:u.type,session:u.session})}else if(u.x>=0&&u.y>=0&&!u.noheat){const e=u.x*t.w+t.x,s=u.y*t.h+t.y;l.push({x:e,y:s,d:"right",duration:m,type:u.type,session:u.session}),d=u}if(g&&g.startPosition<=n&&g.endPosition>=n){const e=l[l.length-1];e.match=!0,c.push(e)}}else console.warn("_renderUserGraph()","Screen is not there",u.screen)}if(u&&"ScreenLoaded"===u.type){const e=this.getEventScreenId(u),t=this.sourceModel.screens[e];let s=Math.round(t.x+t.w/2),i=Math.round(t.y+t.h/2);if(l.push({x:s,y:i,d:"right",duration:m,type:u.type,session:u.session}),g&&g.startPosition<=h-1&&g.endPosition>=h-1){const e=l[l.length-1];e.match=!0,c.push(e)}}this.analyticCircles[e]=[];for(let S=0;S<l.length;S++){const t=l[S],i=Math.round(t.duration/p*40)+25,[o,r,h]=this._renderScreenEvent(t.x,t.y,t.type,"",s,t.session,i);S==l.length-1?(n.Z.add(h,"MatcAnalyticCanvasEventSessionEnd"),o.style.background=this.userJourneyEndColor,r.style.background=this.userJourneyEndColor+28,r.style.borderColor=this.userJourneyEndColor):S>0&&(t.match?(o.style.background=this.analyticParams.taskColor,r.style.background=this.analyticParams.taskColor+28,r.style.borderColor=this.analyticParams.taskColor):a&&this.analyticParams.outlier?(o.style.background=this.analyticParams.outlierColor,r.style.background=this.analyticParams.outlierColor+28,r.style.borderColor=this.analyticParams.outlierColor):(o.style.background=this.analyticParams.color,r.style.background=this.analyticParams.color+28,r.style.borderColor=this.analyticParams.color)),this.analyticCircles[e].push(h)}let v=this.analyticParams.color,M=this.taskLineOpacity,C=2;return this.analyticParams.outlier&&(a?(v=this.analyticParams.outlierColor,M=this.taskLineOpacity,C=4):M=.5*this.taskLineOpacity),i?(M=.5*this.taskLineOpacity,this.drawStraightAnalyticLine(e+"taskBackGround",l,v,C,M),this.drawStraightAnalyticLine(e,c,this.analyticParams.taskColor,4,this.taskLineOpacity)):this.drawStraightAnalyticLine(e,l,v,C,M),!1},_renderScreenEvent(e,t,s,i,o,a,n,r=15){const l=o.div("MatcAnalyticCanvasEventCntr").build(this.widgetContainer);l.style.left=Math.round(e)+"px",l.style.top=Math.round(t)+"px";const h=o.div("MatcAnalyticCanvasEventHalo").build(l);h.style.width=n+"px",h.style.height=n+"px",h.style.top=-1*Math.round(n/2)+"px",h.style.left=-1*Math.round(n/2)+"px";const c=o.div("MatcAnalyticCanvasEvent MatcAnalyticCanvasClickableEvent MatcAnalyticCanvasEvent"+s).build(l);return c.style.width=r+"px",c.style.height=r+"px",c.style.top=-1*Math.round(r/2)+"px",c.style.left=-1*Math.round(r/2)+"px",this.tempOwn((0,m.Z)(c,"click",u.Z.hitch(this,"onScreenEventClick",a))),[c,h,l]},onScreenEventClick(e,t){this.stopEvent(t),this.toolbar&&this.toolbar.setSelectSessions([e])},_getSessionGraph(e,t){const s=e.data;let i,o,a=null,n=0;for(let r=0;r<s.length;r++){a=s[r],o&&(n=a.time-o.time);const e=this.getEventScreenId(a),l=this.sourceModel.screens[e];if(l){const e={};if("SessionStart"==a.type)e.x=l.x-Math.max(10,Math.round(30)),e.y=l.y+Math.max(10,Math.round(30)),i=this._addToGraph(i,e,t,0);else if(a.x>=0&&a.y>=0&&!a.noheat)if(a.widget&&this.sourceModel.widgets[a.widget]){const s=this.sourceModel.widgets[a.widget];e.x=Math.round(s.x+s.w/2),e.y=Math.round(s.y+s.h/2),i=this._addToGraph(i,e,t,n),o=a}else e.x=Math.round(Math.min(1,a.x)*l.w+l.x),e.y=Math.round(Math.min(1,a.y)*l.h+l.y),i=this._addToGraph(i,e,t,n),o=a}else console.warn("_getSessionGraph()","Screen is not there",a.screen)}if(a&&"ScreenLoaded"===a.type){const e=this.getEventScreenId(a),s=this.sourceModel.screens[e],o={x:Math.round(s.x+s.w/2),y:Math.round(s.y+s.h/2)};i=this._addToGraph(i,o,t,n)}},_addToGraph(e,t,s,i){if(e){const o=e.x+";"+e.y+"-"+t.x+";"+t.y;return s[o]||(s[o]={from:e,to:t,count:0,duration:0}),s[o].count++,s[o].duration+=1*i,t}return t}},mounted(){}},tt=et,st=(0,H.Z)(tt,Qe,Ye,!1,null,null,null),it=st.exports,ot=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"})},at=[],nt={name:"DropOff",mixins:[],data:function(){return{}},components:{},methods:{_render_global_DropOff(){this.logger.log(1,"_render_global_DropOff","entry > ",this.analyticParams.task),this.setBW(!0),this.analyticParams.task?this.analyticParams.time?this._render_dropoff_task_time(this.analyticParams.task):this._render_dropoff_task_success(this.analyticParams.task):this.showError("No task selected")},_render_dropoff_task_time(e){const t=new k.Z,s=new W.Z(this.events),i=new F.Z,o=i.getFunnelSummary(s,e,this.annotation),a=e.flow.length;if(e.flow&&e.flow.length>1){const s=Math.max(1,o[o.length-1].durationMean);for(let i=0;i<e.flow.length-1;i++){const n=o[i+1],r=o[i+2],l=e.flow[i],h=e.flow[i+1],c=r.durationMean-n.durationMean,d=Math.min(1,c/s),g=this._getDropOffBoxPosition(l,i,a),u=this._getDropOffBoxPosition(h,i+1,a),m=[g,u];let p=this.mixColor(d),v=Math.max(3,Math.round(this.dropOffLineWidth*d));this.drawAnalyticLine("dropOffLine"+i,m,p,v,this.taskLineOpacity),this._renderDropOffEvent(u.x,u.y,"FlowStep",t,p,v+this.dropOffEventWidth,Math.round(c/100)/10,"s"),0===i&&(p=this.mixColor(d),v=Math.max(3,Math.round(this.dropOffLineWidth*d)),this._renderDropOffEvent(g.x,g.y,"FlowStep",t,p,v+this.dropOffEventWidth,"0","s"))}}else this.showError("Cannot show task times. The selected task has only one step.")},_render_dropoff_task_success(e){const t=new k.Z,s=new W.Z(this.events),i=new F.Z,o=i.getFunnelSummary(s,e,this.annotation),a=e.flow.length;if(e.flow&&e.flow.length>1)for(let n=0;n<e.flow.length-1;n++){const s=o[n+1],i=o[n+2],r=e.flow[n],l=e.flow[n+1],h=this._getDropOffBoxPosition(r,n,a),c=this._getDropOffBoxPosition(l,n+1,a),d=[h,c];let g=this.greenToRed(i.p),u=Math.max(3,Math.round(this.dropOffLineWidth*i.p));if(this.drawAnalyticLine("dropOffLine"+n,d,g,u,this.taskLineOpacity),s&&i){const e=s.p-i.p,o={x:h.x+100,y:h.y+100},a=[h,o];u=Math.max(3,Math.round(this.dropOffLineWidth*e)),this.drawAnalyticLine("dropOffLineDrop"+n,a,this.dropOffLineColor,u,this.taskLineOpacity),this._renderDropOffEvent(o.x,o.y,"FlowStep",t,this.dropOffLineColor,u+this.dropOffEventWidth,Math.round(-100*e))}this._renderDropOffEvent(c.x,c.y,"FlowStep",t,g,u+this.dropOffEventWidth,Math.round(100*i.p)),0===n&&(g=this.greenToRed(s.p),u=Math.max(3,Math.round(this.dropOffLineWidth*s.p)),this._renderDropOffEvent(h.x,h.y,"FlowStep",t,g,u+this.dropOffEventWidth,Math.round(100*s.p)))}else this.showError("Cannot show task times. The selected task has only one step.")},_getDropOffBoxPosition(e,t=0,s=1){if(e.widget){let t=this.sourceModel.widgets[e.widget];if(t){let e={};return e.x=Math.round(t.x+t.w/2),e.y=Math.round(t.y+t.h/2),e}this.logger.warn("_geDropOffBoxPosition","no widget > ",e.widget)}if(e.screen){let i=this.sourceModel.screens[e.screen];if(i){let e={};return e.x=Math.round(i.x+i.w/2),e.y=Math.min(i.y+i.h,Math.round(i.y+i.h/3)+i.h*t/(2*s)),e}this.logger.warn("_geDropOffBoxPosition","no screen > ",e.screen)}},_renderDropOffEvent(e,t,s,i,o,a,n,r="%"){var l=i.div("MatcAnalyticCanvasEventCntr").build(this.widgetContainer);l.style.left=Math.round(e)+"px",l.style.top=Math.round(t)+"px";var h=i.div("MatcAnalyticCanvasEvent MatcAnalyticCanvasEvent"+s).build(l),c=Math.max(5,Math.round(a));return h.style.width=c+"px",h.style.height=c+"px",h.style.top=-1*Math.round(c/2)+"px",h.style.left=-1*Math.round(c/2)+"px",h.style.background=o,this.tempOwn((0,m.Z)(h,"click",(e=>this.selectDropOffPoint(e)))),r&&i.span("MatcAnalyticCanvasEventLabel",n+r).build(h),h},selectDropOffPoint(){}},mounted(){}},rt=nt,lt=(0,H.Z)(rt,ot,at,!1,null,null,null),ht=lt.exports,ct=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"})},dt=[],gt=s(388),ut={name:"DataProcessing",mixins:[],data:function(){return{}},components:{},methods:{getOutlierScores(){if(!this.cache["outliers"]){const e=new W.Z(this.events),t=gt.by(e,2);this.cache["outliers"]=t}return this.cache["outliers"]},getGestures(){if(!this.cache["gestures"]){var e=new W.Z(this.events),t=e.select("type","in",["ScreenGesture","WidgetGesture"]);this.cache["gestures"]=t.data}return this.cache["gestures"]},getUserJourney(){if(!this.cache["userJourney"]){var e=new W.Z(this.events);e.sortBy("time");var t=e.groupBy("session");let s=t.data;this.cache["userJourney"]=s}return this.cache["userJourney"]},getTaskPerformance(){if(!this.cache["taskPerformance"]){const e=new F.Z,t=new W.Z(this.events);t.sortBy("time");const s=e.getTaskPerformance(t,this.testSettings.tasks,!1,!1),i={};for(let o=0;o<s.data.length;o++){const e=s.data[o];i[e.session]||(i[e.session]={}),i[e.session][e.task]?console.warn("getTaskPerformance() Double mactch",e):i[e.session][e.task]=e}this.cache["taskPerformance"]=i}return this.cache["taskPerformance"]},getOverlayViews(){if(!this.cache["overlayViews"]){for(var e=this.df.select("type","==","OverlayLoaded"),t=e.count("overlay"),s=e.size(),i={},o=this.getScreens(this.sourceModel),a=0;a<o.length;a++){var n=o[a];i[n.id]=t.get(n.id,null,0)}this.cache["overlayViews"]={total:s,counts:i}}return this.cache["overlayViews"]},getOverlayTest(){if(!this.cache["overlayTests"]){for(var e=this.df.groupBy("session"),t=e.size().size(),s={},i=this.getScreens(this.sourceModel),o=0;o<i.length;o++){var a=i[o];s[a.id]=0}e.foreach((function(e){var t=e.count("overlay");t.foreach((function(e,t){s[t]+=1}))})),this.cache["overlayTests"]={sessions:t,counts:s}}return this.cache["overlayTests"]},getScreenViews(){if(!this.cache["screenViews"]){for(var e=this.df.select("type","==","ScreenLoaded"),t=e.count("screen"),s=e.size(),i={},o=this.getScreens(this.sourceModel),a=0;a<o.length;a++){var n=o[a];i[n.id]=t.get(n.id,null,0)}this.cache["screenViews"]={total:s,counts:i}}return this.cache["screenViews"]},getScreenTests(){if(!this.cache["screenTests"]){for(var e=this.df.groupBy("session"),t=e.size().size(),s={},i=this.getScreens(this.sourceModel),o=0;o<i.length;o++){var a=i[o];s[a.id]=0}e.foreach((function(e){var t=e.count("screen");t.foreach((function(e,t){s[t]+=1}))})),this.cache["screenTests"]={sessions:t,counts:s}}return this.cache["screenTests"]},getScreenDwellTime(){if(!this.cache["screenDwell"]){for(var e=this.df.count("session"),t=e.size(),s=new F.Z,i=s.getScreenTimeGrouping(this.df),o=i.sum().sum(),a={},n=this.getScreens(this.sourceModel),r=0;r<n.length;r++){var l=n[r],h=i.get(l.id);a[l.id]=h?h.sum():0}this.cache["screenDwell"]={total:o,times:a,sessions:t}}return this.cache["screenDwell"]},getOverlayDwellTime(){if(!this.cache["overlayDwell"]){for(var e=this.df.count("session"),t=e.size(),s=new F.Z,i=s.getScreenTimeGrouping(this.df),o=i.sum().sum(),a=s.getOverlayTimeGrouping(this.df),n={},r=this.getScreens(this.sourceModel),l=0;l<r.length;l++){var h=r[l],c=a.get(h.id);n[h.id]=c?c.sum():0}this.cache["overlayDwell"]={total:o,times:n,sessions:t}}return this.cache["overlayDwell"]},getScreenWidgetClicks(){if(!this.cache["screenWidgetClicks"]){var e=this.df.select("type","==","WidgetClick"),t=e.count("screen"),s=t.sum();e=e.select("overlay","==",null),t=e.count("screen");for(var i={},o=this.getScreens(this.sourceModel),a=0;a<o.length;a++){var n=o[a];i[n.id]=t.get(n.id,null,0)}this.cache["screenWidgetClicks"]={clicks:i,total:s}}return this.cache["screenWidgetClicks"]},getScreenClicksOnBackground(e){const t=e.select("type","==","ScreenClick");return t},getMissedClicks(e){var t=Object.values(this.sourceModel.screens);let s={};t.forEach((e=>{let t=this.getFromLines(e);0===t.length&&(s[e.id]=!0)}));let i=[],o=Object.values(this.sourceModel.widgets);o.forEach((e=>{if("Box"===e.type||"Button"===e.type||"HotSpot"===e.type){let t=this.getFromLines(e);0===t.length&&(i[e.id]=!0)}}));let a=e.select("type","in",["ScreenClick","WidgetClick"]).as_array(),n=a.filter((e=>"ScreenClick"===e.type&&!0===s[e.screen]||"WidgetClick"===e.type&&!0===i[e.widget]));return n},getScreenClicks(){if(!this.cache["screenClicks"]){for(var e=this.df.select("type","in",["ScreenClick","WidgetClick"]),t=e.count("screen"),s=t.sum(),i=this.df.select("type","==","ScreenClick"),o=i.count("screen"),a={},n=this.getScreens(this.sourceModel),r=0;r<n.length;r++){var l=n[r];a[l.id]=o.get(l.id,null,0)}this.cache["screenClicks"]={clicks:a,total:s}}return this.cache["screenClicks"]},getOverlayClicks(){if(!this.cache["overlayCicks"]){for(var e=this.df.select("type","==","ScreenClick"),t=e.count("overlay"),s=t.sum(),i={},o=this.getScreens(this.sourceModel),a=0;a<o.length;a++){var n=o[a];i[n.id]=t.get(n.id,null,0)}this.cache["overlayCicks"]={clicks:i,total:s}}return this.cache["overlayCicks"]},getOverlayWidgetClicks(){if(!this.cache["overlayWidgetCicks"]){for(var e=this.df.select("type","==","WidgetClick"),t=e.count("overlay"),s=t.sum(),i={},o=this.getScreens(this.sourceModel),a=0;a<o.length;a++){var n=o[a];i[n.id]=t.get(n.id,null,0)}this.cache["overlayWidgetCicks"]={clicks:i,total:s}}return this.cache["overlayWidgetCicks"]},getLineWidgetData(){if(!this.cache["lineWidgetData"]){let e={},t=this.getWidgetData(),s=0;for(let i in this.model.lines){let o=this.model.lines[i].from;if(t[o]){const i=t[o].clicksAbs;e[o]={clicksAbs:i},s=Math.max(s,i)}Object.values(e).forEach((e=>{e.clicksRel=e.clicksAbs/s}))}this.cache["lineWidgetData"]=e}return this.cache["lineWidgetData"]},getWidgetData(){if(!this.cache["widgetData"]){var e=new F.Z,t={},s=e.getWidgetStatistics(this.sourceModel,this.df);for(var i in s)t[i]=s[i];this.cache["widgetData"]=t}return this.cache["widgetData"]},getFirstNClicksData(e,t){console.debug("getFirstNClicksData",e.length);const s=new F.Z;return s.getFirstNClicks(e,t)}},mounted(){}},mt=ut,pt=(0,H.Z)(mt,ct,dt,!1,null,null,null),vt=pt.exports,Mt={name:"AnalyticCanvas",props:["viewport"],mixins:[a.Z,Pe.Z,Z.Z,f.Z,Be.Z,Ae.Z,He.Z,Ee.Z,Ve.Z,Fe.Z,Ne.Z,Re.Z,Ue.Z,Ie.Z,Ge.Z,$e.Z,je.Z,Je.Z,Ke.Z,ze.Z,We.Z,it,ht,vt],data:function(){return{mode:"view",zoom:1,analyticMode:"HeatmapClick",resizeEnabled:!1,renderDND:!0,dragNDropMinTimeSpan:0,wireInheritedWidgets:!0,taskLineOpacity:1,isBlackAndWhite:!1,dropOffLineWidth:25,dropOffLineColor:"#555",dropOffEventWidth:40,userJourneyEndColor:"#f03131",layerListWidth:256}},components:{},methods:{postCreate(){this.logger=new v.Z("AnalyticCanvas"),this.logger.log(2,"constructor","entry"),this.cache={},this.moveMode="classic",this.domUtil=new qe.Z,this.analyticLines={},this.analyticCircles={},this.logger.log(2,"postCreate","entry"),this.initSize(),this.canvasPos={x:this.canvasStartX,y:this.canvasStartY,w:this.canvasFlowWidth,h:this.canvasFlowHeight},this.initViewport(),this.initContainerSize(),this.setContainerPos(),this.initSelection(),this.initRender(),this.initAnalyticSVG(),this.initZoom(),this.initScrollBars(),this.initComment(),this.initSettings(),this.initWiring(),this.initKeys(),this.initMouseTracker(),this.initDarkModeListener(),this.initLayer(),this.db=new k.Z,this.own(Oe.Z.subscribe("matc/toolbar/click",u.Z.hitch(this,"onToolbarClick"))),this.own((0,m.Z)(xe.Z.body(),"keydown",u.Z.hitch(this,"onKeyPress"))),this.own((0,m.Z)(xe.Z.body(),"keyup",u.Z.hitch(this,"onKeyUp"))),this.logger.log(2,"postCreate","exit!!!")},initLayer(){this.logger.log(-2,"initLayer","entry");const e=localStorage.getItem("quxLayerListWidth");e&&!isNaN(1*e)&&this.setLayerListWidth(1*e)},setLayerListWidth(e){this.layerListWidth=e},showError(e){this.message&&(n.Z.add(this.message,"MatcMessageError"),n.Z.remove(this.message,"MatcMessageSuccess MatcMessageHint"),this.message.textContent=e,setTimeout(u.Z.hitch(this,"hideMessage"),3e3))},XlineFunction(e){return this.straightLineFunction(e)},setPublic(e){this.isPublic=e},setModelService(e){this.sourceModelService=e},setCommentService(e){this.commentService=e},setToolbar(e){this.toolbar=e,this.onChangeCanvasViewConfig()},setMouseListener(e){this.mouseListenerCallback=e},inlineEditInit(){this.logger.log(2,"inlineEditInit","enter")},setMouseData(e){this.logger.log(0,"setMouseData","enter > "+e.length),this.mouseData=e,0==e.length&&this.showError("No Mouse data was recorded")},setBW(e){this.logger.log(1,"setBW","enter > "+e),e?n.Z.add(this.container,"MatcCanvasBW"):n.Z.remove(this.container,"MatcCanvasBW")},onChangeCanvasViewConfig(){this.toolbar&&this.toolbar.setCanvasViewConfig({zoom:this.zoom,renderLines:this.renderLines,showComments:this.showComments,isBlackAndWhite:this.isBlackAndWhite})},setCanvasViewConfig(e,t){this.logger.log(-1,"setCanvasViewConfig","enter > "+e,t),"zoom"===e&&this.setZoomFactor(t),"renderLines"===e&&this.setViewLines(t),"showComments"===e&&this.setCommentView(t),"isBlackAndWhite"===e&&(this.isBlackAndWhite=t,this.setBW(t))},initAnalyticSVG(){this.logger.log(3,"initAnalyticSVG","entry");let e=Xe.Ys(this.svgContainer);this.analyticSVG=e.append("svg").attr("width",this.canvasPos.h).attr("height",this.canvasPos.w)},cleanUpAnalyticLines(){this.analyticSVG&&this.analyticSVG.selectAll("*").remove(),this.analyticLines={},this.analyticCircles={}},drawLine(e,t){let s=this.defaultLineColor,i=this.defaultLineWidth;if(this.model&&this.model.lines&&this.model.lines[e]){let t=this.model.lines[e],i=this.getLineWidgetData();if(i[t.from]){let e=i[t.from],o=e.clicksRel;s=this.mixColor(o)}}return this.drawSVGLine(e,t,s,i,1)},drawAnalyticLine(e,t,s,i,o){const a=this.analyticSVG.append("path").attr("d",this.lineFunction(t)).attr("stroke",s).attr("stroke-width",i).attr("fill","none").style("opacity",o);this.analyticLines[e]=a},drawStraightAnalyticLine(e,t,s,i,o){const a=this.analyticSVG.append("path").attr("d",this.straightLineFunction(t)).attr("stroke",s).attr("stroke-width",i).attr("fill","none").style("opacity",o);this.analyticLines[e]=a},initWiring(){this.logger.log(-1,"initWiring","enter"),this.own((0,m.Z)(this.dndContainer,"mousedown",(e=>this.dispatchMouseDown(e))))},dispatchMouseDownScreen(e,t){this.logger.log(-1,"dispatchMouseDownScreen","enter",t);let s=this.screenDivs[t],i=this.model.screens[t];this.onScreenDndClick(i.id,s,null)},dispatchMouseDownWidget(e,t){this.logger.log(-1,"dispatchMouseDownWidget","enter",t);let s=this.widgetDivs[t];this.onWidgetDndClick(t,s)},afterUpdateDnd(e){this.logger.log(1,"afterUpdateDnd","enter > ",e)},initSettings(){this.logger.log(1,"initSettings","enter > "),this.settings={canvasTheme:"MatcLight",lineColor:"#333",lineWidth:1,storePropView:!0,moveMode:"ps",mouseWheelMode:"scroll"};var e=this._getStatus("matcSettings");e?(e.canvasTheme&&(this.settings.canvasTheme=e.canvasTheme),e.lineColor&&(this.settings.lineColor=e.lineColor),e.lineWidth&&(this.settings.lineWidth=e.lineWidth)):this.logger.log(2,"initSettings","exit>  no saved settings"),this.applySettings(this.settings)},getSettings(){return this.settings},setSettings(e){e.canvasTheme&&(this.settings.canvasTheme=e.canvasTheme),e.lineColor&&(this.settings.lineColor=e.lineColor),e.lineWidth&&(this.settings.lineWidth=e.lineWidth),null!=e.storePropView&&(this.settings.storePropView=e.storePropView),null!=e.mouseWheelMode&&(this.settings.mouseWheelMode=e.mouseWheelMode),this._setStatus("matcSettings",this.settings),this.applySettings(this.settings),this.rerender()},applySettings(e){this.logger.log(2,"applySettings","enter > "+e.canvasTheme+" &> "+e.moveMode),e.lineColor&&(this.defaultLineColor=e.lineColor),e.lineWidth&&(this.defaultLineWidth=e.lineWidth),e.canvasTheme&&this.setCanvasTheme(e.canvasTheme),e.mouseWheelMode&&(this._mouseWheelMode=e.mouseWheelMode),this.settings=e},setCanvasTheme(e){"MatcAuto"===e&&(this.logger.log(-1,"setCanvasTheme","enter > auto: "+e+" > OS: "+this.isDarkModeOS()),e=this.isDarkModeOS()?"MatcDark":"MatcLight"),this._lastCanvasTheme&&n.Z.remove(xe.Z.body(),this._lastCanvasTheme),n.Z.add(xe.Z.body(),e),this._lastCanvasTheme=e,this.defaultLineColor="#49C0F0"},initDarkModeListener(){const e=window.matchMedia("(prefers-color-scheme: dark)");this.own((0,m.Z)(e,"change",(()=>{this.logger.log(-1,"initDarkModeListener","change"),"MatcAuto"===this.settings.canvasTheme&&this.setCanvasTheme(this.settings.canvasTheme)})))},isDarkModeOS(){return!window.matchMedia||!!window.matchMedia("(prefers-color-scheme: dark)").matches},onWidgetDndClick(e,t,s,i){this.logger.log(2,"onWidgetDndClick","enter > "+e),this.stopEvent(i),this.onWidgetSelected(e),this.selectAnalyticDiv(e),this.setState(0)},onScreenDndClick(e,t,s,i){this.logger.log(2,"onScreenDndClick","entry > "+e),this.stopEvent(i),this.setSelectedScreens([e]),this.selectAnalyticDiv(e),this.setState(0)},onCanvasSelected(){this.logger.log(2,"onCanvasSelected","entry > "),this.selectAnalyticDiv(null),this.toolbar&&(this.toolbar.unselect(),this.toolbar.onCanvasSelected())},selectAnalyticDiv(e){if(this._analyticLastSelectedDiv&&(n.Z.remove(this._analyticLastSelectedDiv,"MatcHeapMapWidgetSelected"),delete this._analyticLastSelectedDiv),this.analyticsDivs&&this.analyticsDivs[e]){let t=this.analyticsDivs[e];n.Z.add(t,"MatcHeapMapWidgetSelected"),this._analyticLastSelectedDiv=t}if(this.widgetDivs&&this.widgetDivs[e]){let t=this.widgetDivs[e];n.Z.add(t,"MatcHeapMapWidgetSelected"),this._analyticLastSelectedDiv=t}},renderLayerList(){this.logger.log(1,"renderLayerList","entry > ")},afterRender(){this.logger.log(1,"afterRender","entry > "+this.analyticMode),this.cleanUpAnalytics();try{this._renderHeatMap()}catch(e){this.logger.error("afterRender","Could not render heatmaps ",e),this.logger.sendError(e)}},hasSelect(){return"addComment"!=this.mode},_renderHeatMap(){this.logPageView("/analytics/workspace/"+this.analyticMode+".html"),this.setBW(this.isBlackAndWhite),this.cleanUpHeat(),"smartphone"==this.sourceModel.type||"tablet"==this.sourceModel.type?(this.defaultRadius=this.sourceModel.screenSize.w/20,this.defaultBlur=this.sourceModel.screenSize.w/15):(this.defaultRadius=this.sourceModel.screenSize.w/120,this.defaultBlur=this.sourceModel.screenSize.w/100),this.logger.log(0,"onScreenRendered","adjust radios to "+this.defaultRadius);const e=this.df.groupBy("screen");for(var t in this.heatmapDivs={},this.sourceModel.screens){const s=this.sourceModel.screens[t],i=e.get(t);let o=[];if(i&&(o=i.as_array()),this["_render_"+this.analyticMode]){const e=this.createBox(s);n.Z.add(e,"MatcHeatMapScreen");const t=this.db.div("MatcHeapMapContainer").build(e),i=this.db.canvas(s.w,s.h).build(t),a=i.getContext("2d");this["_render_"+this.analyticMode](o,s,a,e),this.hasSelect()&&this.tempOwn((0,m.Z)(e,w.Z.press,u.Z.hitch(this,"onScreenDndClick",s.id,e,null))),this.widgetContainer.appendChild(e),this.heatmapDivs[s.id]=e,this.analyticsDivs[s.id]=e}}"UserJourney"!=this.analyticMode&&"Gesture"!=this.analyticMode&&"DropOff"!=this.analyticMode?this.hideWidgetDND=!0:this.hideWidgetDND=!1,this["_render_global_"+this.analyticMode]&&this["_render_global_"+this.analyticMode]()},_render_HeatmapMouse(e,t,s){this.logger.log(0,"_render_HeatmapMouse","entry > "+t.name);let i=this.mouseData.filter((e=>e.screen===t.id));i=this._filterSelectedSessions(i);let o=this.computeMouseDistribution(i,this.sourceModel);if(o[t.id]){let e=o[t.id];this.draw(s,e.values,e.max,t.w,t.h)}},_render_HeatmapClick(e,t,s,i){this.logger.log(2,"_render_HeatmapClick","entry > ");const o=this._filterSelectedSessions(this.events),a=new W.Z(o);var n=-1;if(this.analyticParams&&(n=this.analyticParams.numberOfClicks),"screenClicks"===n){let e=this.getScreenClicksOnBackground(a);e=e.as_array(),this._render_pixel_screen_heatmap(e,t,s,i)}else if("missedClicks"===n){let e=this.getMissedClicks(a);this._render_pixel_screen_heatmap(e,t,s,i)}else if(n>0){let e=this.getFirstNClicksData(o,n);this._render_pixel_screen_heatmap(e,t,s,i)}else{let e=this.getClickEvents(new W.Z(o)),a=e.as_array();this._render_pixel_screen_heatmap(a,t,s,i)}},_filterSelectedSessions(e){if(this.analyticParams&&this.analyticParams.sessions){const t=this.analyticParams.sessions;return e.filter((e=>!0===t[e.session]))}return e},_render_pixel_screen_heatmap(e,t,s){if(t.w<=0||t.h<=0)this.logger.error("_render_pixel_screen_heatmap","Error > bad screen dimension: "+t.name);else try{const i=[];for(let s=0;s<e.length;s++){const o=e[s],a=this.getEventScreenId(o);a==t.id&&i.push(o)}const o=this.computeClickDistribution(i,t.w,t.h);this.draw(s,o.values,o.max,t.w,t.h)}catch(i){this.logger.error("_render_pixel_screen_heatmap","Error > "+t.name)}},_render_HeatmapScrollView(e,t,s){this.logger.log(2,"_render_HeatmapScrollView","entry > ");var i=this.computeScrollVisibiltyDistribution(e,this.sourceModel.screenSize.h,t.h);this.drawSections(i,s,t.h,t.w)},_render_HeatmapScrollTime(e,t,s){this.logger.log(2,"_render_HeatmapScrollTime","entry > ");var i=this.computeScrollDurationDistrubtion(e,this.sourceModel.screenSize.h,t.h);this.drawSections(i,s,t.h,t.w)},_render_HeatmapViews(e,t,s){if(this.logger.log(2,"HeatmapViews","entry > "),t.style.overlay){let e=this.getOverlayViews(),i=e.counts[t.id];i||(i=0),s.globalAlpha=.4;let o=this.mixColor(i/e.total);s.fillStyle=o,s.fillRect(0,0,t.w,t.h)}else{let e=this.getScreenViews(),i=e.counts[t.id];i||(i=0),s.globalAlpha=.4;let o=this.mixColor(i/e.total);s.fillStyle=o,s.fillRect(0,0,t.w,t.h)}},_render_HeatmapDwelTime(e,t,s){if(this.logger.log(2,"HeatmapDwelTime","entry > "),t.style.overlay){let e=this.getOverlayDwellTime(),i=e.times[t.id];i||(i=0),s.globalAlpha=.4;let o=this.mixColor(i/e.total);s.fillStyle=o,s.fillRect(0,0,t.w,t.h)}else{let e=this.getScreenDwellTime(),i=e.times[t.id];i||(i=0),s.globalAlpha=.4;let o=this.mixColor(i/e.total);s.fillStyle=o,s.fillRect(0,0,t.w,t.h)}},drawDurationLine(e,t,s,i){for(let o=0;o<t.length-1;o++){let a=t[o],n=t[o+1],r=n.duration/i,l=Math.round(6*r)+2,h=s;this.drawStraightAnalyticLine(e,[a,n],h,l,this.taskLineOpacity)}},_render_global_Gesture(){this.logger.log(0,"_render_global_Gesture","entry > ");for(var e=this.getGestures(),t=new k.Z,s=0;s<e.length;s++){var i=e[s],o=i.gesture,a=this.getEventScreenId(i),n=this.sourceModel.screens[a];if(n&&o){var r=[],l=i.gesture.start,h=i.gesture.end;if(l&&h){var c=l.x*n.w+n.x,d=l.y*n.h+n.y;r.push({x:c,y:d,d:"right"}),this._renderGestureStart(c,d,this.analyticParams.color,t),c=h.x*n.w+n.x,d=h.y*n.h+n.y,r.push({x:c,y:d,d:"right"});var g=Math.max(1,Math.round(3*this.zoom));this.drawSVGLine("",r,this.analyticParams.color,g,1)}}else console.warn("_render_global_Gesture()","Screen is not there",i.screen)}},_renderGestureStart(e,t,s,i){var o=i.div("MatcAnalyticCanvasEventCntr").build(this.widgetContainer);o.style.left=Math.round(e)+"px",o.style.top=Math.round(t)+"px";var a=i.div("MatcAnalyticCanvasEvent MatcAnalyticCanvasEvent").build(o),n=Math.max(5,Math.round(15*this.zoom));return a.style.width=n+"px",a.style.height=n+"px",a.style.top=-1*Math.round(n/2)+"px",a.style.left=-1*Math.round(n/2)+"px",a.style.backgroundColor=s,a},cleanUpAnalytics(){this.cleanUpAnalyticLines(),this.cleanUpNode(this.widgetContainer),this.analyticsDivs={}},setController(e){this.logger.log(2,"setController","enter"),this.controller=e,e.setCanvas(this)},getController(){return this._controllerCallback&&this[this._controllerCallback](),this.controller},setControllerCallback(e){this._controllerCallback=e},setModelFactory(e){this.logger.log(3,"setModelFactory","enter"),this.factory=e},setRenderFactory(e){this.logger.log(3,"setRenderFactory","enter"),this.renderFactory=e},setModel(e){this.sourceModel=e,this.model=e,this.grid=this.sourceModel.grid,this.setCommentView(this.showComments)},setEvents(e){this.logger.log(1,"setEvents","enter > # "+e.length);var t=new F.Z;this.events=t.nornalizeContainerChildEvents(e),this.df=new W.Z(e),this.df.sortBy("time"),this.fixGestures(e)},setAnnotation(e){this.logger.log(2,"setAnnotation","enter > # "),this.annotation=e},setTest(e){this.logger.log(2,"setTest","enter > # "),this.testSettings=e},setAnalyticMode(e,t){this.logger.log(2,"setAnalyticMode","entry > mode: "+e),this.analyticMode=e,this.analyticParams=t,this.rerender(),this.analyticCSS&&n.Z.remove(this.domNode,this.analyticCSS),this.analyticCSS=e,n.Z.add(this.domNode,this.analyticCSS)},setUser(e){this.user=e},setMode(e,t){this.logger.log(2,"setMode","enter > "+e+" != "+this.mode+" > "+t),e!=this.mode?(this.mode=e,this.toolbar&&this.toolbar.setMode(e),this.rerender()):t&&this.rerender()},setSubMode(){},onKeyPress(e){if(this._currentKeyEvent=e,"simulate"!=this.state&&"dialog"!=this.state){var t=e.target;if(!n.Z.contains(t,"MatcIgnoreOnKeyPress")){var s=e.keyCode?e.keyCode:e.which;32==s?this._inlineEditStarted||(this.stopEvent(e),"move"!=this.getMode()&&(this.setMode("move"),this.showHint("Move the mouse to move canvas..."),this.onDragStart(this.container,"container","onCanvasDnDStart","onCanvasDnDMove","onCanvasDnDEnd",null,this._lastMouseMoveEvent,!0))):37==s?this.onArrowLeft():39==s?this.onArrowRight():40==s?this.onArrowDown():38==s?this.onArrowUp():171==s||187==s?this._inlineEditStarted||(this.onClickPlus(),this.stopEvent(e)):173!=s&&189!=s||this._inlineEditStarted||(this.onClickMinus(),this.stopEvent(e))}}},getMode(){return this.mode},onKeyUp(e){var t=e.keyCode?e.keyCode:e.which;32==t&&(this.onDragEnd(this._lastMouseMoveEvent),this.setMode("view")),delete this._currentKeyEvent},initMouseTracker(){this.own((0,m.Z)(xe.Z.body(),"mousemove",u.Z.hitch(this,"onMouseMove")))},onMouseMove(e){var t=this.getCanvasMousePosition(e,!0);this._lastMousePos=t,this._lastMouseMoveEvent=e},destroy(){this.cleanUp()},logPageView(e){this.logger.log(4,"logPageView","enter",e)}},mounted(){}},Ct=Mt,St=(0,H.Z)(Ct,De,Le,!1,null,null,null),yt=St.exports,wt=s(71251),bt=s(62811);class ft extends wt.Z{constructor(){super(),this.logger=new v.Z("AnalyticController"),this.logger.log(2,"constructor","exit")}setModelService(e){this.modelService=e}setCanvas(e){this.logger.log(3,"setCanvas","entry"),this._canvas=e}setToolbar(e){this.logger.log(3,"setToolbar","entry"),this.toolbar=e}setModelFactory(e){this.logger.log(3,"setModelFactory","entry"),this.factory=e}setModel(e,t){this.logger.log(2,"setModel","entry > "+t),this.model=e,this.inheritedModel=this.createInheritedModel(e),this.inheritedModel=wt.Z.addContainerChildrenToModel(this.inheritedModel),this.oldModel=u.Z.clone(e),this.render(t,(()=>{this.toolbar?this.toolbar.setModel(e):console.debug("No toolbar in controller!")})),this._canvas&&(this._canvas.setFonts(e.fonts),this._canvas.setModel(this.model)),this.logger.log(3,"setModel","entry > "+t)}setMode(e){this.logger.log(0,"setMode","entry > "+e),this.toolbar.setMode(e),this._canvas.setMode(e)}setSinglePage(e){this.logger.log(0,"setSinglePage","entry > "+e)}getZoomFactor(){return this._canvas?this._canvas.getZoomFactor():1}render(e,t){if(this.logger.log(2,"render","enter > screenID : "+e),this._canvas){const s=bt.Z.createInheritedModel(this.model);requestAnimationFrame((()=>{this._canvas.render(s),e&&this._canvas.moveToScreen(e),t&&t()}))}}_requestRendering(e){this._zoomedModel&&(this._canvas.render(this._zoomedModel),e&&this._canvas.moveToScreen(e)),this._zoomedModel=null}_zoomToScreen(e){if(e&&this.model.screens[e]){var t=this.model.screens[e];let i=r.Z.getBox(),o=i.w/t.w,a=i.h/t.h;var s=Math.floor(10*Math.min(o,a))/10-.2;this._canvas.setZoom(s)}}onWidgetSelected(e){this.logger.log(0,"onWidgetSelected","enter > "+e);var t=this.inheritedModel.widgets[e];t?this.toolbar&&this.toolbar.onWidgetSelected(t):console.warn("onWidgetSelected() > No width with id",e)}onScreenSelected(e){this.logger.log(1,"onScreenSelected","enter > "+e);var t=this.model.screens[e];this.toolbar&&this.toolbar.onScreenSelected(t)}onCanvasSelected(){this.logger.log(1,"onCanvasSelected","enter "),this.toolbar&&this.toolbar.onCanvasSelected()}onLineSelected(e){this.logger.log(1,"onLineSelected","enter > "+e);var t=this.model.lines[e];this.toolbar&&this.toolbar.onLineSelected(t)}onMultiSelect(e){this.logger.log(1,"onMultiSelect","enter > "),this.toolbar&&this.toolbar.onMultiSelect(e)}onGroupSelected(e){if(this.logger.log(1,"onGroupSelected","enter > "+e),this.model.groups&&this.model.groups[e]&&this.toolbar){var t=this.model.groups[e];this.toolbar.onGroupSelect(t)}}unSelect(){this._canvas&&this._canvas.unSelect(),this.toolbar&&this.toolbar.cleanUp()}showSuccess(e){this._canvas&&this._canvas.showSuccess(e)}showError(e){this._canvas&&this._canvas.showError(e)}}var Zt={name:"Design",mixins:[a.Z],data:function(){return{selectedViewMode:"",viewport:null}},components:{DesignToolbar:l.Z,DesignCanvas:h.Z,AnalyticToolbar:_e,AnalyticCanvas:yt},computed:{pub(){return this.$route.meta&&this.$route.meta.isPublic},mode(){return this.pub?"public":"private"}},methods:{onViewPortChange(e){this.viewport=e},onVieModeChange(e){this.logger.log(-1,"onVieModeChange","enter",e),this.load(e)},onMouseWheel(e){e&&Math.abs(e.deltaX)>50&&(this.logger.log(-1,"onMouseWheel","cancel"),e.preventDefault())},load(e){"Design"===e?this.loadData(e):this.loadAnlyticData(e)},loadData(e){let t=this.$route.params.id;this.logger.log(3,"loadData","enter",t),Promise.all([this.loadApp(t),this.loadCommands(t),this.loadInvitations(t)]).then((t=>{this.cache.app=t[0],this.cache.commands=t[1],this.cache.inivitations=t[2];const s=t[2],i=this.getHashFromInvitation(s);this.selectedViewMode=e,this.$nextTick((()=>{this.buildCanvas(t[0],t[1],i)}))}))},loadAnlyticData(e){let t=this.$route.params.id;this.logger.log(0,"loadAnlyticData","enter",t),Promise.all([this.loadApp(t),this.loadTest(t),this.loadEvents(t),this.loadAnnotations(t),this.loadInvitations(t)]).then((t=>{this.cache.app=t[0],this.cache.test=t[1],this.cache.events=t[2],this.cache.annotation=t[3],this.cache.inivitations=t[4];const s=t[4],i=this.getHashFromInvitation(s);this.selectedViewMode=e,this.$nextTick((()=>{this.buildAnalyticCanvas(t[0],t[1],t[2],t[3],i)}))}))},getHashFromInvitation(e){const t={};for(let i in e)t[e[i]]=i;const s=t[1];return s},loadAll(){let e=this.$route.params.id;this.logger.log(2,"loadAll","enter",e),Promise.all([this.loadApp(e),this.loadTest(e),this.loadEvents(e),this.loadAnnotations(e),this.loadInvitations(e),this.loadCommands(e)]).then((e=>{this.cache.app=e[0],this.cache.test=e[1],this.cache.events=e[2],this.cache.annotation=e[3],this.cache.inivitations=e[4],this.cache.commands=e[5]}))},loadTest(e){return this.cache.test?this.cache.test:this.modelService.findTest(e)},loadEvents(e){return this.cache.events?this.cache.events:this.modelService.findEvents(e)},loadAnnotations(e){return this.cache.annotation?this.cache.annotation:this.modelService.findSessionAnnotations(e)},loadApp(e){return this.cache.app?this.cache.app:this.modelService.findApp(e)},loadCommands(e){return this.cache.commands?this.cache.commands:this.modelService.getCommands(e)},loadInvitations(e){return this.cache.inivitations?this.cache.inivitations:this.modelService.findInvitation(e)},setCache(e,t){this.cache[e]=t},buildCanvas(e,t,s){this.logger.log(3,"buildCanvas","enter");const i=this.$refs.canvas,o=this.$refs.toolbar,a=new c.Z,n=this.modelService,r=new d.Z;r.setModel(e);const l=new g.Z;l.setModel(e),l.setHash(s),a.setModelService(n),a.setToolbar(o),a.setModelFactory(r),this.pub&&(a.setPublic(!0),i.setPublic(!0),o.setPublic(!0)),o.setController(a),o.setCommentService(p.Z.getCommentService()),o.setCanvas(i),o.setUser(this.user),o.setModelFactory(r),o.setContext(this.context),o.setModelService(n),o.setHash(s),i.setController(a),i.setCommentService(p.Z.getCommentService()),i.setToolbar(o),i.setRenderFactory(l),i.setModelFactory(r),i.setModelService(n),i.setUser(this.user),this.tempOwn((0,m.Z)(o,"newScreen",u.Z.hitch(i,"addScreen"))),this.tempOwn((0,m.Z)(o,"newWidget",u.Z.hitch(i,"addWidget"))),this.tempOwn((0,m.Z)(o,"newLine",u.Z.hitch(i,"addLine"))),this.tempOwn((0,m.Z)(o,"newComment",u.Z.hitch(i,"addComment"))),this.tempOwn((0,m.Z)(o,"newTemplatedWidget",u.Z.hitch(i,"addTemplatedWidget"))),this.tempOwn((0,m.Z)(o,"newTemplatedScreen",u.Z.hitch(i,"addTemplatedScreen"))),this.tempOwn((0,m.Z)(o,"newTemplatedGroup",u.Z.hitch(i,"addTemplatedGroup"))),this.tempOwn((0,m.Z)(o,"newThemedScreen",u.Z.hitch(i,"addThemedScreen"))),this.tempOwn((0,m.Z)(o,"newThemedGroup",u.Z.hitch(i,"addThemedGroup"))),this.tempOwn((0,m.Z)(o,"newThemedWidget",u.Z.hitch(i,"addThemedWidget"))),this.tempOwn((0,m.Z)(o,"newMultiThemedScreen",u.Z.hitch(i,"addMultiThemedScreens"))),this.tempOwn((0,m.Z)(o,"newThemedScreenAndWidget",u.Z.hitch(i,"addThemedScreenAndWidgets"))),this.tempOwn((0,m.Z)(o,"newImportApp",u.Z.hitch(i,"addImportedApp"))),this.tempOwn((0,m.Z)(o,"onNewLogicObject",u.Z.hitch(i,"addLogicGroup"))),this.tempOwn((0,m.Z)(o,"onNewRestObject",u.Z.hitch(i,"addRestObject"))),this.tempOwn((0,m.Z)(o,"onNewScriptObject",u.Z.hitch(i,"addScriptObject"))),this.tempOwn((0,m.Z)(o,"onNewSVG",u.Z.hitch(i,"addSVG"))),this.tempOwn((0,m.Z)(o,"onEditSVG",u.Z.hitch(i,"openSVGEditor"))),a.setCommandStack(t),a.setModel(e,this.$route.params.sid),i.initLayer(),this.pub||"guest"===this.user.role||(this.collabSession=new C(this.user),this.collabSession.initWebsocket(e,i,a,o),window.onbeforeunload=()=>{this.collabSession.sendBye()})},buildAnalyticCanvas(e,t,s,i,o){this.logger.log(-1,"buildAnalyticCanvas","enter",o);const a=this.$refs.canvas,n=this.$refs.toolbar,r=new ft,l=p.Z.getModelService(),h=new d.Z;h.setModel(e);const c=new g.Z;c.setModel(e),c.setHash(o),r.setModelService(l),r.setToolbar(n),r.setModelFactory(h),n.setController(r),n.setCanvas(a),n.setUser(this.user),n.setModelFactory(h),n.setModelService(l),n.setEvents(s),n.setAnnotation(i),n.setTest(t),n.setCommentService(p.Z.getCommentService()),n.setPublic(this.isPublic),a.setController(r),a.setToolbar(n),a.setRenderFactory(c),a.setModelFactory(h),a.setCommentService(p.Z.getCommentService()),a.setUser(this.user),a.setEvents(s),a.setAnnotation(i),a.setTest(t),this.tempOwn((0,m.Z)(n,"newComment",u.Z.hitch(a,"addComment")));let v=null;for(let d in e.screens){const t=e.screens[d];if(t.props&&t.props.start){v=d;break}}r.setModel(e,v)},getModeFromRoute(){return"Heatmap"===this.$route.meta.viewMode?"Heatmap":"Design"}},beforeDestroy(){this.collabSession&&(this.collabSession.sendBye(),this.collabSession.close())},async mounted(){this.logger=new v.Z("Design"),this.cache={},n.Z.add(r.Z.body(),"MatcVisualEditor"),this.user=await p.Z.getUserService().load(),this.modelService=p.Z.getModelService(this.$route);const e=this.getModeFromRoute();this.load(e),this.logger.log(-1,"mounted","exit > "+e),setTimeout((()=>this.loadAll()),3e3)}},kt=Zt,Tt=(0,H.Z)(kt,i,o,!1,null,null,null),_t=Tt.exports},20085:function(e,t,s){s.r(t),s.d(t,{default:function(){return te}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvasPage MatcShare",attrs:{id:"CanvasNode"}},[s("ShareCanvas",{ref:"canvas"})],1)},o=[],a=s(99917),n=s(93134),r=s(32551),l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"},[s("div",{staticClass:"MatcCanvasFrame",attrs:{"data-dojo-attach-point":"frame"}},[s("div",{staticClass:"MatcCanvasContainer MatcCanvasZoomable ",attrs:{"data-dojo-attach-point":"container"}},[e._m(0),s("div",{staticClass:"MatcDnDLayer",attrs:{"data-dojo-attach-point":"dndContainer"},on:{click:e.onDNDLayerClick}})])]),e._m(1),e._m(2),s("div",{staticClass:"MatcMessage",attrs:{"data-dojo-attach-point":"message"}})])},h=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvasContainer ",attrs:{"data-dojo-attach-point":"zoomContainer"}},[s("div",{staticClass:"MatcCanvasLayer",attrs:{"data-dojo-attach-point":"screenContainer"}}),s("div",{staticClass:"MatcCanvasLayer",attrs:{"data-dojo-attach-point":"widgetContainer"}})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvasScrollBar MatcCanvasScrollBarRight",attrs:{"data-dojo-attach-point":"scrollRight"}},[s("div",{staticClass:"MatcCanvasScrollBarCntr MatcCanvasScrollBarCntrRight",attrs:{"data-dojo-attach-point":"scrollRightCntr"}},[s("div",{staticClass:"MatchCanvasScrollHandle",attrs:{"data-dojo-attach-point":"scrollRightHandler"}})])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvasScrollBar MatcCanvasScrollBarBottom",attrs:{"data-dojo-attach-point":"scrollBottom"}},[s("div",{staticClass:"MatcCanvasScrollBarCntr MatcCanvasScrollBarCntrBottom",attrs:{"data-dojo-attach-point":"scrollBottomCntr"}},[s("div",{staticClass:"MatchCanvasScrollHandle",attrs:{"data-dojo-attach-point":"scrollBottomHandler"}})])])}],c=s(14285),d=s(24615),g=s(42477),u=s(52298),m=s(66839),p=s(40626),v=s(55887),M=s(51804),C=s(84866),S=s(60481),y=s(49634),w=s(15222),b=s(46482),f=s(96473),Z=s(13776),k=s(56192),T=s(80783),_=s(87914),D=s(85482),L=s(66341),x=s(80720),O=s(86179),P=s(2226),W=s(54712),B=s(37339),A=s(11747),H=s(26227),E=s(1649),V=s(81215),F=s(76799),N=s(11477),R={name:"ShareCanvas",mixins:[a.Z,S.Z,B.Z,w.Z,b.Z,f.Z,Z.Z,k.Z,T.Z,_.Z,D.Z,L.Z,x.Z,O.Z,P.Z,H.Z,E.Z,V.Z,y.Z,F.Z],data:function(){return{mode:"view",zoom:.4,zoomLevelPos:3,analyticMode:"HeatmapClick",resizeEnabled:!1,renderDND:!0,dragNDropMinTimeSpan:0,wireInheritedWidgets:!0,taskLineOpacity:1}},components:{},methods:{postCreate(){this.logger=new c.Z("ShareCanvas"),this.logger.log(2,"postCreate","entry"),this.domUtil=new N.Z,this.initSize(),this.initWiring(),this.cache={},this.moveMode="classic",this.canvasPos={x:this.canvasStartX,y:this.canvasStartY,w:this.canvasFlowWidth,h:this.canvasFlowHeight},this.initContainerSize(),this.setContainerPos(),this.db=new v.Z,this.initSelection(),this.initRender(),this.initZoom(),this.initScrollBars(),this.initComment(),this.initSettings(),this.initMouseTracker(),this.initButtons(),this.own(m.Z.subscribe("matc/toolbar/click",g.Z.hitch(this,"onToolbarClick"))),this.own((0,d.Z)(u.Z.body(),"keydown",g.Z.hitch(this,"onKeyPress"))),this.own((0,d.Z)(u.Z.body(),"keyup",g.Z.hitch(this,"onKeyUp"))),this.logger.log(2,"postCreate","exit!!!")},closeSVGEditor(){},setModelService(e){this.modelService=e},setCommentService(e){this.commentService=e},setPublic(e){this.isPublic=e},inlineEditInit(){this.logger.log(2,"inlineEditInit","enter")},onZoomMinusClick(){let e=Math.round(10*(this.zoom-.1))/10;this.setZoomFactor(e)},onZoomPlusClick(){let e=Math.round(10*(this.zoom+.1))/10;this.setZoomFactor(e)},onTogggleLine(){this.setViewLines(!this.renderLines)},setSubMode(){},cleanUpGridResize(){},setBW(e){this.logger.log(-1,"setBW","enter > "+e),e?n.Z.add(this.container,"MatcCanvasBW"):n.Z.remove(this.container,"MatcCanvasBW")},onChangeCanvasViewConfig(){},setCanvasViewConfig(e,t){this.logger.log(-1,"setCanvasViewConfig","enter > "+e,t)},setHash(e){this.logger.log(-1,"setHash","entry > ",e),this.hash=e},renderLayerList(){this.logger.log(1,"renderLayerList","entry > ")},onDNDLayerClick(){},initButtons(){var e=this.db.div("MatcTestCommentButton MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-comment MatcMiddle").build(e),this.own((0,d.Z)(e,"click",g.Z.hitch(this,"onNewComment"))),setTimeout((function(){n.Z.remove(e,"MatcFadeOut")}),100);var t=this.db.div("MatcTestQRButton  MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-play MatcMiddle").build(t),this.own((0,d.Z)(t,"click",g.Z.hitch(this,"onSimulator"))),setTimeout((function(){n.Z.remove(t,"MatcFadeOut")}),200);var s=this.db.div("MatcTestQRButton MatcShareZoomOut MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-magnify-minus-outline MatcMiddle").build(s),this.own((0,d.Z)(s,"click",g.Z.hitch(this,"onZoomMinusClick"))),setTimeout((function(){n.Z.remove(s,"MatcFadeOut")}),300);var i=this.db.div("MatcTestQRButton  MatcShareZoomIn MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-magnify-plus-outline MatcMiddle").build(i),this.own((0,d.Z)(i,"click",g.Z.hitch(this,"onZoomPlusClick"))),setTimeout((function(){n.Z.remove(i,"MatcFadeOut")}),400);var o=this.db.div("MatcTestQRButton MatcShareLine MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-vector-line MatcMiddle").build(o),this.own((0,d.Z)(o,"click",g.Z.hitch(this,"onTogggleLine"))),setTimeout((function(){n.Z.remove(o,"MatcFadeOut")}),500)},onNewComment(e){this.logger.log(1,"onNewComment","enter > "),this.addComment({event:e,type:"comment"})},async loadComments(){this.logger.log(1,"loadComments","enter > ",this.model),this.model&&this.hash||console.error("loadComments() > no model or hash");let e=await this.commentService.findByHash(this.model.id,this.hash,"ScreenComment");this.onCommentsLoaded(e)},async saveDNDChange(e){const t=await this.commentService.updateByHash(this.model.id,this.hash,e);this.onCommentSaved(t)},async onSaveComment(e,t=!1){if(e.id){const t=this.comments[e.id];t.message=e.message,t.status=e.status,t.modified=(new Date).getTime(),t.edited=!0;const s=await this.commentService.updateByHash(this.model.id,this.hash,t);this.updateCommentIcon(t),this.onCommentSaved(s)}else{const t=await this.commentService.createByHash(this.model.id,this.hash,e);this.onCommentSaved(t)}t||this.onCloseCommentPopup()},onSimulator(e){this.startSimilator(e)},startSimilator(){this.logger.log(0,"startSimilator","entry");var e=p.Z.position(u.Z.body());let t=e.h-100;n.Z.add(u.Z.body(),"MatcCanvasSimulatorVisible"),"desktop"===this.defaultModel.type?(e.w=.75*e.w,e.h=.75*e.h,this._showDesktopSimulator(this.model,e,t)):"tablet"===this.defaultModel.type?this.defaultModel.screenSize.w>this.model.screenSize.h?(e.w=.65*e.w,e.h=.65*e.h,this._showMobileTest(this.defaultModel,e,"MatchSimulatorWrapperTablet",t)):(e.w=.35*e.w,e.h=.35*e.h,this._showMobileTest(this.defaultModel,e,"MatchSimulatorWrapperTablet",t)):(e.w=.25*e.w,e.h=.25*e.h,this._showMobileTest(this.defaultModel,e,"MatchSimulatorWrapperMobile",t))},_showDesktopSimulator(e,t,s){const i=document.createElement("div");n.Z.add(i,"MatchSimulatorDialog");const o=document.createElement("div");if(n.Z.add(o,"MatchSimulatorContainer"),i.appendChild(o),t=this.getScaledSize(t,"width",this.model),t.h>s){let e=t.h/s;t.h=t.h/e,t.w=t.w/e}o.style.width=Math.round(t.w)+"px",o.style.height=Math.round(t.h)+"px";const a=this.$new(W.Z,{mode:"debug",logData:!1});a.scrollListenTarget="parent",a.isDesktopTest=!0,a.setHash(this.hash);const r=this.$new(C.Z,{canDestroy:!0});r.placeAt(o);const l=new M.Z;l.hasCSSAnimation=!1,l.popup(i,this.simulatorButton),l.own(l.on("close",g.Z.hitch(this,"stopSimulator",a,r))),l.own((0,d.Z)(i,"click",(e=>{e.target===i&&l.close()}))),e=this.defaultModel;const h=this._getSimulatorScreen();a.setStartScreen(h),setTimeout((function(){r.wrap(a.domNode),a.setModel(e)}),500),this.canvas&&(this.canvas.enableMouseZoom(!1),this.canvas.setState("simulate"))},_showMobileTest(e,t,s,i){const o=document.createElement("div");n.Z.add(o,"MatchSimulatorDialog");const a=document.createElement("div");n.Z.add(a,"MatchSimulatorWrapper "),s&&n.Z.add(a,s),o.appendChild(a);const r=document.createElement("div");if(n.Z.add(r,"MatchSimulatorContainer"),t=this.getScaledSize(t,"width",this.model),t.h>i){let e=t.h/i;t.h=Math.ceil(t.h/e),t.w=Math.ceil(t.w/e)}r.style.width=Math.ceil(t.w)+"px",r.style.height=Math.ceil(t.h)+"px",a.style.width=Math.ceil(t.w)+"px",a.style.height=Math.ceil(t.h)+"px",n.Z.add(a,"MatcSimulatorFadeOut"),a.appendChild(r);const l=this.$new(C.Z,{canDestroy:!0});l.placeAt(r);const h=this.$new(W.Z,{mode:"debug",logData:!1});h.scrollListenTarget="parent",h.isDesktopTest=!0,h.setHash(this.hash);const c=this.getSettings();if(!1!==c.hasQRCode){const e=document.createElement("div");n.Z.add(e,"MatcSimulatorQRWrapper"),o.appendChild(e);const t=document.createElement("img");A.Z.getQRCode(this.hash,!1,!0).then((e=>{t.src=e})),n.Z.add(t,"MatcSimulatorQR"),e.appendChild(t)}const u=new M.Z;u.hasCSSAnimation=!1,u.popup(o,this.simulatorButton),u.on("close",g.Z.hitch(this,"stopSimulator",h,l)),u.own((0,d.Z)(o,"click",(e=>{e.target===o&&u.close()}))),e=this.defaultModel;const m=this._getSimulatorScreen();console.debug(m),h.setStartScreen(m),setTimeout((()=>{l.wrap(h.domNode),h.setModel(e),n.Z.remove(a,"MatcSimulatorFadeOut")}),600),this.canvas&&(this.canvas.enableMouseZoom(!1),this.canvas.setState("simulate"))},_getSimulatorScreen(){if(this._selectedScreen)return this._selectedScreen;if(this._selectedGroup){const e=this._selectedGroup.children[0];return this.getParentScreen({id:e})}return this._selectedWidget?this.getParentScreen(this._selectedWidget):void 0},initWiring(){this.logger.log(-1,"initWiring","enter"),this.own((0,d.Z)(this.dndContainer,"mousedown",(e=>this.dispatchMouseDown(e))))},dispatchMouseDownCanvas(e){this.logger.log(1,"dispatchMouseDownCanvas","enter",e,this.mode),this.onDragStart(this.container,"container","onCanvasDnDStart","onCanvasDnDMove","onCanvasDnDEnd",null,e)},dispatchMouseDownScreen(e,t){this.logger.log(-1,"dispatchMouseDownScreen","enter",t)},dispatchMouseDownWidget(e,t){this.logger.log(-1,"dispatchMouseDownWidget","enter",t);let s=this.widgetDivs[t];this.onWidgetDndClick(t,s)},onWidgetDndClick(e,t,s,i){this.stopEvent(i),this.logger.log(1,"onWidgetDndClick","enter > "+e),this.setState(0)},highlightActionWidgets(){this.logger.log(2,"highlightActionWidgets","entry > ");var e=[];for(var t in this.model.widgets){var s=this.model.widgets[t];if(s){var i=this.getLinesForWidget(s);if(i){var o=this.analyticsDivs[s.id];o&&(e.push(o),n.Z.add(o,"MatcSimulatorWidgetHightlight"))}}}setTimeout((function(){for(var t=0;t<e.length;t++)n.Z.remove(e[t],"MatcSimulatorWidgetHightlight")}),500)},onScreenDndClick(e,t,s,i){this.logger.log(-1,"onScreenDndClick","entry > "+e),this.stopEvent(i),this.highlightActionWidgets(),this.setState(0),this.onCanvasSelected()},onCanvasSelected(){this.logger.log(-2,"onCanvasSelected","entry > ")},updateGridRezise(){},animateToScreen(e,t){this.moveToScreen(e),setTimeout((function(){n.Z.remove(t,"MatcShareCanvasAnimatedContainer")}),500)},afterRender(){this.logger.log(-1,"afterRender","entry > "+this.analyticMode),this.cleanUpAnalytics()},hasSelect(){return"addComment"!=this._mode},cleanUpAnalytics(){this.analyticsDivs={}},setController(e){this.logger.log(2,"setController","enter"),this.controller=e,e.setCanvas(this)},getController(){return this._controllerCallback&&this[this._controllerCallback](),this.controller},setControllerCallback(e){this._controllerCallback=e},setModelFactory(e){this.logger.log(3,"setModelFactory","enter"),this.factory=e},setRenderFactory(e){this.logger.log(0,"setRenderFactory","enter"),this.renderFactory=e},setModel(e){this.logger.log(-3,"setModel","enter"),this.model=e,this.defaultModel=e,this.grid=this.model.grid,this.isCommentsLoaded||(this.loadComments(),this.isCommentsLoaded=!0)},setTest(e){this.logger.log(2,"setTest","enter > # "),this.testSettings=e},setUser(e){this.user=e},setMode(e,t){this.logger.log(2,"setMode","enter > "+e+" != "+this._mode+" > "+t),e!=this._mode?(this._mode=e,this.toolbar&&this.toolbar.setMode(e),this.rerender()):t&&this.rerender()},getMode(){return this._mode},onKeyPress(e){if(this._currentKeyEvent=e,"simulate"!=this.state&&"dialog"!=this.state){var t=e.target;if(!n.Z.contains(t,"MatcIgnoreOnKeyPress")){var s=e.keyCode?e.keyCode:e.which;32==s?this._inlineEditStarted||(this.stopEvent(e),"move"!=this.getMode()&&(this.showHint("Move the mouse to move canvas..."),this.onDragStart(this.container,"container","onCanvasDnDStart","onCanvasDnDMove","onCanvasDnDEnd",null,this._lastMouseMoveEvent,!0),this.setMode("move"))):171==s||187==s?this._inlineEditStarted||(this.onClickPlus(),this.stopEvent(e)):173!=s&&189!=s||this._inlineEditStarted||(this.onClickMinus(),this.stopEvent(e))}}},onKeyUp(e){var t=e.keyCode?e.keyCode:e.which;32==t&&(this.onDragEnd(this._lastMouseMoveEvent),this.setMode("view")),delete this._currentKeyEvent},initSettings(){this.logger.log(1,"initSettings","enter > "),this.settings={canvasTheme:"MatcLight",lineColor:"#999",lineWidth:1,storePropView:!0,moveMode:"ps",mouseWheelMode:"scroll"};var e=this._getStatus("matcSettings");e?(e.canvasTheme,e.lineColor&&(this.settings.lineColor=e.lineColor),e.lineWidth&&(this.settings.lineWidth=e.lineWidth)):this.logger.log(2,"initSettings","exit>  no saved settings"),this.applySettings(this.settings)},getSettings(){return this.settings},setSettings(e){e.canvasTheme&&(this.settings.canvasTheme=e.canvasTheme),e.lineColor,e.lineWidth&&(this.settings.lineWidth=e.lineWidth),null!=e.storePropView&&(this.settings.storePropView=e.storePropView),null!=e.mouseWheelMode&&(this.settings.mouseWheelMode=e.mouseWheelMode),this._setStatus("matcSettings",this.settings),this.applySettings(this.settings),this.rerender()},applySettings(e){this.logger.log(2,"applySettings","enter > "+e.canvasTheme+" &> "+e.moveMode),e.lineWidth&&(this.defaultLineWidth=e.lineWidth),e.canvasTheme&&(this._lastCanvasTheme&&n.Z.remove(u.Z.body(),this._lastCanvasTheme),n.Z.add(u.Z.body(),e.canvasTheme),this._lastCanvasTheme=e.canvasTheme),e.mouseWheelMode&&(this._mouseWheelMode=e.mouseWheelMode),this.settings=e},getLinesForWidget(e){e.inherited&&this.model.widgets[e.inherited]&&(e=this.model.widgets[e.inherited]);var t=e.id,s=this.getFromLines(e);if(s&&s.length>0)return s;var i=this.getParentGroup(t);if(i){var o=this.getFromLines(i);if(o&&o.length>0)return o}},getLineForGesture(e,t){for(var s=0;s<e.length;s++)if(e[s].event===t||"click"===t&&!e[s].event)return e[s]},initMouseTracker(){this.own((0,d.Z)(u.Z.body(),"mousemove",g.Z.hitch(this,"onMouseMove")))},onMouseMove(e){var t=this.getCanvasMousePosition(e,!0);this._lastMousePos=t,this._lastMouseMoveEvent=e},destroy(){this.cleanUp()}},mounted(){}},U=R,I=s(1001),G=(0,I.Z)(U,l,h,!1,null,null,null),$=G.exports,z=s(71251),j=s(62811);class J extends z.Z{constructor(){super(),this.logger=new c.Z("ShareContoller"),this.logger.log(2,"constructor","exit")}setCanvas(e){this.logger.log(3,"setCanvas","entry"),this._canvas=e}setToolbar(e){this.logger.log(3,"setToolbar","entry"),this.toolbar=e}setModelService(e){this.modelService=e}setModelFactory(e){this.logger.log(3,"setModelFactory","entry"),this.factory=e}setModel(e,t){this.logger.log(2,"setModel","entry > "+t),this.model=e;var s=this.countProps(e.screens);s>4&&this._canvas&&(this._canvas.zoom=.25,this._canvas.zoomLevelPos=2),this.inheritedModel=this.createInheritedModel(e),this.oldModel=g.Z.clone(e),this.render(t),this.toolbar&&this.toolbar.setModel(e),this._canvas&&this._canvas.setFonts(e.fonts),this.logger.log(3,"setModel","entry > "+t)}setMode(e){this.logger.log(0,"setMode","entry > "+e),this.toolbar&&this.toolbar.setMode(e),this._canvas.setMode(e)}setSinglePage(e){this.logger.log(0,"setSinglePage","entry > "+e)}getZoomFactor(){return this._canvas?this._canvas.getZoomFactor():1}render(e){if(this.logger.log(2,"render","enter > screenID : "+e),this._canvas){let t=j.Z.createInheritedModel(this.model);requestAnimationFrame((()=>{this._canvas.setModel(t),this._canvas.render(t),e&&this._canvas.moveToScreen(e)}))}}_requestRendering(e){this._zoomedModel&&(this._canvas.render(this._zoomedModel),e&&this._canvas.moveToScreen(e)),this._zoomedModel=null}_zoomToScreen(e){if(e&&this.model.screens[e]){var t=this.model.screens[e];let i=r.Z.getBox(),o=i.w/t.w,a=i.h/t.h;var s=Math.floor(10*Math.min(o,a))/10-.2;this._canvas.setZoom(s)}}onWidgetSelected(e){this.logger.log(0,"onWidgetSelected","enter > "+e);var t=this.inheritedModel.widgets[e];t?this.toolbar&&this.toolbar.onWidgetSelected(t):console.warn("onWidgetSelected() > No width with id",e)}onScreenSelected(e){this.logger.log(1,"onScreenSelected","enter > "+e);var t=this.model.screens[e];this.toolbar&&this.toolbar.onScreenSelected(t)}onCanvasSelected(){this.logger.log(1,"onCanvasSelected","enter "),this.toolbar&&this.toolbar.onCanvasSelected()}onLineSelected(e){this.logger.log(1,"onLineSelected","enter > "+e);var t=this.model.lines[e];this.toolbar&&this.toolbar.onLineSelected(t)}onMultiSelect(e){this.logger.log(1,"onMultiSelect","enter > "),this.toolbar&&this.toolbar.onMultiSelect(e)}onGroupSelected(e){if(this.logger.log(1,"onGroupSelected","enter > "+e),this.model.groups&&this.model.groups[e]&&this.toolbar){var t=this.model.groups[e];this.toolbar.onGroupSelect(t)}}unSelect(){this._canvas&&this._canvas.unSelect(),this.toolbar&&this.toolbar.cleanUp()}showSuccess(e){this._canvas&&this._canvas.showSuccess(e)}showError(e){this._canvas&&this._canvas.showError(e)}}var K=s(73311),q=s(41891),X=s(27437),Q={name:"Design",mixins:[a.Z],data:function(){return{}},components:{ShareCanvas:$},computed:{pub(){return this.$route.meta&&this.$route.meta.isPublic},mode(){return this.pub?"public":"private"}},methods:{loadData(){let e=this.$route.query.h;this.logger.log(0,"loadData","enter",e),Promise.all([this.modelService.findAppByHash(e)]).then((e=>{this.buildCanvas(e[0])}))},buildCanvas(e){this.logger.log(0,"buildCanvas","enter");let t=this.$refs.canvas,s=new J,i=this.modelService;var o=new K.Z;o.setModel(e);var a=new q.Z;a.setModel(e),a.setHash(this.$route.query.h),s.setModelService(i),s.setModelFactory(o),this.pub&&s.setPublic(!0),t.setController(s),t.setCommentService(X.Z.getCommentService()),t.setRenderFactory(a),t.setModelFactory(o),t.setModelService(i),t.setUser(this.user),t.setHash(this.$route.query.h);var n=null;for(var r in e.screens){var l=e.screens[r];if(l.props&&l.props.start){n=r;break}}s.setModel(e,n)}},async mounted(){this.logger=new c.Z("Design"),n.Z.add(r.Z.body(),"MatcVisualEditor"),this.modelService=X.Z.getModelService(this.$route),this.user=await X.Z.getUserService().load(),this.loadData(),this.logger.log(3,"mounted","exit")}},Y=Q,ee=(0,I.Z)(Y,i,o,!1,null,null,null),te=ee.exports}}]);
//# sourceMappingURL=design.0544c77f.js.map